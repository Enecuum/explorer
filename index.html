<!DOCTYPE html>
<html lang="en" ng-app="myApp" xmlns="http://www.w3.org/1999/html">
<head ng-controller="documentHeadCtrl">
    <meta charset="utf-8" />
    <title>Blockchain Explorer | Enecuum</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8">

    <meta name="theme-color" content="#464f5b">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i&display=swap&subset=cyrillic-ext,latin-ext,vietnamese" rel="stylesheet">
    <link href="assets/css/app-dark.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/all.min.css" rel="stylesheet" type="text/css">
    <link ng-href="{{themeLink}}" rel="stylesheet" type="text/css" />
    <!-- App favicon -->
    <link rel="shortcut icon" ng-href="{{favicon}}">
    <!-- third party css -->
    <link href="assets/css/vendor/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
    <!-- third party css end -->
    <!-- App css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <script src="/config.js"></script>
    <!-- angularJS scripts -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-sanitize.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.9/angular-resource.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-cookies.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.15.1/umd/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.min.js"></script>       
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.4.5/select2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.8.5/css/selectize.default.css">
    <!-- angularJS translate -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-translate/2.18.1/angular-translate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-translate/2.18.1/angular-translate-loader-static-files/angular-translate-loader-static-files.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplebar@5.2.1/dist/simplebar.css"/> 
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138901721-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-138901721-1');
    </script>
    <style>
        .short-hash {
            max-width: 150px;
        }
        .dropdown-menu-animated {
            display: none;
        }
        .dropdown-menu-animated.show {
            display: block;
        }
    </style>
</head>
<body data-layout="topnav" class="boxed-layout pb-0">
<!-- Begin page -->

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->
    <div style="max-width: 1400px;" class="mx-auto">
        <div class="content" style="background: #fafbfe">
            <div ng-controller="headerCtrl" class="topnav">
                <div class="navbar-custom topnav-navbar">
                    <div class="container-fluid">
                        <nav class="navbar navbar-dark navbar-expand-lg topnav-menu">
                            <a class="navbar-logo navbar-brand" ng-href="{{logoLinkTarget}}" ng-attr-target="{{(tokenName === 'ENQ') ? '_blank' : undefined}}">
                                <img ng-src="assets/images/{{tokenLogoFile}}" alt="Enecuum logo" height="{{(tokenName === 'ENQ') ? '': '35'}}">
                            </a>
                            <a class="navbar-toggle float-right"  data-toggle="collapse" data-target="#topnav-menu-content">
                                <div class="lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </a>
                            <div class="collapse navbar-collapse" id="topnav-menu-content">
                                <ul class="navbar-nav mr-auto" id="explorerPagesMenu">
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle arrow-none d-flex" href="" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="menuBlockchainExplorer"><span>{{'NAV_EXPLORER' | translate}}</span> <span class="d-flex align-items-center pl-1"><i class="mdi mdi-chevron-down"></i></span></a>
                                        <div class="dropdown-menu" aria-labelledby="menuBlockchainExplorer">
                                            <a href="#!/" class="dropdown-item">{{'DASHBOARD' | translate}}</a>
                                            <a href="#!/page/0" class="dropdown-item">{{'BLOCKS' | translate}}</a>
                                            <a href="#!/tops" class="dropdown-item">{{'ACCOUNTS' | translate}}</a>
                                            <a href="#!/tokens" class="dropdown-item">{{'TOKENS' | translate}}</a>
                                            <a href="#!/pos-contracts" class="dropdown-item">{{'STAKING_PROVIDERS' | translate}}</a>
                                            <a ng-if="showDropFarms" href="#!/drop-farms" class="dropdown-item">{{'DROP_FARMS' | translate}}</a>
                                            <a ng-if="showEnexPools" href="#!/enex-pools" class="dropdown-item">{{'ENEX_POOLS' | translate}}</a>
                                        </div>
                                    </li>
                                    <li class="nav-item dropdown" ng-if="menuItemsVisibility.showWallet">
                                        <a class="nav-link" ng-href="{{walletLink}}">{{'WALLET_TITLE' | translate}}</a>
                                    </li>
                                    <li class="nav-item dropdown" ng-if="menuItemsVisibility.showROICalc">
                                        <a class="nav-link" href="#!/roi">{{'ROI_CALC' | translate}}</a>
                                    </li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link" href="#!/token-roi">{{'TOKEN_CALC' | translate}}</a>
                                    </li>
                                    <li class="nav-item dropdown" ng-if="tokenName === 'ENQ'">
                                        <a class="nav-link" ng-href="https://guides.enecuum.com/{{curLang.id === 'ru' ? 'ru/' : ''}}" target="_blank">{{'NAV_HOWTO_MINE' | translate}}</a>
                                    </li>                                    
                                    <li class="nav-item dropdown" ng-if="tokenName === 'BIT'">
                                        <a class="nav-link dropdown-toggle arrow-none d-flex" href="" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="menuHowToMine"><span>{{'NAV_HOWTO_MINE' | translate}}</span> <span class="d-flex align-items-center pl-1"><i class="mdi mdi-chevron-down"></span></i></a>
                                        <div class="dropdown-menu" aria-labelledby="menuHowToMine">
                                            <div>
                                                <a ng-href="https://guides.enecuum.com/{{curLang.id === 'ru' ? 'ru/' : ''}}{{tokenName.toLowerCase()}}/how-to-mine-bit.html#{{curLang.id === 'ru' ? 'как-запустить-pow' : 'how-to-run-pow'}}" class="dropdown-item" target="_blank">{{'HOW_TO_START_POW' | translate}}</a>
                                                <a ng-href="https://guides.enecuum.com/{{curLang.id === 'ru' ? 'ru/' : ''}}{{tokenName.toLowerCase()}}/how-to-pos.html" class="dropdown-item" target="_blank">{{'HOW_TO_START_POS' | translate}}</a>
                                                <a ng-href="https://guides.enecuum.com/{{curLang.id === 'ru' ? 'ru/' : ''}}{{tokenName.toLowerCase()}}/how-to-mine-bit.html#{{curLang.id === 'ru' ? 'как-запустить-poa' : 'how-to-run-poa'}}" class="dropdown-item" target="_blank">{{'HOW_TO_START_POA' | translate}}</a>
                                                <a ng-href="https://guides.enecuum.com/{{curLang.id === 'ru' ? 'ru/' : ''}}{{tokenName.toLowerCase()}}/how-to-mine-bit.html#{{curLang.id === 'ru' ? 'как-запустить-fullnode' : 'how-to-run-fullnode'}}" class="dropdown-item" target="_blank">{{'HOW_TO_START_FULL_NODE' | translate}}</a>
                                                <div class="dropdown-divider d-none d-lg-block"></div>
                                                <a href="https://faucet-bit.enecuum.com" class="dropdown-item" target="_blank">{{'GET_COINS' | translate}}</a>  
                                                <div class="dropdown-divider d-none d-lg-block"></div>
                                                <a href="https://app.enecuum.com/enq-bitRelease-v.0.14.4+851.apk" class="dropdown-item">{{'DOWNLOAD_APP' | translate}}</a>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <div class="navbar-nav dropdown nav-link d-lg-flex py-lg-0">
                                    <a class="nav-link dropdown-toggle arrow-none py-lg-0 d-lg-flex align-items-lg-center" data-toggle="dropdown" id="topbar-languagedrop" href="javascript:void(0);" role="button" aria-haspopup="true" aria-expanded="false">
                                        <img ng-src="assets/images/flags/{{curLang.flag}}.svg" alt="user-image" class="mr-1" height="12"> <span class="align-middle">{{curLang.name}}</span> <i class="mdi mdi-chevron-down"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right " aria-labelledby="topbar-languagedrop" x-placement="bottom-end">

                                        <!-- item-->
                                        <a ng-repeat="lg in ls.languages" href="javascript:void(0);" ng-click="changeLanguage(lg.id)" class="dropdown-item notify-item">
                                            <img ng-src="assets/images/flags/{{lg.flag}}.svg" alt="user-image" class="mr-1" height="12"> <span class="align-middle">{{lg.name}}</span>
                                        </a>

                                    </div>
                                </div>
                                <div class="app-search float-right-l d-block">
                                    <form>
                                        <div class="input-group">
                                            <input type="text" class="form-control" ng-model="search_value" placeholder="{{'NAV_SEARCH' | translate}}...">
                                            <span class="mdi mdi-magnify"></span>
                                            <div class="input-group-append">
                                                <button class="btn btn-primary bg-blue" ng-click="on_search();">{{'NAV_SEARCH' | translate}}</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </nav>
                    </div>
                </div>
                <div class="modal fade" id="{{searchModalId}}" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-dialog-centered modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title">{{'SEARCH_RESULTS' | translate}}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div> 
                            <div class="modal-body d-flex justify-content-center">
                                <table>
                                    <tr ng-repeat="item in searchResult">
                                        <td class="h5 pr-3 py-2">{{searchItemsList[item.type].alias | translate}}</td>
                                        <td ng-if="item.type !== 'pool' && item.type !== 'farm'" class="py-2">
                                            <button ng-click="locateToSearchResult(item)" type="button" class="btn btn-info">{{'INFO' | translate}}</button>
                                        </td>
                                        <td ng-if="item.type === 'pool' || item.type === 'farm'" class="py-2">
                                            <button ng-click="locateToSearchResult(item)" type="button" class="btn btn-info">
                                                <span class="mr-1">API</span>
                                                <i class="fas fa-external-link-square-alt"></i>
                                        </td>                                        
                                    </tr>
                                </table>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div>
            </div>
            <!-- Start Content-->
            <div class="container">
                <ng-view></ng-view>
                <script type="text/ng-template" id="home">
                    <div class="row pt-3">
                        <div class="col-xl-2 col-md-4">
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi mdi-currency-usd" style="font-size: 24px;"></span>
                                    <h4><span>{{stats.cg_usd | USD}}</span></h4>
                                    <p class="text-muted font-15 mb-0">{{'TOKEN_PRICE' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <!-- end col-->
                        <div class="col-xl-2 col-md-4">
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-cube-send" style="font-size: 24px;"></span>
                                    <h4><span><a ng-href="#!/macroblock/{{blocks.blocks[0].hash}}">{{blocks.blocks[0].n}}</a></span></h4>
                                    <p class="text-muted font-15 mb-0">{{'LAST_BLOCK' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <!-- end col-->
                        <div class="col-xl-2 col-md-4">
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-account-key" style="font-size: 24px;"></span>
                                    <h4><span><a ng-href="#!/tops">{{stats.accounts || "N/A"}}</a></span></h4>
                                    <p class="text-muted font-15 mb-0">{{'ACCOUNTS' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <!-- end col-->
                        <div class="col-xl-6 col-md-12">
                            <div class="row">
                                <div class="col-xl-6 col-md-6">
                                    <div class="card widget-flat">
                                        <div class="card-body text-center">
                                            <dl class="row mb-0 ">
                                                <dt class="text-muted font-14 col-4">PoW :</dt>
                                                <dd class="text-muted font-14 col-8 mb-0">{{stats.reward_pow !== undefined ? stats.reward_pow : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <dl class="row mb-0">
                                                <dt class="text-muted font-14 col-4">PoS :</dt>
                                                <dd class="text-muted font-14 col-8 mb-0">{{stats.reward_pos !== undefined ? stats.reward_pos : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <dl class="row" style="margin-bottom: 12px;">
                                                <dt class="text-muted font-14 col-4">PoA :</dt>
                                                <dd class="text-muted font-14 col-8 mb-0">{{stats.reward_poa !== undefined ? stats.reward_poa : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <p class="text-muted font-15 mb-0">{{'LAST_REWARDS' | translate}}</p>
                                        </div>
                                        <!-- end card-body-->
                                    </div>
                                    <!-- end card-->
                                </div>
                                <!-- end col-->
                                <div class="col-xl-6 col-md-6">
                                    <div class="card widget-flat">
                                        <div class="card-body text-center">
                                            <dl class="row mb-0">
                                                <dt class="text-muted font-14 col-6">{{'CIRC_SUPPLY_SHORT' | translate}}:</dt>
                                                <dd class="text-muted font-14 col-6 mb-0">{{stats.csup !== undefined ? stats.csup : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <dl class="row mb-0">
                                                <dt class="text-muted font-14 col-6 text-nowrap">{{'TOTAL_SUPPLY' | translate}}:</dt>
                                                <dd class="text-muted font-14 col-6 mb-0">{{mainToken.total_supply !== undefined ? mainToken.total_supply : "---" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <dl class="row" style="margin-bottom: 12px;">
                                                <dt class="text-muted font-14 col-6">{{'MAX_SUPPLY' | translate}}:</dt>
                                                <dd class="text-muted font-14 col-6 mb-0">{{mainToken.max_supply !== undefined ? mainToken.max_supply : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 0}} {{mainToken.ticker}}</dd>
                                            </dl>
                                            <p class="text-muted font-15 mb-0 ">{{'COIN_DATA' | translate}}</p>
                                        </div>
                                        <!-- end card-body-->
                                    </div>
                                    <!-- end card-->
                                </div>
                                <!-- end col-->
                            </div>
                        </div>
                    </div>
                    <!-- end row -->
                    <div class="row">
                        <div class="col-xl col-md-12">
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-laptop-chromebook" style="font-size: 24px;"></span>
                                    <h4><span>{{externalStats.pow_count !== null && externalStats.pow_count !== undefined ? externalStats.pow_count : "N/A"}}</span></h4>
                                    <p class="text-muted font-15 mb-0">PoW {{'NODES' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-server" style="font-size: 24px;"></span>
                                    <h4><span>{{externalStats.pos_count !== null && externalStats.pos_count !== undefined ? externalStats.pos_count : "N/A"}}</span></h4>
                                    <p class="text-muted font-15 mb-0">PoS {{'NODES' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <div class="card widget-flat" ng-if="showFullNodesCountCard">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-monitor" style="font-size: 24px;"></span>
                                    <h4><span>{{externalStats.full_count !== null && externalStats.full_count !== undefined ? externalStats.full_count : "N/A"}}</span></h4>
                                    <p class="text-muted font-15 mb-0">Full {{'NODES' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                            <div class="card widget-flat">
                                <div class="card-body text-center">
                                    <span class="mdi mdi-cellphone-android" style="font-size: 24px;"></span>
                                    <h4><span>{{externalStats.poa_count !== null && externalStats.poa_count !== undefined ? externalStats.poa_count : "N/A"}}</span></h4>
                                    <p class="text-muted font-15 mb-0">PoA {{'NODES' | translate}}</p>
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <div class="col-xl-10">
                            <div class="card">
                                <div class="card-body">
                                    <div class="pb-2">
                                        <h4 class="d-inline header-title">{{'TOTAL_NODES' | translate}}</h4>
                                        <h3 class="d-inline">{{externalStats.poa_count + externalStats.pos_count + externalStats.pow_count + externalStats.full_count}}</h3>
                                    </div>
                                    <div id="world-map-markers" ng-style="{'height' : showFullNodesCountCard ? '511px' : '360px'}"></div>
                                </div> <!-- end card-body-->
                            </div> <!-- end card-->
                        </div> <!-- end col-->
                    </div>
                    <!-- end col-->
                    <div class="row">
                        <div class="col-xl-6">
                            <div class="card">
                                <div class="card-body">
                                    <a href="#!/page/0" class="btn btn-sm btn-link float-right">{{'VIEW_ALL' | translate}}
                                        
                                    </a>
                                    <h4 class="header-title mt-2 mb-3">{{'LAST_BLOCK' | translate}}</h4>
                                    <div class="table-responsive" style="height: 700px;">
                                        <table class="table table-centered table-hover mb-0 animate-show-hide">
                                            <thead class="text-uppercase">
                                            <tr>
                                                <th>
                                                    <h5 class="font-14 mb-1 font-weight-normal">{{'HEIGHT' | translate}}</h5>
                                                </th>
                                                <th>
                                                    <h5 class="font-14 mb-1 font-weight-normal">{{'TIME' | translate}}</h5>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="block in blocks.blocks">
                                                <td><a ng-href="#!/macroblock/{{block.hash}}"><h5 class="font-14 mb-1 font-weight-normal">{{block.n}}</h5></a></td>
                                                <td><h5 class="font-14 mb-1 font-weight-normal">{{get_time(block.time)}}</h5></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- end table-responsive-->
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <!-- end col-->
                        <div class="col-xl-6">
                            <div class="card">
                                <div class="card-body">
                                    <!--
                                    <a href="" class="btn btn-sm btn-link float-right mb-3">View all
                                        <i class="mdi mdi-eye ml-1"></i>
                                    </a>
                                    -->
                                    <h4 class="header-title mt-2 mb-3">{{'LAST_TXS' | translate}}</h4>
                                    <div class="table-responsive" style="height: 700px;">
                                        <table class="table table-centered table-hover mb-0 animate-show-hide">
                                            <thead class="text-uppercase">
                                            <tr>
                                                <th>
                                                    <h5 class="font-14 mb-1 font-weight-normal">{{'TX_DATA' | translate}}</h5>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="tx in txs.txs">
                                                <td>
                                                    <h5 class="font-14 mb-1 font-weight-normal text-truncate"><a ng-href="#!/tx/{{tx.hash}}">{{tx.hash}}</a></h5>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- end table-responsive-->
                                </div>
                                <!-- end card-body-->
                            </div>
                            <!-- end card-->
                        </div>
                        <!-- end col-->
                    </div>
                    <!-- end row -->
                </script>

                <!-- --------------------------------- S B L O C K ------------------------------------------------- -->

                <script type="text/ng-template" id="sblock">
                    <div class="row justify-content-md-center pt-3" ng-if="showSBlocks">
                        <div class="col-lg-12 table-responsive card pt-3">

                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/">{{'HOME' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/macroblock/{{sblock.header.kblocks_hash}}">{{'K_BLOCK' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash active" aria-current="page">{{'S_BLOCK' | translate}}</li>
                                </ol>
                            </nav>

                            <table class="table table-centered table-hover">
                                <tbody>
                                    <tr>
                                        <td>{{'K_BLOCK_HASH' | translate}}</td>
                                        <td><a ng-href="#!/macroblock/{{sblock.header.kblocks_hash}}">{{sblock.header.kblocks_hash}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>{{'PUBLISHER' | translate}}</td>
                                        <td><a ng-href="#!/pos-contract/{{sblock.header.publisher}}">{{sblock.header.publisher}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>{{'REWARD' | translate}}</td>
                                        <td>{{sblock.header.reward | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : mainToken.decimals}} {{mainToken.ticker}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{'HASH' | translate}}</td>
                                        <td>{{sblock.header.sblocks_hash}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </script>

                <!-- --------------------------------- M B L O C K ------------------------------------------------- -->

                <script type="text/ng-template" id="mblock">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-lg-12 table-responsive card pt-3">

                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/">{{'HOME' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/macroblock/{{mblock.header.kblocks_hash}}">{{'K_BLOCK' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash active" aria-current="page">{{'MICROBLOCK' | translate}}</li>
                                </ol>
                            </nav>

                            <table class="table table-centered table-hover">
                                <tbody>
                                    <tr>
                                        <td>{{'K_BLOCK_HASH' | translate}}</td>
                                        <td><a ng-href="#!/macroblock/{{mblock.header.kblocks_hash}}">{{mblock.header.kblocks_hash}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>{{'PUBLISHER' | translate}}</td>
                                        <td><a ng-href="#!/account/{{mblock.header.publisher}}">{{mblock.header.publisher}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>Referrer</td>
                                        <td><a ng-href="#!/account/{{mblock.header.referrer}}">{{mblock.header.referrer}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>{{'REWARD' | translate}}</td>
                                        <td>{{mblock.header.reward | US_COMMAS_BIGINT_DECIMALS : rewardToken.decimals : rewardToken.decimals}} {{rewardToken.ticker}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{'HASH' | translate}}</td>
                                        <td>{{mblock.header.mblocks_hash}}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="table table-centered table-hover">
                                <thead>
                                <tr>
                                    <th>{{'TRANSACTIONS' | translate}}</th>
                                </tr>
                                </thead>
                                <tbody style="font-size: 12px;">
                                <tr ng-repeat="tx in mblock.transactions">
                                    <td><a ng-href="#!/tx/{{tx.hash}}">{{tx.hash}}</a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </script>

                <!-- --------------------------------- T R A N S A C T I O N --------------------------------------- -->

                <script type="text/ng-template" id="transaction">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-lg-12 table-responsive card pt-3">

                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/">{{'HOME' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/macroblock/{{tx.kblocks_hash}}">{{'K_BLOCK' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash"><a href="#!/mblock/{{tx.mblocks_hash}}">{{'MICROBLOCK' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash active" aria-current="page">{{'TX' | translate}}</li>
                                </ol>
                            </nav>
                            <div class="d-flex align-items-center" ng-class="showContractParams === true ? 'mb-1' : 'mb-4'">
                                <div class="h4 text-uppercase mx-md-2">{{'TX' | translate}}<span class="text-uppercase badge badge-pill py-1 ml-2" ng-class="statusBadge(tx.status | TX_STATUS)">{{tx.status | TX_STATUS | translate}}</span></div>
                                <div ng-if="txCurrentState === 'isInPending'" class="spinner-grow text-primary" role="status"></div>
                            </div>    
                           

                            <div class="mb-3 mx-md-2" ng-if="showContractParams">                                
                                <div class="d-flex align-items-center">
                                    <div class="h4 d-flex align-items-center mr-3">
                                        <div class="mr-2 h5 font-weight-normal">{{'TYPE' | translate}}</div>
                                        <div class="text-uppercase badge badge-secondary-lighten badge-pill py-1">{{getContactType(txDataInit.type) | translate}}</div>
                                    </div>                               
                                </div>
                            </div>
                            <table class="table table-centered">
                                <tbody id="singleTxInfo">
                                    <tr>
                                        <td>{{'HASH' | translate}}</td>
                                        <td class="fit">{{tx.hash}}</td>
                                    </tr>
                                    <tr>
                                        <td>{{'FROM' | translate}}</td>
                                        <td class="fit"><a ng-href="#!/account/{{tx.from}}">{{tx.from}}</a></td>
                                    </tr>
                                    <tr>
                                        <td>{{'TO' | translate}}</td>
                                        <td class="fit"><a ng-href="#!/account/{{tx.to}}">{{tx.to}}</a></td>
                                    </tr>
                                    <tr>
                                        <td ng-if="txCurrentState === 'isInNetwork'">{{'AMOUNT' | translate}}</td>
                                        <td ng-if="txCurrentState === 'isInPending'">{{'TOTAL_AMOUNT' | translate}}</td>
                                        <td>{{tx.amount | US_COMMAS_BIGINT_DECIMALS : tx.token.decimals : tx.token.decimals}} {{tx.token.ticker}}</td>
                                    </tr>
                                    <tr ng-if="txCurrentState === 'isInNetwork'">
                                        <td>{{'FEE_VALUE' | translate}}</td>
                                        <td ng-if="tx.fee_type !== 2">
                                            {{tx.fee | US_COMMAS_BIGINT_DECIMALS : tx.token.decimals : tx.token.decimals}} {{tx.token.ticker}}
                                        </td>
                                        <td ng-if="tx.fee_type === 2">
                                            {{tx.fee_value | US_COMMAS_BIGINT_DECIMALS : maintoken.decimals : maintoken.decimals}} {{maintoken.ticker}}
                                        </td>
                                    </tr>                                   
                                    <tr>
                                        <td>{{'DATA' | translate}}</td>
                                        <td>
                                            <div>
                                                {{tx.data}} 
                                            </div>
                                        </td> 
                                    </tr>
                                    <tr ng-if="showContractParams">
                                        <td>{{'PARAMS' | translate}}</td>
                                        <td class="overflow-hidden">
                                            <div class="mb-2">
                                                <div class="btn-group float-right" id="txDataShowToggler">
                                                    <a class="dropdown-toggle btn btn-primary btn-sm bg-blue text-white" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="mdi mdi-eye-outline"></i></a>
                                                    <div class="dropdown-menu dropdown-menu-right">
                                                        <ul class="nav nav-tabs">
                                                            <li class="dropdown-item nav-item px-0">
                                                                <a class="dropdown-item nav-link active px-3" href="javascript;" data-target="#txDataTab" data-toggle="tab" aria-expanded="true" data-toggle="tab">{{"TX_DATA_FORMATTED" | translate}}</a>
                                                            </li>                            
                                                            <li class="dropdown-item nav-item px-0">
                                                                <a class="dropdown-item nav-link px-3" href="javascript;" data-target="#txDataInitTab" data-toggle="tab" aria-expanded="false" data-toggle="tab">{{"TX_DATA_AS_IS" | translate}}</a> 
                                                            </li>
                                                        </ul>
                                                    </div>    
                                                </div>
                                            </div>

                                            <div class="tab-content">
                                                <div class="tab-pane active show" id="txDataTab"> 
                                                    <div class="mb-2">
                                                        <span class="mr-1 font-weight-bolder">{{"TYPE" | translate}}</span>
                                                        <span class="mr-2 d-block d-md-inline">{{getContactType(txDataInit.type) | translate}}</span>
                                                    </div>
                                                    <div ng-include="'views/partials/contracts-tx/' + txContractsTemplate"></div>
                                                </div>                                                
                                                <div class="tab-pane" id="txDataInitTab">
                                                    <div class="mb-2">
                                                        <span class="mr-1 font-weight-bolder">type</span>
                                                        <span class="mr-2 d-block d-md-inline">{{txData.type}}</span>
                                                    </div>
                                                    <table class="table table-sm tx-data-table no-border">
                                                        <tbody>
                                                            <tr ng-repeat="(key, value) in txDataInit.parameters" class="mb-1">
                                                                <th class="pr-md-3">{{key}}</th>
                                                                <td class="fit">{{value}}</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr ng-if="txEIndexDataTemplate !== undefined">
                                        <td>{{'ADDITIONAL' | translate}}</td>
                                        <td>
                                            <div ng-include="'views/partials/contracts-tx/' + txEIndexDataTemplate"></div>
                                        </td>                                        
                                    </tr>
                                    <tr ng-if="txCurrentState === 'isInNetwork'">
                                        <td>{{'M_BLOCK_HASH' | translate}}</td>
                                        <td class="fit"><a ng-href="#!/mblock/{{tx.mblocks_hash}}">{{tx.mblocks_hash}}</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </script>

                <!-- --------------------------------- M A C R O B L O C K ----------------------------------------- -->

                <script type="text/ng-template" id="macroblock">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-lg-12 card pt-3">

                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#!/">{{'HOME' | translate}}</a></li>
                                    <li class="breadcrumb-item text-truncate short-hash active" aria-current="page">{{'K_BLOCK' | translate}}</li>
                                </ol>
                            </nav>


                            <table class="table table-centered table-hover">
                                <tbody>
                                <tr>
                                    <td>{{'HEIGHT' | translate}}</td>
                                    <td>{{macroblock.kblock.n}}</td>
                                </tr>
                                <tr>
                                    <td>{{'TIME' | translate}}</td>
                                    <td>{{get_time(macroblock.kblock.time)}}</td>
                                </tr>
                                <tr>
                                    <td>{{'K_BLOCK_HASH' | translate}}</td>
                                    <td class="fit">{{macroblock.kblock.hash}}</td>
                                </tr>
                                <tr>
                                    <td>{{'PUBLISHER' | translate}}</td>
                                    <td class="fit"><a ng-href="#!/account/{{macroblock.kblock.publisher}}">{{macroblock.kblock.publisher}}</a></td>
                                </tr>
                                <tr>
                                    <td>{{'NONCE' | translate}}</td>
                                    <td>{{macroblock.kblock.nonce}}</td>
                                </tr>
                                <tr>
                                    <td>{{'TOTAL_MICROBLOCKS' | translate}}</td>
                                    <td>{{macroblock.mblocks.length}}</td>
                                </tr>
                                <tr ng-if="showSBlocks">
                                    <td>{{'TOTAL_STATBLOCKS' | translate}}</td>
                                    <td>{{macroblock.sblocks.length}}</td>
                                </tr>
                                <tr>
                                    <td>{{'PREVIOUS_BLOCK' | translate}}</td>
                                    <td class="fit"><a ng-href="#!/macroblock/{{macroblock.kblock.link}}">{{macroblock.kblock.link}}</a></td>
                                </tr>
                                </tbody>
                            </table>

                            <table class="table table-bordered table-centered table-hover">
                                <thead>
                                <tr>
                                    <th>{{'M_BLOCK_HASH' | translate}}</th>
                                    <th>{{'TRANSACTIONS' | translate}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="mblock in macroblock.mblocks">
                                    <td class="fit"><a ng-href="#!/mblock/{{mblock.hash}}">{{mblock.hash}}</a></td>
                                    <td>{{mblock.tx_cnt}}</td>
                                </tr>
                                </tbody>
                            </table>

                            <table class="table table-bordered table-centered table-hover" ng-if="showSBlocks">
                                <thead>
                                <tr>
                                    <th>{{'S_BLOCK_HASH' | translate}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="sblock in macroblock.sblocks">
                                    <td class="fit"><a ng-href="#!/sblock/{{sblock.hash}}">{{sblock.hash}}</a></td>
                                </tr>
                                </tbody>
                            </table>

                            <table class="table table-bordered table-centered table-hover" ng-if="showSnapshot">
                                <thead>
                                <tr>
                                    <th>{{'SNAPSHOT_HASH' | translate}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td class="fit">{{macroblock.snapshot_hash}}</td>
                                </tr>
                                </tbody>
                            </table>                            

                        </div>
                    </div>
                </script>

                <!-- --------------------------------- A C C O U N T ----------------------------------------------- -->
                <script type="text/ng-template" id="account">
                    <div class="row pt-3">
                        <div class="modal fade" id="qrModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="qrcode" ></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>
                        <div class="modal fade" id="refqrModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="refqrcode" ></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>
                        <div class="col-12" ng-include="'views/partials/account-details-main-info.html'"></div>
                        <div class="col-12" ng-include="'views/partials/account-details-tabs.html'"></div>                        
                    </div>
                </script>

                <!-- --------------------------------- P A G E ----------------------------------------------------- -->

                <script type="text/ng-template" id="page">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row align-content-center">
                                        <h4 class="col mr-auto header-title mt-2 mb-3 ng-binding">{{'BLOCKS' | translate}}</h4>
                                        <div class="col px-0 px-lg-2">
                                            <ol class="breadcrumb py-2 m-0 justify-content-end">
                                                <li class="breadcrumb-item"><a href="#!/">{{'HOME' | translate}}</a></li>
                                                <li class="breadcrumb-item active">{{'BLOCKS' | translate}}</li>
                                            </ol>
                                        </div>
                                        <div class="col-12 px-0 pt-1 pt-sm-2 pb-0 px-lg-2">
                                            <div class="btn-group float-right" aria-label="Rewind kblocks">
                                                <a ng-href="#!/page/0" class="btn-sm btn btn-secondary text-nowrap" ng-class="page_num == 0 ? 'disabled' : ''" role="button">{{'FRST' | translate}}</a>
                                                <a ng-href="#!/page/{{page_num - 1}}" class="btn-sm btn btn-secondary" ng-class="page_num == 0 ? 'disabled' : ''" role="button"><i class="fas fa-chevron-left"></i></a>
                                                <a class="btn-sm fit btn btn-secondary disabled text-nowrap" role="button" style="opacity: 1;">{{'PAGE' | translate : {current: page_num + 1, total: page.count} }}</a>
                                                <a ng-href="#!/page/{{page_num + 1}}" class="btn-sm btn btn-secondary" ng-class="page_num == page.count-1 ? 'disabled' : ''" role="button"><i class="fas fa-chevron-right"></i></a>
                                                <a ng-href="#!/page/{{page.count - 1}}" class="btn-sm btn btn-secondary text-nowrap" ng-class="page_num == page.count-1 ? 'disabled' : ''" role="button">{{'LAST' | translate}}</a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-12 table-responsive px-0 pt-3 pb-0 px-lg-2">
                                            <table class="table table-centered table-hover table-to-cards">
                                                <thead>
                                                    <tr>
                                                        <th>Height</th>
                                                        <th>{{'TIME' | translate}}</th>
                                                        <th>{{'K_BLOCK_HASH' | translate}}</th>
                                                        <th>{{'PUBLISHER' | translate}}</th>
                                                        <th>{{'TRANSACTIONS' | translate}}</th>
                                                    </tr>
                                                </thead>
                                                <tbody style="font-size: 12px;" >
                                                    <tr ng-repeat="kblock in page.kblocks">
                                                        <td><span class="scope-col">Height </span>{{kblock.n}}</td>
                                                        <td><span class="scope-col">{{'TIME' | translate}} </span>{{get_time(kblock.time)}}</td>
                                                        <td class="fit"><span class="scope-col">{{'K_BLOCK_HASH' | translate}} </span><a ng-href="#!/macroblock/{{kblock.hash}}">{{kblock.hash}}</a></td>
                                                        <td class="fit"><span class="scope-col">{{'PUBLISHER' | translate}} </span>{{kblock.publisher}}</td>
                                                        <td><span class="scope-col">{{'TRANSACTIONS' | translate}} </span>{{kblock.tx_count}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </script>

                <script type="text/ng-template" id="map">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="pb-2">
                                        <h4 class="d-inline header-title">{{'TOTAL_NODES' | translate}} </h4>
                                        <h3 class="d-inline">{{stats.poa_count + stats.pos_count + stats.pow_count}}</h3>
                                    </div>
                                    <div id="world-map-markers" style="height: 410px"></div>
                                </div> <!-- end card-body-->
                            </div> <!-- end card-->
                        </div> <!-- end col-->
                    </div>
                </script>

                <script type="text/ng-template" id="tops">
                    <div class="row pt-3">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-12">
                                    <div class="h4 mb-3 pl-2 pl-sm-0">{{"TOP_ACCOUNTS_BY_TOKEN_BALANCE" | translate: mainToken}}</div>
                                </div>  
                            </div>
                            <div class="row justify-content-md-center">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body p-2 p-sm-3">                                            
                                                <div class="col-12 mb-3" data-simplebar data-simplebar-lg data-simplebar-auto-hide="false">
                                                    <table class="table table-centered ordinary-table table-hover animate-show-hide table-highlighted-head" style="table-layout: auto;" >
                                                        <thead>
                                                        <tr>
                                                            <th>{{"RANK" | translate}}</th>
                                                            <th class="fit">{{'ADDRESS' | translate}}</th>
                                                            <th>{{'BALANCE' | translate}}</th>
                                                            <th ng-if="mainToken.ticker === 'ENQ'">{{'VALUE' | translate}}, USD</th>
                                                            <th>{{'PERCENTAGE' | translate}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody style="font-size: 12px;" >
                                                        <tr ng-repeat="acc in accs.accounts ">
                                                            <td class="text-nowrap">{{acc.rank}}</td>
                                                            <td>
                                                                <a class="d-block fit responsive-hash" ng-href="#!/account/{{acc.id}}">
                                                                    {{acc.tag !== undefined ? acc.tag : acc.id}}
                                                                </a>
                                                            </td>
                                                            <td class="text-nowrap">{{acc.amount !== undefined ? acc.amount : "N/A" | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : mainToken.decimals}} {{mainToken.ticker}}</td>
                                                            <td class="text-nowrap" ng-if="mainToken.ticker === 'ENQ'">{{acc.valueUSD}}</td>
                                                            <td class="text-nowrap">{{acc.percentage}}</td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div ng-if="page_count > 1" class="col-12 col-lg text-right">
                                                    <div class="btn-group float-right" aria-label="Rewind records">
                                                        <a class="btn-sm btn btn-secondary text-nowrap" ng-class="page_num == 0 ? 'disabled' : ''" role="button" ng-click="getHistory(0)">{{'FRST' | translate}}</a>
                                                        <a class="btn-sm btn btn-secondary" ng-class="page_num == 0 ? 'disabled' : ''" role="button" ng-click="getHistory(page_num - 1)"><i class="fas fa-chevron-left"></i></a>
                                                        <a class="btn-sm fit btn btn-secondary disabled text-nowrap" role="button" style="opacity: 1;">{{'PAGE' | translate : {current: page_num + 1, total: accs.page_count} }}</a>
                                                        <a class="btn-sm btn btn-secondary" ng-class="page_num == accs.page_count-1 ? 'disabled' : ''" role="button" ng-click="getHistory(page_num + 1)"><i class="fas fa-chevron-right"></i></a>
                                                        <a class="btn-sm btn btn-secondary text-nowrap" ng-class="page_num == accs.page_count-1 ? 'disabled' : ''" role="button" ng-click="getHistory(accs.page_count-1)">{{'LAST' | translate}}</a>
                                                    </div>
                                                </div>
                                            
                                        </div> <!-- end card-body-->
                                    </div> <!-- end card-->
                                </div> <!-- end col-->
                            </div>
                        </div>
                    </div>                   
                </script>
                <script type="text/ng-template" id="tokens">
                    <div class="col-12" ng-include="'views/partials/all-tokens-tabs.html'"></div>
                </script>
                <script type="text/ng-template" id="token">
                    <div class="row pt-3">
                        <div class="modal fade" id="qrTokenOwnerModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="qrTokenOwnerCode"></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>
                        <div class="modal fade" id="qrTokenIDModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="qrTokenIDCode"></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>                        
                        <div class="col-12" ng-include="'views/partials/token-details-main-info.html'"></div>
                        <div class="col-12" ng-include="'views/partials/token-details-tabs.html'"></div>                        
                    </div>
                </script>
                <script type="text/ng-template" id="posContracts">
                    <div class="row justify-content-md-center pt-3">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row align-content-center">
                                        <h4 class="col mr-auto header-title mt-2 mb-3 ng-binding">{{'STAKING_PROVIDERS' | translate}}</h4>
                                        <div class="col px-0 px-lg-2">
                                            <ol class="breadcrumb py-2 m-0 justify-content-end">
                                                <li class="breadcrumb-item"><a href="#!/">{{'HOME' | translate}}</a></li>
                                                <li class="breadcrumb-item active">{{'STAKING_PROVIDERS' | translate}}</li>
                                            </ol>
                                        </div>
                                        <div class="col-12 px-0 pt-1 pt-sm-2 pb-0 px-lg-2">
                                            <ul class="nav nav-tabs nav-bordered mb-3 nav-filters">
                                                <li class="nav-item">
                                                    <a href="#" data-toggle="pill" target="_self" aria-expanded="false" class="nav-link active rounded-0 mr-1" ng-click=toggleActivePOSList(1)>
                                                        <span class="d-block">{{'ACTIVE_ITEMS' | translate }} ({{activePOSAmount}})</span>
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#" data-toggle="pill" target="_self" aria-expanded="true" class="nav-link rounded-0 mr-1" ng-click=toggleActivePOSList(0)>
                                                        <span class="d-block">{{'INACTIVE_ITEMS' | translate}}  ({{inactivePOSAmount}})</span>
                                                    </a>
                                                </li>                                                                                       
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 table-responsive px-0 pt-3 pb-0 px-lg-2">
                                            <table class="table table-centered table-hover table-to-cards">
                                                <thead>
                                                     <tr>
                                                        <th class="w-lg-65-px">{{'RANK' | translate}}</th>
                                                        <th class="w-lg-100-px">{{active === 1 ? 'STAKE_POWER' : 'ACTIVE_STAKE_SHARE' | translate}}</th>                                                     
                                                        <th class="pl-lg-0">{{'NAME' | translate}}</th>
                                                        <th>POS id</th>
                                                        <th>{{'OWNER' | translate}}</th>
                                                        <th>{{'STAKE' | translate}}</th>
                                                        <th class="text-wrap fit"><div style="min-width: 85px;">{{'PROVIDER_FEE' | translate}}</div></th>
                                                        <th class="text-nowrap fit">{{'PERFORMANCE' | translate}}</th>
                                                        <th>{{'ROI' | translate}}</th>
                                                    </tr>
                                                </thead>
                                                <tbody style="font-size: 12px;" >
                                                    <tr ng-if="pos.active === active" ng-repeat="pos in posContracts">
                                                        <td class="w-lg-65-px"><span class="scope-col w-130-px">{{'RANK' | translate}} </span>{{pos.rank}}</td>
                                                        <td><span class="scope-col w-130-px">{{active === 1 ? 'STAKE_POWER' : 'ACTIVE_STAKE_SHARE' | translate}} </span>{{active === 1 ? pos.active_stake_power : pos.active_stake_share}}</td>
                                                        <td class="d-flex d-lg-table-cell align-items-center pl-lg-0">
                                                            <span class="scope-col w-130-px">{{'NAME' | translate}} </span>
                                                            <a ng-href="#!/pos-contract/{{pos.pos_id}}" class="d-flex align-items-center text-wrap">
                                                                <div ng-if="posLogo['pos_' + pos.pos_id].logo.logoImg !== undefined" class="logo-from-img-small mr-1" ng-style="{'background-image':'url(' + posLogo['pos_' + pos.pos_id].logo.logoImg + ')'}"></div>                                                                
                                                                <div ng-if="posLogo['pos_' + pos.pos_id].logo.logoImg === undefined" class="item-avatar-blank-wrapper-small d-flex align-items-center justify-content-center mr-1 flex-shrink-0 flex-grow-0 item-avatar-blank-content-small">                                                                    
                                                                    <div class="logo-from-capital-small">{{posNames[pos.pos_id].charAt(0)}}</div>           
                                                                </div>
                                                                <span class="text-break">{{posNames[pos.pos_id]}}</span>
                                                            </a>
                                                        </td>
                                                        <td class="fit"><span class="scope-col w-130-px">POS id </span><a ng-href="#!/tx/{{pos.pos_id}}">{{pos.pos_id}}</a></td>
                                                        <td class="fit"><span class="scope-col w-130-px">{{'OWNER' | translate}} </span><a ng-href="#!/account/{{pos.owner}}">{{pos.ownersTag !== undefined ? pos.ownersTag : pos.owner}}</a></td>
                                                        <td><span class="scope-col w-130-px">{{'STAKE' | translate}} </span><span class="text-nowrap">{{pos.stake | US_COMMAS_BIGINT_DECIMALS : mainToken.decimals : 2}} {{mainToken.ticker}}</span></td>
                                                        <td><span class="scope-col w-130-px">{{'PROVIDER_FEE' | translate}} </span>{{pos.fee}}</td>
                                                        <td><span class="scope-col w-130-px text-nowrap">{{'PERFORMANCE' | translate}} </span>{{pos.uptime}}</td>
                                                        <td><span class="scope-col w-130-px">{{'ROI' | translate}} </span>{{pos.roi | US_COMMAS_2}}%</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div> <!-- end card-body-->
                            </div> <!-- end card-->
                        </div> <!-- end col-->
                    </div>
                </script>                                              

                <script type="text/ng-template" id="posContract">
                    <div class="row pt-3">
                        <div class="modal fade" id="qrPOSOwnerModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="qrPOSOwnerCode"></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>
                        <div class="modal fade" id="qrPOSIDModal" tabindex="-1" role="dialog" style="display: none;" >
                            <div class="modal-dialog modal-sm modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-body">
                                        <div class="row justify-content-center" id="qrPOSIDCode"></div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div>                        
                        <div class="col-12" ng-include="'views/partials/pos-details-main-info.html'"></div>
                        <div class="col-12" ng-include="'views/partials/pos-details-tabs.html'"></div>                        
                    </div>                    
                </script>

                <script type="text/ng-template" id="roi">
                    <div class="row pt-3">
                        <div class="col-12">
                            <ul class="nav nav-pills bg-nav-pills nav-justified">
                                <li class="nav-item">
                                    <a href="javascript;" data-target="#poaCalculatorTab" data-toggle="tab" aria-expanded="true" class="nav-link rounded-0 collapsed active">
                                        <span class="d-block">PoA</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="javascript;" data-target="#powCalculatorTab" data-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                        <span class="d-block">PoW</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="javascript;"  data-target="#posCalculatorsTab" data-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                        <span class="d-block">PoS</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-content justify-content-center mt-3">
                        <div class="tab-pane row show active justify-content-center" id="poaCalculatorTab" ng-include="'views/partials/poa-calculator-tab.html'"></div>
                        <div class="tab-pane fade row" id="powCalculatorTab" ng-include="'views/partials/pow-calculator-tab.html'" ng-init="powCalc.calculate();"></div>
                        <div class="tab-pane fade row" id="posCalculatorsTab" ng-include="'views/partials/pos-calculators-tab.html'"></div>
                    </div>
                </script>
                <script type="text/ng-template" id="tokenROI">
                    <div class="row pt-3">
                        <div class="col-12" ng-include="'views/partials/custom-token-roi-calc.html'"></div> 
                    </div>                       
                </script>
                <script type="text/ng-template" id="dropFarms">
                    <div class="col-12" ng-include="'views/partials/all-drops-farms-tabs.html'"></div>
                </script>
                <script type="text/ng-template" id="enexPools">
                    <div class="col-12" ng-include="'views/partials/enex-pools.html'"></div>
                </script>                    
            </div>

            <!-- container -->
        </div>
        <!-- content -->
        <!-- Footer Start -->
        <footer class="pb-3" style="font-size:11px; background: #fafbfe;">
            <div class="container">
                <div class="row justify-content-center" ng-if="showTestNetDisclaimer">
                    <div class="col-12 text-center mb-3">
                        {{'TESTNET_DISCLAIMER' | translate}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-12 mb-2" >
                        <div>
                            Enecuum Network Ltd.<br/>                            
                            © 2021 Enecuum Network Ltd. · <a href="https://enecuum.com/docs/privacy.pdf" target="_blank">{{'PRIVACY_POLICY' | translate}}</a> · <a href="https://enecuum.com/docs/terms.pdf" target="_blank">{{'TERMS' | translate}}</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-12 d-flex justify-content-center justify-content-md-end mt-2">
                        <div class="text-xl-right footer-links footer-social">
<!--                             <a class="mr-2" href="https://www.facebook.com/enecuum.EN/?ref=bookmarks" target="_blank">
                                <i class="fab fa-facebook-f"></i>
                            </a> -->
                            <a class="mr-2" href="https://twitter.com/enq_enecuum" target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a class="mr-2" href="https://blog.enecuum.com/" target="_blank">
                                <i class="fab fa-medium-m"></i>
                            </a>
                            <a class="mr-2" href="https://github.com/Enecuum" target="_blank">
                               <i class="fab fa-github"></i>
                            </a>
                            <a class="mr-2" href="https://hub.forklog.com/companies/enecuum/" target="_blank">
                                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                     viewBox="205 347 107 127" width="19" height="30"  xml:space="preserve">
                                      <style>
                                        .st0 {
                                            fill: #778796;
                                        }
                                      </style>
                                                        <path class="st0" d="M279.7,407.7c-0.4-0.4-0.6-0.7-0.9-0.9c-2.7-2.6-5.4-5.3-8.1-7.9c-0.3-0.3-0.7-0.7-1-1.1
                                    c-0.5-0.6-0.5-1.5-0.1-2.2c0.4-0.8,1.1-1.3,2-1.4c0.4-0.1,0.8-0.1,1.2-0.1c3.7,0,7.3,0,11,0.1c2.6,0.1,5,1.1,6.8,3
                                    c5.4,5.4,10.7,10.8,16.1,16.2c0.6,0.6,1.2,1.3,1.7,2.1c0.8,1.2,0.9,2.8,0.2,4.1c-0.5,0.8-1,1.6-1.7,2.3c-2.3,2.3-4.6,4.6-6.9,6.9
                                    c-3,3.1-6.1,6.1-9.1,9.2c-1.3,1.3-2.9,2.3-4.6,2.7c-0.8,0.2-1.7,0.4-2.6,0.4c-2.4,0-4.7,0-7.1-0.1c-1.4-0.1-2.9-0.1-4.3-0.1
                                    c-0.6,0-1.3-0.2-1.8-0.6c-1-0.6-1.2-1.9-0.6-2.9c0,0,0.1-0.1,0.1-0.1c0.3-0.5,0.7-0.9,1.1-1.3c2.1-2.1,4.2-4.1,6.2-6.2
                                    c0.7-0.8,1.4-1.5,2.2-2.1c0.1-0.1,0.2-0.3,0.1-0.4c0-0.2-0.2-0.3-0.4-0.3c-0.9-0.1-1.8-0.1-2.6-0.1c-2.4,0-4.7,0-7.1-0.1
                                    c-5-0.1-9.8-1.2-14.4-3.2c-3.4-1.5-6.6-3.3-9.7-5.3c-3.4-2.2-6.6-4.6-9.8-7c-3.1-2.3-6.3-4.5-9.4-6.7c-3.6-2.5-7.6-4.3-11.9-5.1
                                    c-2.4-0.5-4.8-0.7-7.2-0.6c-3.2,0.1-6.4,0.1-9.7,0c-1.6,0-3.1-0.1-4.7-0.2c-0.5,0-0.6-0.2-0.5-0.6c0-0.4,0.1-0.7,0.2-1.1
                                    c0.6-2.7,0.8-5.5,0.7-8.3c0-2.3-0.3-4.5-0.8-6.7c-0.3-1.6-0.3-1.6,1.3-1.7c3-0.1,6-0.2,9,0c1.3,0.1,2.6,0.2,4,0.2
                                    c4.3,0,8.6-0.8,12.6-2.4c3.9-1.6,7.5-3.7,10.9-6.1c2.4-1.7,4.6-3.6,6.9-5.4c4.7-3.8,9.8-7,15.2-9.6c2.8-1.3,5.8-2.4,8.8-3.3
                                    c5.6-1.6,11.4-2.2,17.2-1.7c0.4,0,0.7,0,1.1,0c0.1,0,0.2-0.1,0.2-0.2c0-0.1,0-0.2-0.1-0.3c-2.6-2.3-4.7-5-7.4-7.2
                                    c-0.6-0.5-1.2-1.1-1.6-1.8c-0.8-1.3-0.9-3-0.3-4.4c0.1-0.2,0.3-0.3,0.5-0.3c0.2,0,0.5,0,0.7,0c4.6,0,9.2,0,13.8,0
                                    c0.6,0,1.3,0.2,1.8,0.6c2.9,2.2,5.6,4.6,8.2,7.1c3,3,5.9,6.1,8.8,9.1c1,1,2,2,3,3c0.6,0.6,1.2,1.2,1.6,1.9c0.9,1.3,0.9,3,0.1,4.3
                                    c-0.5,0.9-1.2,1.7-2,2.4c-2.1,2.1-4.2,4.3-6.4,6.4c-3.2,3.2-6.4,6.4-9.6,9.6c-1.4,1.5-3.3,2.5-5.4,2.8c-0.6,0.1-1.2,0.1-1.8,0.1
                                    c-3.4,0-6.8-0.1-10.1-0.1c-0.6,0-1.2-0.1-1.8-0.1c-0.6-0.1-1.2-0.4-1.6-0.9c-0.7-0.8-0.8-2-0.1-2.8c0.2-0.3,0.5-0.6,0.8-0.9
                                    c2.7-2.7,5.4-5.3,8.1-8c0.2-0.2,0.5-0.5,0.7-0.7c0.1-0.1,0-0.3-0.1-0.3c0,0-0.1,0-0.1,0c-0.1,0-0.2-0.1-0.4-0.1
                                    c-3.2-0.3-6.3-0.3-9.5,0c-3.8,0.4-7.4,1.6-10.7,3.4c-2.8,1.6-5.5,3.4-8.1,5.4c-3.1,2.3-6.2,4.6-9.3,6.9c-0.6,0.5-1.3,0.9-2,1.4
                                    c-1.6,1.1-1.6,1.6,0,2.7c0.9,0.6,1.7,1.2,2.6,1.8c4.9,3.4,9.7,6.9,14.6,10.3c3.6,2.6,7.7,4.2,12.1,4.8c2.8,0.4,5.6,0.5,8.4,0.3
                                    c0.6-0.1,1.2-0.1,1.8-0.1C278.9,408,279.3,407.9,279.7,407.7z"/>
                                </svg>
                            </a>
                            <a class="mr-2" href="https://bitcointalk.org/index.php?topic=2939909.0;topicseen" target="_blank">
                                <i class="fab fa-btc"></i>
                            </a>
                            <a class="mr-2" href="https://www.linkedin.com/company/enecuum-limited/" target="_blank">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a class="mr-2" href="https://www.youtube.com/channel/UCyZqNfzK_PP82nkAVOlmN4Q" target="_blank">
                                <i class="fab fa-youtube"></i>
                            </a>
                            <a class="mr-2" href="https://qm.qq.com/cgi-bin/qm/qr?k=YfdokyjJnlKl0eAuhVXEc6JtVsoKnxvI&authKey=6WpHwP4Cu/kAAyPyVuBWZeQCjhEyijvLyGf6Jj6P7f9LVCe/9ZZC7YIfRtudjD23&noverify=0" target="_blank">
                                <i class="fab fa-qq"></i>
                            </a>
                            <a class="mr-2" href="https://weixin.qq.com/g/AwYAAJdSThUYHIJmetSinRGfcwtrkRovBmLZZr5moi0UXRIW56Me4ts56gByaeYU" target="_blank">
                                <i class="fab fa-weixin"></i>
                            </a>   
                            <div class="d-inline cursor-pointer">
                                <i class="fab fa-telegram-plane dropdown-toggle" id="tlg-items" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
                                <div id="dropdownTelegramForFooter" class="popup dropdown-menu dropdown-menu-right" aria-labelledby="tlg-items">
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Enecuum" target="_blank">Russian</a>
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Enecuum_EN" target="_blank">English</a>
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Enecuum_ArabicWorld" target="_blank">Arabic</a>
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Enecuum_Persian" target="_blank">Persian</a>
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Enecuum_Espanol" target="_blank">Spanish</a>
                                    <a rel="nofollow" class="dropdown-item" href="https://t.me/Turkey_ENQ" target="_blank">Turkish</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end Footer -->
    </div>

    <!-- ============================================================== -->
    <!-- End Page content -->
    <!-- ============================================================== -->
    <div ng-include="'cookies-alert.html'"></div>


<!-- END wrapper -->

<script>

	let app = angular.module('myApp', ['ngResource', 'ngRoute', 'ngCookies', 'pascalprecht.translate','ngAnimate', 'ui.select','ngSanitize'])
        .constant('GLOBAL_APP_CONFIG', explorerConfig);

    app.config(function ($translateProvider) {
        $translateProvider
            .useStaticFilesLoader({
                prefix: '/locales/local-',
                suffix: '.json'
            })
            // remove the warning from console log by putting the sanitize strategy
            .useSanitizeValueStrategy('escapeParameters')
            .preferredLanguage('en');
        $translateProvider.fallbackLanguage(['en']);
    });

    app.config(['uiSelectConfig', function(uiSelectConfig) {
        uiSelectConfig.theme = 'select2';
    }]);

	app.config(function ($routeProvider) {
		$routeProvider.when('/page/:page_num', {
			templateUrl: 'page',
			controller: 'pagesCtrl'
		}).when('/macroblock/:hash', {
			templateUrl: 'macroblock',
			controller: 'macroblockCtrl'
		}).when('/mblock/:hash', {
            templateUrl: 'mblock',
            controller: 'mblockCtrl'
        }).when('/sblock/:hash', {
            templateUrl: 'sblock',
            controller: 'sblockCtrl'
        }).when('/map', {
			templateUrl: 'map'
		}).when('/account/:id/:old_postfix?', {
			templateUrl: 'account',
			controller: 'accountCtrl'
		}).when('/tx/:hash', {
			templateUrl: 'transaction',
			controller: 'transactionCtrl'
		}).when('/map', {
			templateUrl: 'map',
			controller: 'mapCtrl'
		}).when('/tops', {
            controller: 'topsCtrl',
            templateUrl: 'tops'
        }).when('/tokens', {
            controller: 'tokensCtrl',
            templateUrl: 'tokens'
        }).when('/pos-contracts', {
            controller: 'posContractsCtrl',
            templateUrl: 'posContracts'
        }).when('/pos-contract/:pos_id', {
            controller: 'posContractCtrl',
            templateUrl: 'posContract'
        }).when('/token/:hash', {
            controller: 'tokenCtrl',
            templateUrl: 'token'
        }).when('/roi', {
            controller: 'roiCtrl',
            templateUrl: 'roi'
        }).when('/token-roi', {
            controller: 'tokenROICtrl',
            templateUrl: 'tokenROI'
        }).when('/drop-farms', {
            controller: 'dropFarmsCtrl',
            templateUrl: 'dropFarms'
        }).when('/enex-pools', {
            controller: 'enexPoolsCtrl',
            templateUrl: 'enexPools'
        })
        .otherwise({
            templateUrl: 'home',
            controller: 'homeCtrl'
        });
	});

    app.service('validator', function() {
        this.checkValidDigitalValue = function(value) {
            return (value !== null && value !== undefined && !Number.isNaN(value)) ? true : false;
        }
        this.isInteger =  function(dataObj) {
            if ((typeof dataObj.value !== 'undefined') && dataObj.value !== null && dataObj.value !== isNaN) {
                Number.isInteger = Number.isInteger || function(value) {
                  return typeof value === 'number' && 
                    isFinite(value) && 
                    Math.floor(value) === value;
                };
                return Number.isInteger(dataObj.value);
            }
        }
    });

    app.factory('dataValidator', function($translate) {
        return {
            isSet: function(dataObj) {            
                return ((typeof dataObj.data !== 'undefined') && dataObj.data !== null && dataObj.data !== '') ? true : false
            },
            strExeedMaxLength: function(dataObj) {
                if ((typeof dataObj.dataStr === 'string') && (typeof dataObj.maxLength === 'number') && (dataObj.maxLength ^ 0) === dataObj.maxLength) {
                    return (dataObj.dataStr.length > dataObj.maxLength) ? true : false;
                } else
                    return null;
            },
            isInArray: function(dataObj) {
                if ((typeof dataObj.data !== 'undefined') && dataObj.data !== null && Array.isArray(dataObj.dataArray)) {
                    return (dataObj.dataArray.indexOf(dataObj.data) !== -1) ? true : false;               
                } else
                    return null;
            },
            testTheRegExp: function(dataObj) {
                if ((typeof dataObj.str !== 'undefined') && dataObj.str !== null) {
                    return dataObj.regExpObj.test(dataObj.str);               
                } else
                    return null;
            },
            execTheRegExp: function(dataObj) {
                if ((typeof dataObj.str !== 'undefined') && dataObj.str !== null) {
                    let resultArr = dataObj.regExpObj.exec(dataObj.str);
                    return !(resultArr == null || resultArr[0] == "");               
                } else
                    return null;
            },
            moreThan: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.max !== 'undefined') && dataObj.max !== null)) {
                    return (dataObj.value > dataObj.max) ? true : false;               
                } else
                    return null;
            },
            moreOrEqualThan: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.max !== 'undefined') && dataObj.max !== null)) {
                    return (dataObj.value >= dataObj.max) ? true : false;               
                } else
                    return null;
            },
            lessThan: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.max !== 'undefined') && dataObj.max !== null)) {
                    return (dataObj.value < dataObj.max) ? true : false;               
                } else
                    return null;
            },
            lessOrEqualThan: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.max !== 'undefined') && dataObj.max !== null)) {
                    return (dataObj.value <= dataObj.max) ? true : false;               
                } else
                    return null;
            },
            inIntervalBothClosed: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.min !== 'undefined') && dataObj.min !== null) && ((typeof dataObj.max !== 'undefined') && dataObj.max !== null)) {
                    return (dataObj.value >= dataObj.min && dataObj.value <= dataObj.max) ? true : false;               
                } else
                    return null;
            },
            matchToFixed: function(dataObj) {
                if (((typeof dataObj.value !== 'undefined') && dataObj.value !== null) && ((typeof dataObj.n !== 'undefined') && dataObj.n !== null)) {
                   dataObj.n*=1;
                   let decimalPart = dataObj.value.toString().replace(/,/g, '.').split('.')[1];
                    return (decimalPart === undefined || decimalPart.length <= dataObj.n) ? true : false;                           
                } else
                    return null;            
            },
            isInteger:  function(dataObj) {
                if ((typeof dataObj.value !== 'undefined') && dataObj.value !== null) {
                    Number.isInteger = Number.isInteger || function(value) {
                      return typeof value === 'number' && 
                        isFinite(value) && 
                        Math.floor(value) === value;
                    };
                    return Number.isInteger(dataObj.value);
                }
            },
            batchValidate: function(validateObj, rulesObject) {
                let that = this
                let dataValid = true;
                let propsErr = {};
                for (prop in rulesObject) {
                    propsErr[prop] = 0;
                    if (validateObj.hasOwnProperty(prop)) {
                        $(rulesObject[prop].errMsgSelector).hide();
                        rulesObject[prop].checks.forEach(function(check) {
                            let requireToCheck = rulesObject[prop].requireToCheck;
                            if (requireToCheck === true || requireToCheck === undefined) {                       
                                if (propsErr[prop] === 0 && (check.requireToCheck === true || check.requireToCheck === undefined)) {
                                    let method = check.method,
                                        argObj = check.args,
                                        desiredResult = check.desiredResult,
                                        errMsg = check.errMsg,
                                        result = that[method](argObj),
                                        selector = rulesObject[prop].errMsgSelector;

                                    if (desiredResult !== result) {
                                        $translate(errMsg.msg || errMsg, errMsg.params).then(function(msg) {
                                            $(selector).show();
                                            $(selector).text(msg);
                                        });
                                        propsErr[prop]++;
                                        dataValid = false;
                                    }
                                }
                            }
                        });
                    }
                }
                return dataValid;
            }
        }
    });

    app.factory('customerInfoStorage', function($window, $rootScope, $http, GLOBAL_APP_CONFIG, $resource, $q) {
        let currentPreset = GLOBAL_APP_CONFIG.tokenName.toLowerCase();
        let storagePath = 'info';
        let models = {
            account: {
                tag: undefined
            },
            pos: {
                website: undefined,
                media: undefined,
                description: undefined,
                logoURL: undefined
            },
            token: {
                website: undefined,
                media: undefined,
                documents: undefined,
                description: undefined,
                coingecko_id: undefined,
                logoURL: undefined
            }
        }

        function typeIsValid(type) {
            return models.hasOwnProperty(type.toLowerCase());
        }

        function getStorageURL(type) {
            if (typeIsValid(type)) {
                return '/' + storagePath + '/' + (type +'-info-storage-' + currentPreset + '.json');                
            } else {
                console.log('Warning: "' + type + '" is invalid type of customer\'s info storage!');
                return undefined;
            }
        }

        function getLogoPath(type) {
            return storagePath + '/' + type + '/' + 'logo' + '/' + currentPreset;           
        }

        let getStorage = function(type='token') {
            let infoStorageURL = getStorageURL(type);
            return $resource(infoStorageURL, {query: {method: 'GET', isArray: true}});
        }

        let populateInfo = function(res, hash, type=undefined) {
            let info = res.find(infoBlock => infoBlock[type + '_id'] === hash);             
            if (info === undefined)
                info = models[type];
            else if (info.logo !== undefined) {
                let logoPath = getLogoPath(type);
                info.logoURL = info.logo !== undefined ? (logoPath + '/' + info.logo) : undefined;
            }

            return info;
        }

        let assignLogo = function(scope, entityName, logoURL) {
            scope[entityName].customerInfo.logoImg = undefined;
            if (scope[entityName].customerInfo.logoURL !== undefined) {                                        
                $http({method: 'GET', url: scope[entityName].customerInfo.logoURL, responseType: 'blob'}).
                then(function (logo) {                            
                    let file = logo.data;
                    if (file) {
                        let reader  = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = function() {
                            scope[entityName].customerInfo.logoImg = reader.result;
                            scope.$apply();
                        };
                        reader.onerror = function() {
                            scope[entityName].customerInfo.logoURL = undefined;
                            console.log(reader.error);
                        };
                    }
                })
                .catch(function(error) {
                    scope[entityName].customerInfo.logoURL = undefined;
                    console.log("Failed to load " + entityName + "'s logo. Error status: " + error.status + "(" + error.statusText + ")");
                })                        
            }
        }

        return {
            getStorage: getStorage,
            getInfo: function(type, hash) {
                let deferred = $q.defer();
                getStorage(type).query({}, function(res) {
                    let data = res;
                    deferred.resolve(populateInfo(data, hash, type));
                }, function(error) {                   
                    deferred.reject(populateInfo([], hash));
                });
                return deferred.promise;
            },
            getLogoPath: getLogoPath,
            assignLogo: assignLogo
        }
    });    

    app.factory('Toast', function($translate) {
        return {
            stakeErrorToast : function(msg) {
                $.toast({
                    heading: 'Error',
                    text: msg,
                    icon: 'error',
                    hideAfter: 5000,
                    stack: 3,
                    position: 'top-right',
                    loader: false
                })                
            },
            stakeInfoToast : function(msg) {
                $.toast({
                    heading: 'Info',
                    text: msg,
                    icon: 'info',
                    hideAfter: 5000,
                    stack: 3,
                    position: 'top-right',
                    loader: false
                })                
            },
            info : function(msg) {
                $.toast({
                    heading: 'Info',
                    text: msg,
                    icon: 'info',
                    hideAfter: 5000,
                    stack: 3,
                    position: 'top-right',
                    loader: false
                })                
            }
        }
    });    

    app.service('dateTimeConverter', function() {
        this.getTimestamp = function(unix){
            return (new Date(unix * 1000)).toLocaleString()
        };
        this.dateTimeStringToLocale = function(dateTimeString){
            return (new Date(dateTimeString)).toLocaleString();
        };
    });

    app.service('currencyExchange', function($filter, validator, commonTools) {
        this.convertValue = function(value, rate) {
            return (validator.checkValidDigitalValue(value) && validator.checkValidDigitalValue(rate)) ? value * rate : '---';
        }

        this.bigIntConvertValueToCurrency = function(value_in_BigInt, rate_in_Numbers, valueDecimals, toFixed) {
            if (value_in_BigInt !== undefined) {
                let decimalPart =  rate_in_Numbers.toString().split('.')[1];             
                let rateDecimals = decimalPart !== undefined ? decimalPart.length : 0;
                let totalDecimals = rateDecimals + valueDecimals;
                let bigIntRate = commonTools.valueToBigInt(rate_in_Numbers, rateDecimals).value;
                let mult = this.convertValue(BigInt(value_in_BigInt), bigIntRate);
                return $filter('US_COMMAS_BIGINT_DECIMALS')(mult, totalDecimals, toFixed);
            } else
                return '---';
        }
    });

    app.factory('roiCalc', function ($filter, currencyExchange) {
        function lerp(y0, y1, x0, x1, y) {
            return (x0 + ((y - y0) / (y1 - y0)) * (x1 - x0))
        };

        function stakeToROI(stake, roiArr) {            
            for (let i = 0; i < roiArr.length; i++) {
                if(stake === roiArr[i].stake){
                    return roiArr[i].roi;
                }
                else if(stake < roiArr[i].stake){
                    return lerp(roiArr[i-1].stake, roiArr[i].stake, roiArr[i-1].roi, roiArr[i].roi, stake)
                }
            }
            return 0;            
        }

        function batchConvertToCurr(value, ratesObj) {
            let result = [];            
            ratesObj.forEach(function(currency) {
                let commasFormatter = new Intl.NumberFormat("en-us", {
                    useGrouping: true,
                    minimumFractionDigits: currency.toFixed,
                    maximumFractionDigits: currency.toFixed
                });
                result.push({
                    name: currency.ticker,
                    value: commasFormatter.format(currencyExchange.convertValue(value, currency.rate)) + ' ' + currency.ticker
                });
            });
            return result;
        }

        let getPOA_ROIs = function(poaROIData) {
            let roiData = [];
            let tokenFactor = Math.pow(10, poaROIData.stakeDecimals);
            if(!poaROIData.roiArrForLerp.length || isNaN(poaROIData.stake))
                return roiData;

            let stake = poaROIData.stake * tokenFactor;
            let roi = stakeToROI(stake, poaROIData.roiArrForLerp);
            let ratio = ((roi - stake) / stake);            
            ratio += ratio * poaROIData.factorIfReferral;            

            poaROIData.periods.forEach(function(period, index, array) {
                let value = (stake * ratio * period.daysFactor) / tokenFactor;
                roiData[index] = {
                    period : period.titleInLocale,
                    roi : "+ " + commasFormatter2Decimals.format(ratio * 100 * period.daysFactor) + " %",
                    values : batchConvertToCurr(value, poaROIData.currencyInfo)
                };
            });
            return roiData
        }

        return {
            getPOA_ROIs : getPOA_ROIs
        };                
    });

    app.factory('contractFormatter', function ($filter, provider, contractSchemes, commonTools, GLOBAL_APP_CONFIG) {        

        function getTxDataFormatter(contractScheme) {            
            let formatters = {
                create_token : function(txData, contractScheme) {
                    contractScheme.paramsOrder.splice(2, 0, "token_type");                 
                    txData.parameters.decimals = parseInt(txData.parameters.decimals);
                    txData.parameters.token_type = commonTools.getTokenType(txData.parameters);
                    let res = {}
                    if (txData.parameters.fee_type === 2)
                        res = commonTools.getTokenFees(txData.parameters, txData.maintoken);
                    else
                        res = commonTools.getTokenFees(txData.parameters);

                    txData.parameters.fee_type = res.fee_type.toUpperCase();
                    txData.parameters.fee_value = res.fee_value;
                    txData.parameters.fee_min = res.fee_min;
                    txData.parameters.ref_share = amountInUnits(txData.parameters.ref_share, 2, 2, '%');
                    contractScheme.asToken.forEach(function(param) {                   
                        txData.parameters[param] = amountInUnits(txData.parameters[param], txData.parameters.decimals, txData.parameters.decimals, txData.parameters.ticker);
                    });                    
                },
                create_pos : function(txData) {
                    txData.parameters.fee = amountInUnits(txData.parameters.fee, 2, 2, '%');
                },
                delegateUndelegate : function(txData, contractScheme) {
                    contractScheme.asToken.forEach(function(param) {                
                        txData.parameters[param] = amountInUnits(txData.parameters[param], txData.txToken.decimals, txData.txToken.decimals);
                        txData.parameters[`${param}_token_ticker`] = txData.txToken.ticker;
                        txData.parameters[`${param}_token_decimals`] = txData.txToken.decimals;
                        txData.parameters[`${param}_token_hash`] = txData.txToken.hash;
                        txData.parameters.amount_token_link = `#!/token/${txData.txToken.hash}`;                                                
                    });
                },
                mintBurn : function(txData, contractScheme) {
                    let assetsList = {
                        amount : 'token_hash' //Prop name - parameter in some token ('amount' as usually). Prop value - parameter in data, which is hash of this token (token_hash in this case).
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);                    
                },
                pool_create : function(txData, contractScheme) {
                    let assetsList = {
                        amount_1 : 'asset_1',
                        amount_2 : 'asset_2'
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    populatePoolToken(txData);                    
                },
                farmGetRewardCloseStake : function(txData) {
                    provider.get_dex_farms.query({farms: txData.parameters.farm_id}, function(farmDataArr) {
                        let farmData = farmDataArr[0];
                        populateFarmsTokensData(txData, farmData);                                 
                    });
                },
                pool_add_liquidity : function(txData, contractScheme) {
                    let assetsList = {
                        amount_1 : 'asset_1',
                        amount_2 : 'asset_2'
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    populatePoolToken(txData);                    
                },
                pool_remove_liquidity : function(txData, contractScheme) {
                    let assetsList = {
                        amount : 'lt'
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    populateAssets(txData);
                },               
                pool_swap : function(txData, contractScheme) {
                    let assetsList = {
                        amount_in : 'asset_in'
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    provider.token_info.query({hash:txData.parameters.asset_out}, function(token_info) {
                        txData.parameters.asset_out_token_ticker = token_info[0].ticker;
                        txData.parameters.asset_out_token_decimals = token_info[0].decimals;
                    });                   
                },               
                pool_sell_exact : function(txData, contractScheme) {
                    let assetsList = {
                        amount_in : 'asset_in',
                        amount_out_min : "asset_out"
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    provider.token_info.query({hash:txData.parameters.asset_out}, function(token_info) {
                        txData.parameters.asset_out_token_ticker = token_info[0].ticker;
                        txData.parameters.asset_out_token_decimals = token_info[0].decimals;
                    });                   
                },               
                pool_sell_exact_routed : function(txData, contractScheme) {                    
                    let targetAssetIndex = Number(txData.parameters.plength)-1;
                    let assetsList = {
                        amount_in : 'asset0',
                        amount_out_min : `asset${targetAssetIndex}`
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    txData.parameters.routeTickers = [];
                    for (let i = 1; i < targetAssetIndex; i++) {
                        provider.token_info.query({hash:txData.parameters[`asset${i}`]}, function(token_info) {
                            txData.parameters.routeTickers[i] = {                                
                                ticker : token_info[0].ticker
                            }
                        });
                    }

                    provider.token_info.query({hash:txData.parameters[`asset${targetAssetIndex}`]}, function(token_info) {
                        txData.parameters.asset_out_token_ticker = token_info[0].ticker;
                        txData.parameters.asset_out_token_decimals = token_info[0].decimals;
                    });                  
                },               
                pool_buy_exact : function(txData, contractScheme) {
                    let assetsList = {
                        amount_in_max : 'asset_in',
                        amount_out    : "asset_out"
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    provider.token_info.query({hash:txData.parameters.asset_out}, function(token_info) {
                        txData.parameters.asset_out_token_ticker = token_info[0].ticker;
                        txData.parameters.asset_out_token_decimals = token_info[0].decimals;
                    });                   
                },
                pool_buy_exact_routed : function(txData, contractScheme) {                    
                    let targetAssetIndex = Number(txData.parameters.plength)-1;
                    let assetsList = {
                        amount_in_max  : 'asset0',
                        amount_out     : `asset${targetAssetIndex}`
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                    txData.parameters.routeTickers = [];
                    for (let i = 1; i < targetAssetIndex; i++) {
                        provider.token_info.query({hash:txData.parameters[`asset${i}`]}, function(token_info) {
                            txData.parameters.routeTickers[i] = {                                
                                ticker : token_info[0].ticker
                            }
                        });
                    }

                    provider.token_info.query({hash:txData.parameters[`asset${targetAssetIndex}`]}, function(token_info) {
                        txData.parameters.asset_out_token_ticker = token_info[0].ticker;
                        txData.parameters.asset_out_token_decimals = token_info[0].decimals;
                    });                  
                },  
                farm_create : function(txData, contractScheme) {
                    let assetsList = {
                        block_reward : 'reward_token',
                        emission     : 'reward_token'
                    }
                    populateListOfAmounts(txData, contractScheme, assetsList);
                },
                increaseDecreaseStake : function(txData) {
                    provider.get_dex_farms.query({farms: txData.parameters.farm_id}, function(farmDataArr) {
                        let farmData = farmDataArr[0]; 
                        if (farmData !== undefined) {
                            populateFarmsTokensData(txData, farmData);
                            txData.parameters.amount = amountInUnits(txData.parameters.amount, farmData.stake_token_decimals, farmData.stake_token_decimals);
                            txData.parameters.amount_token_ticker = farmData.stake_token_name;
                            txData.parameters.amount_token_link = `#!/token/${farmData.stake_token_hash}`;                           
                        }         
                    });
                },
                dexCmdDistribute : function(txData) {
                    provider.token_info.query({hash:txData.parameters.token_hash}, function(token_info) {
                        txData.parameters.token_ticker = token_info[0].ticker;
                    });
                },
                bridgeLock : function(txData) {
                    txData.dataEncode.formattedParameters = {};
                    txData.dataEncode.formattedParameters.dst_address = txData.dataEncode.dst_address;
                    let dstNetwork = GLOBAL_APP_CONFIG.networks.find(elem => elem.internalId === txData.dataEncode.dst_network);
                    if (dstNetwork !== undefined) {
                        txData.dataEncode.formattedParameters.dst_network = dstNetwork;
                        txData.dataEncode.formattedParameters.dst_address_link = `${dstNetwork.addressPageUrl}${txData.dataEncode.dst_address}`;
                    }
                    txData.dataEncode.formattedParameters.token_hash = txData.dataEncode.hash;
                    txData.dataEncode.formattedParameters.nonce = txData.dataEncode.nonce;
                    provider.token_info.query({hash:txData.dataEncode.hash}, function(token_info) {
                        txData.dataEncode.formattedParameters.token_ticker = token_info[0].ticker;
                        txData.dataEncode.formattedParameters.token_decimals = token_info[0].decimals;
                        txData.dataEncode.formattedParameters.amount = amountInUnits(txData.dataEncode.amount, token_info[0].decimals, token_info[0].decimals, token_info[0].ticker);
                        txData.dataEncode.formattedParameters.token_link = `#!/token/${txData.dataEncode.hash}`;
                    });
                },
                bridgeClaimInit : function(txData) {
                    txData.dataEncode.formattedParameters = {};
                    txData.dataEncode.formattedParameters.dst_address = txData.dataEncode.dst_address;
                    txData.dataEncode.formattedParameters.token_ticker = txData.dataEncode.ticker;
                    txData.dataEncode.formattedParameters.token_name = txData.dataEncode.name; 
                    
                    let originNetwork = GLOBAL_APP_CONFIG.networks.find(elem => elem.internalId === txData.dataEncode.origin_network);
                    if (originNetwork !== undefined) {
                        txData.dataEncode.formattedParameters.origin_network = originNetwork;
                        txData.dataEncode.formattedParameters.origin_hash = txData.dataEncode.origin_hash;
                        if (originNetwork.type === 'enq')
                            txData.dataEncode.formattedParameters.origin_link = `#!/token/${txData.dataEncode.origin_hash}`;                            
                        else
                            txData.dataEncode.formattedParameters.origin_link = `${originNetwork.addressPageUrl}${txData.dataEncode.origin_hash}`;                          
                    }

                    txData.dataEncode.formattedParameters.src_address = txData.dataEncode.src_address;
                    txData.dataEncode.formattedParameters.src_hash = txData.dataEncode.src_hash;
                    let srcNetwork = GLOBAL_APP_CONFIG.networks.find(elem => elem.internalId === txData.dataEncode.src_network);
                    txData.dataEncode.formattedParameters.src_network = srcNetwork;
                    if (srcNetwork !== undefined) {
                        if (srcNetwork.type === 'enq') {
                            txData.dataEncode.formattedParameters.src_address_link = `#!/account/${txData.dataEncode.src_address}`;
                            txData.dataEncode.formattedParameters.token_link = `#!/token/${txData.dataEncode.src_hash}`;
                        } else {
                            txData.dataEncode.formattedParameters.src_address_link = `${srcNetwork.addressPageUrl}${txData.dataEncode.src_address}`;
                            txData.dataEncode.formattedParameters.token_link = `${srcNetwork.addressPageUrl}${txData.dataEncode.src_hash}`;
                        }                       
                    }

                    let dstNetwork = GLOBAL_APP_CONFIG.networks.find(elem => elem.internalId === txData.dataEncode.dst_network);
                    if (dstNetwork !== undefined) {
                        txData.dataEncode.formattedParameters.dst_network = dstNetwork;
                        txData.dataEncode.formattedParameters.dst_address_link = `${dstNetwork.addressPageUrl}${txData.dataEncode.dst_address}`;
                    }
                    let decimals = txData.dataEncode.origin_decimals;
                    if (txData.dataEncode.origin_decimals > 10)
                        decimals = 10;

                    txData.dataEncode.formattedParameters.amount = amountInUnits(txData.dataEncode.amount, decimals, decimals, txData.dataEncode.ticker);
                    txData.dataEncode.formattedParameters.nonce = txData.dataEncode.nonce;
                    txData.dataEncode.formattedParameters.ticket_hash = txData.dataEncode.ticket_hash;
                },
                default : function(txData, contractScheme) {                    
                    if (!contractScheme.hasOwnProperty(txData.type)) {
                        contractScheme.paramsOrder = [];
                        for (key in txData.parameters) {
                            contractScheme.paramsOrder.push(key);
                        }
                        console.log(`Default formatter for '${txData.type}' contract`);                        
                    }                   
                }
            }

            return formatters.hasOwnProperty(contractScheme.formatAs) ? formatters[contractScheme.formatAs] : formatters.default
        }

        function populateFarmsTokensData(txData, farmData) {
            txData.parameters.stake_token = {
                ticker : farmData.stake_token_name,
                decimals : farmData.stake_token_decimals,
                hash : farmData.stake_token_hash
            };
            txData.parameters.reward_token = {
                ticker : farmData.reward_token_name,
                decimals : farmData.reward_token_decimals,
                hash : farmData.reward_token_hash
            };
        }

        function populateAssets(txData) {
            let lt = txData.parameters.lt; 
            provider.get_dex_pools.query(function(dexPooolsArr) {
                let poolByLt = dexPooolsArr.find(elem => elem.token_hash === lt);
                if (poolByLt !== undefined) {
                    txData.parameters.poolAssets = {
                        asset_1 : {
                            hash : poolByLt.asset_1
                        },
                        asset_2 : {
                            hash : poolByLt.asset_2
                        }
                    }

                    Object.keys(txData.parameters.poolAssets).forEach(function(elem) {
                        if (elem === 'asset_1' || elem === 'asset_2') {
                            provider.token_info.query({hash:txData.parameters.poolAssets[elem].hash}, function(token_info) {
                                txData.parameters.poolAssets[elem].decimals = token_info[0].decimals;
                                txData.parameters.poolAssets[elem].ticker = token_info[0].ticker;
                            });
                        }
                    });
                }
            });            
        }

        function populatePoolToken(txData) {
            let pairId = `${txData.parameters.asset_1}${txData.parameters.asset_2}`;
            provider.get_dex_pools.query(function(dexPooolsArr) {
                let poolByPair = dexPooolsArr.find(elem => elem.pair_id === pairId);
                if (poolByPair !== undefined) {
                    txData.parameters.poolToken = {
                        hash : poolByPair.token_hash
                    }
                    provider.token_info.query({hash:poolByPair.token_hash}, function(token_info) {
                        txData.parameters.poolToken.decimals = token_info[0].decimals;
                        txData.parameters.poolToken.ticker = token_info[0].ticker;
                    });                  
                }
            });
        }

        function populateListOfAmounts(txData, contractScheme, assetsList) {
            contractScheme.asToken.forEach(function(param) {           
                let token = {};
                provider.token_info.query({hash:txData.parameters[assetsList[param]]}, function(token_info) {
                    if (token_info[0] !== undefined) {
                        token.ticker = txData.parameters[`${param}_token_ticker`] = token_info[0].ticker;
                        token.decimals = txData.parameters[`${param}_token_decimals`] = token_info[0].decimals;
                        txData.parameters[`${param}_token_hash`] = txData.parameters[assetsList[param]];
                        txData.parameters[`${param}_token_link`] = `#!/token/${txData.parameters[assetsList[param]]}`;
                        txData.parameters[param] = amountInUnits(txData.parameters[param], token.decimals, token.decimals);                        
                    }
                });
            });
        }

        function filterUndefinedParams(txData, contractScheme) {
            contractScheme.paramsOrder.forEach(function(param,index, array) {               
                if (txData.parameters[param] === undefined || txData.parameters[param] === null) {
                    array[index] = 'skip';
                    txData.parameters[param] = '---';
                    let tmpIndex = contractScheme.asToken.indexOf(param);
                    if (tmpIndex !== -1)
                        contractScheme.asToken.splice(tmpIndex,1);
                }
            });            
        }

        function amountInUnits(amount, decimals, toFixed, units=false) {
            let result = null;
            let addon = '';
            if (amount !== undefined && decimals !== undefined && toFixed !== undefined && units !== undefined) {
                if (units !== false) {
                    let unitsStr = (typeof amount === 'bigint' || !isNaN(amount) ? units : '');
                    addon = ' ' + unitsStr;
                }
                
                result = $filter('US_COMMAS_BIGINT_DECIMALS')(amount, decimals, toFixed) + addon;
            }
            return result;
        }

        function formatData(txData) {
            let contractScheme = contractSchemes.getScheme(txData.type);
            filterUndefinedParams(txData, contractScheme);
            let formatDataByScheme = getTxDataFormatter(contractScheme);
            formatDataByScheme(txData, contractScheme);
        }

        return {
            formatData : formatData
        }
    });

    app.factory('contractSchemes', function () {
        let contractsList = {
            create_token : {
                paramsOrder : ["ticker", "name", "total_supply", "max_supply", "block_reward", "min_stake", "referrer_stake", "ref_share", "decimals", "fee_type", "fee_value", "fee_min"],
                asToken     : ["total_supply", "max_supply", "block_reward", "min_stake", "referrer_stake"],
                formatAs    : 'create_token',
                template    : 'tx-create-token-contract',
                eindexer    : []
            },
            create_pos : {
                paramsOrder : ["name", "fee"],
                asToken     : [],
                formatAs    : 'create_pos',
                template    : 'default',
                eindexer    : []
            },
            delegate : {
                paramsOrder : ["pos_id", "amount"],
                asToken     : ["amount"],
                formatAs    : 'delegateUndelegate',
                template    : 'default',
                eindexer    : []
            },
            undelegate : {
                paramsOrder : ["pos_id", "amount"],
                asToken     : ["amount"],
                formatAs    : 'delegateUndelegate',
                template    : 'default',
                eindexer    : []
            },
            transfer : {
                paramsOrder : ["undelegate_id"],
                asToken     : [],
                formatAs    : 'default',
                template    : 'default',
                eindexer    : []
            },
            pos_reward : {
                paramsOrder : ["pos_id"],
                asToken     : [],
                formatAs    : 'default',
                template    : 'default',
                eindexer    : []
            },
            mint : {
                paramsOrder : ["amount"],
                asToken     : ["amount"],
                formatAs    : 'mintBurn',
                template    : 'default',
                eindexer    : []
            },
            burn : {
                paramsOrder : ["amount"],
                asToken     : ["amount"],
                formatAs    : 'mintBurn',
                template    : 'default',
                eindexer    : []
            },
            pool_create : {
                paramsOrder : ["asset_1", "amount_1", "asset_2", "amount_2"],
                asToken     : ["amount_1", "amount_2"],
                formatAs    : 'pool_create',
                template    : 'default',
                eindexer    : ["ipcreatelt"],
                eindexerTemlate : 'tx-pool-create-contract-eindexer' 
            },
            pool_add_liquidity : {
                paramsOrder : ["asset_1", "amount_1", "asset_2", "amount_2"],
                asToken     : ["amount_1", "amount_2"],
                formatAs    : 'pool_add_liquidity',
                template    : 'default',
                eindexer    : ['iliqaddlt'],
                eindexerTemlate : 'tx-pool-add-liquidity-contract-eindexer' 
            },
            pool_remove_liquidity : {
                paramsOrder : ["lt", "amount"],
                asToken     : ["amount"],
                formatAs    : 'pool_remove_liquidity',
                template    : 'default',
                eindexer    : ['iliqrmv1', 'iliqrmv2'],
                eindexerTemlate : 'tx-pool-remove-liquidity-contract-eindexer' 
            },
            pool_swap : {
                paramsOrder : ["asset_in", "amount_in", "asset_out"],
                asToken     : ["amount_in"],
                formatAs    : 'pool_swap',
                template    : 'tx-swap-contract',
                eindexer    : ['iswapout'],
                eindexerTemlate : 'tx-pool-swap-contract-eindexer'
            },
            pool_sell_exact : {
                paramsOrder : ["asset_in", "amount_in", "asset_out", "amount_out_min"],
                asToken     : ["amount_in", "amount_out_min"],
                formatAs    : 'pool_sell_exact',
                template    : 'tx-swap-contract',
                eindexer    : ['iswapout'],
                eindexerTemlate : 'tx-pool-swap-contract-eindexer'
            },
            pool_sell_exact_routed : {
                paramsOrder : [],
                asToken     : ["amount_in", "amount_out_min"],
                formatAs    : 'pool_sell_exact_routed',
                template    : 'tx-pool-sell-exact-routed-contract',
                eindexer    : ['iswapout'],
                eindexerTemlate : 'tx-pool-swap-contract-eindexer'
            },
            pool_buy_exact : {
                paramsOrder : ["asset_in", "amount_in_max", "asset_out", "amount_out"],
                asToken     : ["amount_in_max", "amount_out"],
                formatAs    : 'pool_buy_exact',
                template    : 'tx-pool-buy-exact-contract',
                eindexer    : ['iswapout'],
                eindexerTemlate : 'tx-pool-swap-contract-eindexer'
            },
            pool_buy_exact_routed : {
                paramsOrder : [],
                asToken     : ["amount_in_max","amount_out"],
                formatAs    : 'pool_buy_exact_routed',
                template    : 'tx-pool-buy-exact-routed-contract',
                eindexer    : ['iswapout'],
                eindexerTemlate : 'tx-pool-swap-contract-eindexer'
            },
            farm_create : {
                paramsOrder : ["stake_token", "reward_token", "block_reward", "emission"],
                asToken     : ["block_reward", "emission"],
                formatAs    : 'farm_create',
                template    : 'default',
                eindexer    : []
            },
            farm_get_reward : {
                paramsOrder : ["farm_id"],
                asToken     : [],
                formatAs    : 'farmGetRewardCloseStake',
                template    : 'default',
                eindexer    : ['ifrew'],
                eindexerTemlate : 'tx-farm-get-reward-contract-eindexer'
            },
            farm_increase_stake : {
                paramsOrder : ["farm_id", "amount"],
                asToken     : ["amount"],
                formatAs    : 'increaseDecreaseStake',
                template    : 'default',
                eindexer    : []
            },
            farm_close_stake : {
                paramsOrder : ["farm_id"],
                asToken     : [],
                formatAs    : 'farmGetRewardCloseStake',
                template    : 'default',
                eindexer    : ['ifcloserew'],
                eindexerTemlate : 'tx-farm-get-reward-contract-eindexer'
            },
            farm_decrease_stake : {
                paramsOrder : ["farm_id", "amount"],
                asToken     : ["amount"],
                formatAs    : 'increaseDecreaseStake',
                template    : 'default',
                eindexer    : ['ifdecrew'],
                eindexerTemlate : 'tx-farm-get-reward-contract-eindexer'
            },
            farm_add_emission : {
                paramsOrder : ["farm_id", "amount"],
                asToken     : ["amount"],
                formatAs    : 'increaseDecreaseStake',
                template    : 'default',
                eindexer    : []
            },
            dex_cmd_distribute : {
                paramsOrder : ["token_hash"],
                asToken     : [],
                formatAs    : 'dexCmdDistribute',
                template    : 'dex-cmd-distribute',
                eindexer    : []                
            },
            bridge_lock : {
                paramsOrder : [],
                asToken     : [],
                formatAs    : 'bridgeLock',
                template    : 'tx-bridge-lock-contract',
                eindexer    : []
            },
            bridge_claim_init : {
                paramsOrder : [],
                asToken     : [],
                formatAs    : 'bridgeClaimInit',
                template    : 'tx-bridge-claim-init-contract',
                eindexer    : []
            },
            bridge_claim_confirm : {
                paramsOrder : [],
                asToken     : [],
                formatAs    : 'bridgeClaimConfirm',
                template    : 'tx-bridge-claim-confirm-contract',
                eindexer    : []
            },
            unknown_contract : {
                paramsOrder : [],
                asToken     : [],
                formatAs    : 'default',
                template    : 'default',
                eindexer    : []
            }
        }

        function getScheme(contractName) {
            return contractsList.hasOwnProperty(contractName) ? contractsList[contractName] : contractsList['unknown_contract'];            
        }

        return {
            getScheme : getScheme
        };                
    });         

    let commasFormatter10Decimals = new Intl.NumberFormat("en-us", {
        useGrouping: true,
        minimumFractionDigits: '10',
        maximumFractionDigits: '10'
    });

    let commasFormatter4Decimals = new Intl.NumberFormat("en-us", {
        useGrouping: true,
        minimumFractionDigits: '4',
        maximumFractionDigits: '4'
    });


    let commasFormatter2Decimals = new Intl.NumberFormat("en-us", {
        useGrouping: true,
        minimumFractionDigits: '2',
        maximumFractionDigits: '2'
    });

    let commasFormatterInt = new Intl.NumberFormat("en-us", {
        useGrouping: true,
        minimumFractionDigits: '0',
        maximumFractionDigits: '0'
    });

    let commasFormatterNumberMin2Digits = new Intl.NumberFormat("en-us", {
        useGrouping: true,
        minimumFractionDigits: '2',
        maximumFractionDigits: '10'
    });

    app.filter('US_COMMAS_BIGINT_DECIMALS', function() {
        return function(input, decimals=10, fixed=10) {
            if(typeof input === 'bigint' || !isNaN(input)) {
                if (decimals === undefined || decimals === null || isNaN(decimals) || input === null)
                    return '---';          
                let str = BigInt(input).toString();
                let integerPart = '0';
                let fractionalPart = '0';
                let delimiter = decimals !== 0 ? (fixed !== 0 ? '.' : '') : '';
                if (str.length > decimals) {
                    integerPart = BigInt(str.substring(0, str.length - decimals)).toLocaleString('en-us');
                    fractionalPart = str.substring(str.length - decimals);
                } else {
                    fractionalPart = str.substring(str.length - decimals);
                    for (let i=0; i < (decimals - str.length); i++) {
                        fractionalPart = '0' + fractionalPart;
                    }                      
                }
                return integerPart + delimiter + fractionalPart.substring(0, fixed);
            } else
                return input;
        }
    });

    app.filter('BIGINT_DECIMALS', function() {
        return function(input, decimals=10, fixed=10, asObject=false) {
            if(typeof input === 'bigint' || !isNaN(input)) {
                if (decimals === undefined || decimals === null || isNaN(decimals) || input === null)
                    return '---';          
                let str = BigInt(input).toString();
                let integerPart = '0';
                let fractionalPart = '0';
                let delimiter = decimals !== 0 ? (fixed !== 0 ? '.' : '') : '';
                if (str.length > decimals) {
                    integerPart = BigInt(str.substring(0, str.length - decimals));
                    fractionalPart = str.substring(str.length - decimals);
                } else {
                    fractionalPart = str.substring(str.length - decimals);
                    for (let i=0; i < (decimals - str.length); i++) {
                        fractionalPart = '0' + fractionalPart;
                    }                      
                }
                if (asObject === true)
                    return {
                        integerPart,
                        fractionalPart : fractionalPart.substring(0, fixed),
                        value : integerPart + delimiter + fractionalPart.substring(0, fixed)
                    }
                else     
                    return integerPart + delimiter + fractionalPart.substring(0, fixed);
            } else
                return input;
        }
    });

    app.filter('US_COMMAS_10', function(){
        return function(input){
            if(isNaN(input))    return input;
            else return commasFormatter10Decimals.format(input);
        }
    });

    app.filter('US_COMMAS_4', function(){
        return function(input){
            if(isNaN(input))    return input;
            else return commasFormatter4Decimals.format(input);
        }
    });

    app.filter('US_COMMAS_2', function(){
        return function(input){
            if(isNaN(input))    return input;
            else return commasFormatter2Decimals.format(input);
        }
    });

    app.filter('US_COMMAS_INT', function(){
        return function(input){
            if(isNaN(input))    return input;
            else return commasFormatterInt.format(input);
        }
    });    

    app.filter('US_COMMAS_MIN_2_DIGITS', function(){
        return function(input){
            return commasFormatterNumberMin2Digits.format(input);
        }
    });


    app.filter('USD', function(){
        return function(input){
            if(isNaN(input)){
                return input;
            } else {
                return parseFloat(input).toFixed(5) + ' USD';
            }
        }
    });

	app.filter('TX_STATUS', function(){
		return function(input){
			const STATUS_DUPLICATE = 1;
			const STATUS_REJECTED = 2;
			const STATUS_CONFIRMED = 3;

			if (input === STATUS_CONFIRMED)
				return 'STATUS_CONFIRMED';
			if (input === STATUS_DUPLICATE)
				return 'STATUS_DUPLICATE';
			if (input === STATUS_REJECTED)
				return 'STATUS_REJECTED';
			return input;
		}
	});

    app.factory('apexRadialChart', function ($window) {    
        return {
            newApexRadialChart: function(element, options) {            
                return new $window.ApexCharts(element, options);
            }        
        }
    });

    app.factory('commonTools', function ($translate, $filter) {
        let recTypes = {
            iin : 'TX_IIN',
            iout : 'TX_IOUT',
            ik : 'REW_TX_IK',
            im : 'REW_TX_IM',
            iref : 'REW_TX_IREF',
            iv : 'REW_TX_IV',
            ifv : 'REW_TX_IFV',
            ic : 'STAKING_IC',
            ifk : 'REW_TX_IFK', 
            ifg : 'REW_TX_IFG',
            ifl : 'REW_TX_IFL',
            idust : 'REW_TX_DUST',
            ifdecrew : 'FARM_DECREASE_STAKE',
            iswapout : 'POOL_SWAP',
            iliqrmv2 : 'POOL_REMOVE_LIQUIDITY',
            iliqrmv1 : 'POOL_REMOVE_LIQUIDITY',
            iliqaddlt : 'POOL_ADD_LIQUIDITY',
            ipcreatelt : 'POOL_CREATE',
            ifrew : 'FARM_GET_REWARD',
            ifcloserew : 'FARM_CLOSE_STAKE'
        };
        function valueToBigInt(inputNumber, decimals=10) {
            let multiplier = 10 ** decimals;
            let str = String(inputNumber).replace(/,/g, '.');
            let parts_array = str.split('.');
            let integerPart = parts_array[0] === '' ? '0' : parts_array[0];
            let rawFractionalPart = parts_array[1] === '' || parts_array[1] === undefined ? '0' : parts_array[1];//before trim by decimals
            fractionalPart = rawFractionalPart.slice(0, decimals);
            let counter = decimals - rawFractionalPart.length;
            for (let i=0; i < counter; i++) {            
                fractionalPart += '0';
            }
            return {
                integerPart: integerPart,
                fractionalPart: fractionalPart,
                rawFractionalPart: rawFractionalPart,
                value: BigInt(integerPart) * BigInt(multiplier) + BigInt(fractionalPart)
            };
        } 
        return {
            getTxStatusBadge : function(status) {
                switch(status){
                    case 'STATUS_SUCCESS' : return 'badge-success-lighten';
                    case 'STATUS_PENDING' : return 'badge-primary-lighten';
                    case 'STATUS_CONFIRMED' : return 'badge-info-lighten';
                    case 'STATUS_REJECTED' : return 'badge-danger-lighten';
                    case 'STATUS_DUPLICATE' : return 'badge-danger-lighten';
                    default : return 'badge-primary-lighten';
                }
            },
            getPersentageString: function(value, limit=0.01) {
                let percentage = 0;
                if (value !== 0) {
                    percentage = (value >= limit) ? value.toFixed(2) : '<' + limit;
                }
                return percentage + '%';
            },
            genQR: function(el, code){
                const codeWriter = new ZXing.BrowserQRCodeSvgWriter();
                codeWriter.writeToDom(el, code, 300, 300);
            },
            valueToBigInt : valueToBigInt,
            multipleBigintOnFloat : function(bigintValue, bigintValueDecimals, numberValue, toFixed) {                
                let product = 0;
                if (bigintValue !== undefined && bigintValueDecimals !== undefined && numberValue !== undefined && toFixed !== undefined) {            
                    numberDecimals = numberValue.split('.')[1].length;
                    totalDecimals = bigintValueDecimals + numberDecimals;
                    product = $filter('US_COMMAS_BIGINT_DECIMALS')(BigInt(bigintValue) * valueToBigInt(numberValue, numberDecimals).value, totalDecimals, toFixed);                
                }
                return product;
            },
            arrayTranslate: function(localeStringTitlesArray) {
                let localeVariablesArr = localeStringTitlesArray;
                let translationsArr = [];
                let instantTranslate = $translate.instant(localeVariablesArr);
                localeVariablesArr.forEach(function(elem) {
                    translationsArr.push(instantTranslate[elem]);
                });
                return translationsArr;
            },
            getTxLink : function(record) {
                let path = undefined;
                let link = "#!/";
                let pathGroups = {
                    macroblock : ['ik', 'ifk', 'ifg', 'ifl', 'ifv', 'idust'],
                    mblock : ['im', 'iref'],
                    sblock : ['iv'],
                    tx : ['ic', 'iin', 'iout']
                };

                if (recTypes.hasOwnProperty(record.rectype)) {
                    Object.entries(pathGroups).forEach(function(pathGroupItem) {
                        if (pathGroupItem[1].indexOf(record.rectype) !== -1) {
                            path = pathGroupItem[0] + '/';
                        }
                    })
                }

                if (path !== undefined)
                    link = '#!/' + path + record.hash;
                else
                    link = '#!/tx/' + record.hash;

                return link;

            },
            getTxTypeLocaleString : function(rectype, incorrectValue = '---') {
                if (recTypes.hasOwnProperty(rectype)) {
                    return recTypes[rectype];
                } else
                    return incorrectValue;
            },
            getContractTypeTranslation : function(contractType, incorrectValue = '---') {
                let contractTypes = {
                    "create_token"           : "CREATE_TOKEN",
                    "create_pos"             : "CREATE_POS_CONTRACT",
                    "delegate"               : "DELEGATE",
                    "undelegate"             : "UNDELEGATE",
                    "transfer"               : "TRANSFER",
                    "pos_reward"             : "CLAIM_REWARD",
                    "mint"                   : "MINT",
                    "burn"                   : "BURN",
                    "pool_create"            : "POOL_CREATE",
                    "pool_add_liquidity"     : "POOL_ADD_LIQUIDITY",
                    "pool_remove_liquidity"  : "POOL_REMOVE_LIQUIDITY",
                    "pool_swap"              : "POOL_SWAP",
                    "pool_sell_exact"        : "POOL_SELL_EXACT",
                    "pool_buy_exact"         : "POOL_BUY_EXACT",
                    "pool_sell_exact_routed" : "POOL_SELL_EXACT_ROUTED",
                    "pool_buy_exact_routed"  : "POOL_BUY_EXACT_ROUTED",
                    "farm_create"            : "FARM_CREATE",
                    "farm_get_reward"        : "FARM_GET_REWARD",
                    "farm_increase_stake"    : "FARM_INCREASE_STAKE",
                    "farm_close_stake"       : "FARM_CLOSE_STAKE",
                    "farm_decrease_stake"    : "FARM_DECREASE_STAKE",
                    "farm_add_emission"      : "FARM_ADD_EMISSION",
                    "dex_cmd_distribute"     : "DEX_CMD_DISTRIBUTE",
                    "bridge_lock"            : "BRIDGE_LOCK",
                    "bridge_claim_init"      : "BRIDGE_CLAIM_INIT",
                    "bridge_claim_confirm"   : "BRIDGE_CLAIM_CONFIRM",
                    "unknown_contract"       : "UNKNOWN_CONTRACT"
                };
                if (contractTypes.hasOwnProperty(contractType)) {
                    return contractTypes[contractType];
                } else
                    return incorrectValue;
            },        
            getTokenType: function(token) {
                let tokenType = '---';
                if (token !== undefined) {
                    let minEable = token.minable;
                    
                    if (minEable === 1 && token.reissuable === 0)
                        tokenType = 'Mineable';
                    else if (minEable === 0 && token.reissuable === 0)
                        tokenType = "Non-reissuable";
                    else if (minEable === 0 && token.reissuable === 1) 
                        tokenType = "Reissuable";
                    else if (minEable === undefined) {
                        tokenType = token.reissuable === 0 ? "Non-reissuable" : token.reissuable === 1 ? "Reissuable" : tokenType;
                    } else if (token.reissuable === undefined) {
                        tokenType = minEable === 1 ? "Mineable" :  tokenType;
                    }                    
                }

                return tokenType;
            },
            getTokenFees: function(token, nativeToken = {decimals: 10, ticker: '---'}) {

                let res = {
                    fee_type : '---',
                    fee_value : '---',
                    fee_min : '---'
                }
                if (token.fee_type === 0) {
                    res.fee_type = 'FEE_TYPE_FLAT';
                    res.fee_value = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_value, token.decimals, token.decimals) +' '+ token.ticker;
                    res.fee_min = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_min, token.decimals, token.decimals) +' '+ token.ticker;
                } else if (token.fee_type === 1) {
                    res.fee_type = 'FEE_TYPE_PERCENT';
                    res.fee_min = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_min, token.decimals, token.decimals) +' '+ token.ticker;
                    res.fee_value = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_value, 2, 2) + '%';
                } else if (token.fee_type === 2) {
                    res.fee_type = 'FEE_TYPE_NATIVE';
                    res.fee_value = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_value, nativeToken.decimals, nativeToken.decimals) +' '+ nativeToken.ticker;
                    res.fee_min = $filter('US_COMMAS_BIGINT_DECIMALS')(token.fee_min, nativeToken.decimals, nativeToken.decimals) +' '+ nativeToken.ticker;
                }
                return res;
            },
            getTokenPriceInfo: function(token) {
                let res = {
                    origin : undefined,
                    value : 0
                }
                if (token.cg_price_usd !== undefined && token.cg_price_usd !== null && token.cg_price_usd !== "") {
                    res.origin = 'cg' 
                    res.value = Number.parseFloat(token.cg_price_usd).toFixed(10);                    
                } else if (token.dex_price_usd !== undefined && token.dex_price_usd !== null && token.dex_price_usd !== "") {
                    res.origin = 'dex' 
                    res.value = Number.parseFloat(token.dex_price_usd).toFixed(10);
                }
                return res    
            },
            zeroTrim: function(value) {
                let res = value;
                if (typeof value === 'string')
                    res = value.replace(/\.?0+$/,'');
                else if (typeof value === 'number')
                    res = Number.parseFloat(value).toFixed(10).toString().replace(/\.?0+$/,'');
                return res
            }
        }    
    });

    app.factory('schema', function () {
        let schema = {
            "root" :                    "0000",
            "custom" :                  "0100",
            "create_token" :            "0200",
            "delegate" :                "0300",
            "undelegate" :              "0400",
            "signature" :               "0500",
            "hash" :                    "0600",
            "string" :                  "0700",
            "int" :                     "0800",
            "bigint" :                  "0900",
            "float" :                   "0a00",
            "object" :                  "0c00",
            "key" :                     "0d00",
            "procedure_name" :          "0e00",
            "parameters" :              "0f00",
            "create_pos" :              "1000",
            "pos_reward" :              "1100",
            "transfer" :                "1200",
            "mint" :                    "1300",
            "burn" :                    "1400",
            "pool_create" :             "1500",
            "pool_add_liquidity" :      "1600",
            "pool_remove_liquidity" :   "1700",
            "pool_sell_exact" :         "1800",
            "farm_create" :             "1900",
            "farm_get_reward" :         "1a00",
            "farm_increase_stake" :     "1b00",
            "farm_close_stake" :        "1c00",
            "farm_decrease_stake" :     "1d00",
            "farm_add_emission" :       "1e00",
            "dex_cmd_distribute" :      "1f00",
            "pool_sell_exact_routed" :  "2000",
            "pool_buy_exact" :          "2100",
            "pool_buy_exact_routed" :   "2200",
            "bridge_lock" :             "2300",
            "bridge_claim_init" :       "2400",
            "bridge_claim_confirm" :    "2500",
            "bridge_set_owner" :        "2700",
            "bridge_set_threshold" :    "2800",
            "bridge_add_validator" :    "2900",
            "bridge_remove_validator" : "2a00",
            "bridge_add_network" :      "2b00",
            "bridge_remove_network" :   "2c00"
        };
        return schema                
    });

    app.service('txParser', function () {
        let schema, contract_pricelist = {};    

        function getkey(object, value) {
            return Object.keys(object).find(key => object[key] === value);
        }
        function getChunk(bin){
            let size = parseInt(bin.substring(0, 4), 16);
            let key = getkey(schema, bin.substring(4,8));
            return {
                size : size,
                key : key,
                data : bin.substr(8, size - 8)
            }
        }
        function deserialize(bin){
            let arr = [];
            while(bin.length > 0){
                let chunk = getChunk(bin);
                if(bin.length === chunk.size){
                    if((!contract_pricelist.hasOwnProperty(chunk.key))
                        && (chunk.key !== "parameters")
                        && (chunk.key !== "object")){
                        arr.push([chunk.key, chunk.data]);
                        return arr;
                    }
                    bin = bin.substring(8, bin.length);
                }
                if(bin.length > chunk.size)
                    arr.push([chunk.key, chunk.data]);
                else
                    arr.push([chunk.key, deserialize(chunk.data)]);
                bin = bin.substring(chunk.size);
            }
            return arr;
        }
        function prettify(data){
            let res = {};
            let arr = [];
            for(let i = 0; i < (data.length); i++){
                let el = data[i];
                if(Array.isArray(el)){
                    arr.push(prettify(el))
                }
                else{
                    if(!Array.isArray(data[i+1])){
                        res[el] = data[i+1];
                        i++;
                    }
                    else{
                        res[el] = prettify(data[i+1]);
                        i++;
                    }
                }
            }
            if(arr.length > 0)
                return arr;
            return res;
        }
        
        this.isContract = function(raw, txSchema = {}, contractPricelist={}) {
            schema = txSchema;
            contract_pricelist = contractPricelist;            
            if(raw === undefined || raw === null)
                return false;
            let chunk = getChunk(raw);
            if((chunk.size === raw.length) && contract_pricelist.hasOwnProperty(chunk.key)) {
                return chunk.key;
            }
            return false;
        } 

        this.parse = function(raw, txSchema = {}, contractPricelist={}){
            schema = txSchema;
            contract_pricelist = contractPricelist;
            let data = {};
            let input = (deserialize(raw))[0];
            data.type = input[0];
            input = prettify(input[1]);
            //data.procedure_name = input[0].procedure_name;
            let params = input[0].parameters;
            data.parameters = {};
            for(let i = 0; i < params.length; i+=2){
                let value = (Object.keys(params[i+1]))[0];
                if(value === "int" || value === "bigint" || value === "float"){
                    if(value === "bigint"){
                        value = BigInt(params[i+1][value]);
                    }
                    else {
                        if(isNaN(params[i+1][value]))
                            throw new Error("Not a number");
                        value = parseInt(params[i+1][value]);
                    }
                }
                else
                    value = params[i+1][value];
                data.parameters[params[i].key] = value;
            }
            return data;
        }
    });  

    app.factory('provider', function (GLOBAL_APP_CONFIG, $resource){       
        let nodeUrl = GLOBAL_APP_CONFIG.externalLinks.peerMapURL;
        return {
            page : $resource('api/v1/page?n=:n', {n:'@n'}),
            macroblock : $resource('api/v1/macroblock?hash=:hash', {hash:'@hash'}),
            mblock : $resource('api/v1/mblock?hash=:hash', {hash:'@hash'}),
            sblock : $resource('api/v1/sblock?hash=:hash', {hash:'@hash'}),
            lastblocks : $resource('api/v1/lastblocks', {}),
            lasttxs : $resource('api/v1/lasttxs', {}),
            stats : $resource('api/v1/stats', {}),
            externalStats : $resource(nodeUrl + 'api/v1/stats', {}),
            account : $resource('api/v1/account:filter?id=:id&page=:page', {filter:'@filter',id:'@id', page:'@page'}),
            agent_info : $resource('/api/v1/stat/agent_info?id=:id', {id:'@id'}),
            transaction : $resource('api/v1/tx?hash=:hash', {hash:'@hash'}),
            top_accounts : $resource('api/v1/top_accounts?page=:page', {page:'@page'}),
            roi : $resource('api/v1/roi?hash=:hash', {hash:'@hash'}),
            stake_limits : $resource('api/v1/get_stake_limits', {}),
            get_tickers_all : $resource('api/v1/get_tickers_all', {query: {method: 'GET', isArray: true}}),
            get_tickers_all_unfiltered : $resource('api/v1/get_tickers_all_unfiltered', {query: {method: 'GET', isArray: true}}),
            get_token_info_page : $resource('api/v1/get_token_info_page?page=:page&type:=type', {page:'@page',type:'@type'}),
            token_info : $resource('' + 'api/v1/token_info?hash=:hash', {hash:'@hash'}, {query: {method: 'GET', isArray: true}}),
            get_token_holder_count : $resource('api/v1/get_token_holder_count?token_hash=:token_hash', {token_hash:'@token_hash'}),
            get_tokens_by_owner : $resource('api/v1/get_tokens_by_owner?owner=:owner', {owner:'@owner'}, {query: {method: 'GET', isArray: true}}),
            get_tokens_count : $resource('api/v1/get_tokens_count', {}),
            balance_main_token : $resource('/api/v1/balance?id=:id', {id:'@id'}),
            balance_all : $resource('/api/v1/balance_all?id=:id', {id:'@id'}, {query: {method: 'GET', isArray: true}}),
            balance_all_unfiltered : $resource('/api/v1/balance_all_unfiltered?id=:id', {id:'@id'}, {query: {method: 'GET', isArray: true}}),
            get_pos_total_stake : $resource('/api/v1/get_pos_total_stake'),
            get_pos_list_all : $resource('/api/v1/get_pos_list_all'),
            get_pos_list : $resource('/api/v1/get_pos_list?owner=:owner', {owner:'@owner'}, {query: {method: 'GET', isArray: true}}),
            get_pos_list_count : $resource('/api/v1/get_pos_list_count'),
            get_pos_list_page : $resource('/api/v1/get_pos_list_page?page=:page', {page:'@page'}),
            get_pos_names : $resource('/api/v1/get_pos_names', {query: {method: 'GET', isArray: true}}),
            get_delegators_page : $resource('api/v1/get_delegators_page?pos_id=:pos_id&page=:page', {pos_id:'@pos_id', page:'@page'}),
            get_pos_info : $resource('/api/v1/get_pos_info?pos_id=:pos_id', {pos_id:'@pos_id'}, {query: {method: 'GET', isArray: true}}),
            get_delegators_list : $resource('/api/v1/get_delegators_list?pos_id=:pos_id', {pos_id:'@pos_id'}, {query: {method: 'GET', isArray: true}}),
            get_delegated_list : $resource('/api/v1/get_delegated_list?delegator=:delegator', {delegator:'@delegator'}, {query: {method: 'GET', isArray: true}}),
            get_pos_active_total_stake : $resource('/api/v1/get_pos_active_total_stake'),
            account_transactions : $resource('api/v1/account_transactions?id=:id&page=:page', {id:'@id', page:'@page'}),
            account_rewards : $resource('api/v1/account_rewards?id=:id&page=:page', {id:'@id', page:'@page'}),
            contract_pricelist : $resource('/api/v1/contract_pricelist'),
            eindex_by_hash : $resource('api/v1/eindex_by_hash?hash=:hash', {hash:'@hash'}),
            get_dex_farms : $resource('api/v1/get_dex_farms?farmer_id=:farmer_id&farms=:farms', {farmer_id:'@farmer_id', farms:'@farms'}, {query: {method: 'GET', isArray: true}}),
            get_dex_pools : $resource('api/v1/get_dex_pools', {query: {method: 'GET', isArray: true}}),
            get_dex_farms_all : $resource('api/v1/get_dex_farms', {query: {method: 'GET', isArray: true}}),
            pending_tx_hash : $resource('/api/v1/pending_tx_hash?hash=:hash', {hash:'@hash'}, {query: {method: 'GET', isArray: true}})
        };
    });

    app.directive('onLoadFile', function ($parse) {
        return {
            restrict: 'A',
            scope: {
                onLoadFile : "&"
            },
            link: function(scope, element, attrs) {
                element.on('change', function(e) {
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        scope.$apply(function() {
                           scope.onLoadFile({file:e.target.result});
                        });
                    };
                    reader.readAsText((e.srcElement || e.target).files[0]);
                });
            }
        };
    });

    app.controller('documentHeadCtrl', function(GLOBAL_APP_CONFIG, $scope) {
       let currentPreset = GLOBAL_APP_CONFIG;
       let themeName = currentPreset.theme;
       let theme = GLOBAL_APP_CONFIG.themeOptions[themeName];
       $scope.themeLink = theme.cssLink + theme.cssName;
       $scope.favicon = currentPreset.favicon;
       $scope.showTestNetDisclaimer = currentPreset.pagesSectionsVisibility.showTestNetDisclaimer;
    });

    app.controller('headerCtrl', function(GLOBAL_APP_CONFIG, $scope, $rootScope, $location, $http, provider, langService, schema, txParser, Toast, $window) {
        let currentPreset = GLOBAL_APP_CONFIG;
        $scope.showEnexPools = currentPreset.pagesSectionsVisibility.showEnexPools;
        $scope.showDropFarms = currentPreset.pagesSectionsVisibility.showDropFarms;
        $scope.tokenName = currentPreset.tokenName;
        $scope.showFullNodesCountCard = currentPreset.pagesSectionsVisibility.showFullNodesCountCard;
        $scope.tokenLogoFile = currentPreset.tokenLogoFileLink;
        $scope.logoLinkTarget = currentPreset.logoLinkTarget;
        $scope.menuItemsVisibility = currentPreset.menuItemsVisibility;
        $scope.walletLink = currentPreset.externalLinks.topMenuItemsLinks.walletLink;
        $scope.translationData = {
            tokenName: currentPreset.tokenName
        };
        $scope.searchResult = [];

        $scope.searchModalId = 'searchModal'
        $scope.searchModalSelector = `#${$scope.searchModalId}`;
        $scope.searchItemsList = {
            token        : {path: 'token', alias: 'TOKEN'},
            kblock       : {path: 'macroblock', alias: 'K_BLOCK'},
            mblock       : {path: 'mblock', alias: 'MICROBLOCK'},
            sblock       : {path: 'sblock', alias: 'S_BLOCK'}, 
            account      : {path: 'account', alias: 'ACCOUNT'},
            pos          : {path: 'pos-contract', alias: 'POS_CONTRACT'},
            pool         : {path: '/api/v1/search?value=', alias: 'POOL'},
            farm         : {path: '/api/v1/get_dex_farms?farmer_id=""&farms=', alias: 'FARM'},
            tx           : {path: 'tx', alias: 'TX'}        
        }         
        $scope.locateToSearchResult = function (searchResultItem) {
            if($scope.searchItemsList.hasOwnProperty(searchResultItem.type)) {
                if(searchResultItem.type !== 'pool' && searchResultItem.type !== 'farm')
                    $location.path(`/${$scope.searchItemsList[searchResultItem.type].path}/${$scope.search_value}`);
                else {
                    $window.open(`${$scope.searchItemsList[searchResultItem.type].path}${$scope.search_value}`, "_blank");
                }
                $($scope.searchModalSelector).modal('hide');
            }
        }
    	//TODO: search should be performed by client
	    $scope.on_search = function () {           
            console.log(`Search: ${$scope.search_value}`);         
		    $http({method: 'GET', url: `api/v1/search?value=`+$scope.search_value}).
		    then(function (response) {
                $scope.searchResult = response.data;
                if (response.data.length > 0)                   
                    $($scope.searchModalSelector).modal('show');
                else
                    Toast.info('Nothing found');
		    });
	    };
        $scope.ls = langService;
        $rootScope.curLang = langService.getLangObject();
        $scope.changeLanguage = function (key) {
            langService.changeLanguage(key);
            $rootScope.curLang = langService.getLangObject();
        };
    });

	app.controller('homeCtrl', function(GLOBAL_APP_CONFIG, $scope, $interval, $routeParams, provider, $http) {
        let currentPreset = GLOBAL_APP_CONFIG;        
        $scope.blocks = provider.lastblocks.get();
        $scope.txs = provider.lasttxs.get();
        $scope.stats = provider.stats.get();
        $scope.externalStats = provider.externalStats.get();
        let peerMapURL = currentPreset.externalLinks.peerMapURL;

        $scope.showFullNodesCountCard = currentPreset.pagesSectionsVisibility.showFullNodesCountCard;

        $http({method: 'GET', url: peerMapURL + 'api/v1/peer_map'}).
                then(function (response){
                    let marker_style = [{r: 3, fill:'black'}, {r: 3, fill:'blue'}, {r: 3, fill:'red'}, {r: 3, fill:'green'}];
                    let markers = response.data.filter((el)=> (el.lat !== null && el.lon !== null && el.type !== null && el.count !== null))
                        .map((el) => {return {latLng:[el.lat, el.lon], name:el.count.toString(), style: marker_style[el.type] }});
                    $(function(){
                        var mapScaleFactor = 1;
                        function calculateMarkerSize(markerInitialRadius, scaleFactor) {
                            var markerSize = markerInitialRadius * Math.pow(scaleFactor, 0.2);
                            return markerSize;
                        }
                        $("#world-map-markers").vectorMap({
                            map:"world_mill_en", normalizeFunction:"polynomial", hoverOpacity:.7, hoverColor:!1, regionStyle: {
                                initial: {
                                    fill: "#e3eaef"
                                }
                            },
                            zoomMax: 20,
                            onViewportChange: function(event, scaleFactor){
                                mapScaleFactor = scaleFactor;
                                $('.jvectormap-marker').each(function () {
                                    var markerIndex = $(this).attr('data-index');
                                    var markerInitialRadius = markers[markerIndex].style.r;
                                    var radius = calculateMarkerSize(markerInitialRadius, scaleFactor);
                                    this.setAttribute('r', radius);
                            })},
                            markerStyle: {
                                initial: {
                                    r: 2, fill: "#727cf5", "fill-opacity": .9, stroke: "#fff", "stroke-width": 7, "stroke-opacity": .4
                                },
                                hover: {
                                    "fill-opacity": 1, stroke: "#fff", "stroke-width": 1.5
                                }
                            },
                            onMarkerOver: function (event, StringCode) {
                                event.preventDefault();
                                var marker = $('.jvectormap-marker[data-index = ' + StringCode + ']');
                                var markerInitialRadius = markers[StringCode].style.r;
                                var extendedmarkerSize = calculateMarkerSize(markerInitialRadius, mapScaleFactor)*1.3;
                                marker.attr('r', extendedmarkerSize);
                            },
                            onMarkerOut: function(event, StringCode){
                                var marker = $('.jvectormap-marker[data-index = ' + StringCode + ']');
                                var markerInitialRadius = markers[StringCode].style.r;
                                marker.attr('r', calculateMarkerSize(markerInitialRadius, mapScaleFactor));
                            }
                            , backgroundColor:"transparent"
                            , markers: markers
                        });
                    });
                });

        $interval(function () {
            $scope.blocks = provider.lastblocks.get();
            $scope.txs = provider.lasttxs.get();
            $scope.stats = provider.stats.get();
        }, 10000);
	});

	app.controller('mapCtrl', function($scope, $routeParams, provider) {
		$scope.stats = provider.stats.get();
	});

    commas = function(num){
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };

    app.controller('roiCtrl', function(GLOBAL_APP_CONFIG, $window, $scope, $rootScope, $translate, provider, validator, dataValidator, currencyExchange, commonTools, roiCalc, Toast) {
        $scope.currentPreset = GLOBAL_APP_CONFIG;
        $scope.showROICalc = $scope.currentPreset.pagesSectionsVisibility.showROICalc;

        if ($scope.showROICalc === false) {
            $window.location.href = '/';
        }
        let incorrectValue = '---';
        $scope.roiValid = true;

        if (GLOBAL_APP_CONFIG.tokenName !== 'ENQ') {
             $scope.stake_limits = provider.stake_limits.get(function(stake_limits){                
                $scope.stake = stake_limits.min_stake/$rootScope.mainTokenFactor;           
                $scope.min_stake = stake_limits.min_stake/$rootScope.mainTokenFactor;
                $scope.max_stake = stake_limits.max_stake/$rootScope.mainTokenFactor; 
            });           
        } else {
            $scope.stake = 25;           
            $scope.min_stake = 25;
            $scope.max_stake = 25000;
        }

        $scope.translationData = {
            stake: $scope.stake,
            min: $scope.min_stake,
            max: $scope.max_stake,
            tokenName: $scope.currentPreset.tokenName
        };
        
        $scope.ROIHeaderTranslate = function() {
            $translate('ROI_HEADER', $scope.translationData).then(function (translation) {                
                $scope.ROIHeader = $scope.currentPreset.tokenName === 'ENQ' ? translation : translation.replace(/CoinGecko/g,'');
            });
        };

        $scope.ROIHeaderTranslate();

        $rootScope.$on('$translateChangeSuccess', function () {
            $scope.ROIHeaderTranslate();
        });

        $scope.getTimestamp = function(unix){
            return (new Date(unix * 1000)).toLocaleString()
        };

        $scope.showExchangesSection = $scope.currentPreset.pagesSectionsVisibility.showExchangesSection;

        let statRequestLink =  GLOBAL_APP_CONFIG.tokenName === 'ENQ' ? 'externalStats' : 'stats';     

        $scope.stats = provider[statRequestLink].get(function(stat) {
            $rootScope.$watch('mainToken.decimals', function(newValue, oldValue) {                
                if (newValue !== undefined) {
                    let statsPropertiesArr = ['total_daily_stake','reward_poa','poa_count','cg_usd','cg_btc'];
                    statsPropertiesArr.forEach(function(item) {
                        $scope.stats[item] = (stat.hasOwnProperty(item) && validator.checkValidDigitalValue(stat[item])) ? stat[item] : incorrectValue;
                    });
                    
                    $scope.convertValueToUSD = function(value) {
                        if (value !== undefined) {              
                            let cg_usdDecimals = stat.cg_usd.split('.')[1].length;
                            $scope.mainTokenToUSDDecimals = cg_usdDecimals + $rootScope.mainToken.decimals;
                            let bigIntCgUSD = commonTools.valueToBigInt(stat.cg_usd, cg_usdDecimals).value
                            return currencyExchange.convertValue(BigInt(value), bigIntCgUSD);
                        } else
                            return 0;
                    }

                    let poaROIData = {
                        stake : null,
                        stakeTicker : $scope.translationData.tokenName,
                        stakeDecimals : $rootScope.mainToken.decimals,
                        roiArrForLerp : null,
                        stat : stat,
                        factorIfReferral : null,
                        periods : [
                            {
                                titleInLocale: "ROI_DAILY",
                                daysFactor: 1 
                            },
                            {
                                titleInLocale: "ROI_WEEKLY",
                                daysFactor: 7 
                            },
                            {
                                titleInLocale: "ROI_MONTHLY",
                                daysFactor: 30 
                            },
                            {
                                titleInLocale: "ROI_ANNUALLY",
                                daysFactor: 365 
                            }
                        ],
                        currencyInfo : [
                            {
                                ticker : $scope.translationData.tokenName,
                                rate : 1,
                                toFixed : 2 
                            },                
                            {
                                ticker : 'USD',
                                rate : stat.cg_usd,
                                toFixed : 3 
                            },
                            {
                                ticker : 'ETH',
                                rate : stat.cg_eth,
                                toFixed : 6 
                            },
                            {
                                ticker : 'BTC',
                                rate : stat.cg_btc,
                                toFixed : 8 
                            }
                        ]
                    };

                    $scope.reloadROI = function(stake) {
                        if(stake < $scope.min_stake || stake > $scope.max_stake ){
                            Toast.stakeErrorToast(`Stake is out of range ${$scope.min_stake}...${$scope.max_stake}`);
                            $scope.roiData = [];
                        } else {
                            poaROIData.stake = parseFloat(stake);
                            poaROIData.factorIfReferral = $scope.refCheck === true ? 0.1 : 0;
                            $scope.roiData = roiCalc.getPOA_ROIs(poaROIData);                    
                        }
                    }

                    $scope.rois = provider.roi.query(function(roiArrForLerp){
                        poaROIData.roiArrForLerp = roiArrForLerp;            
                        $scope.reloadROI($scope.stake);
                    });
                }
            });
        });
        
        ////////////////////////////////// PoW Calc
        $scope.showPOWCalcResult = false;

        $scope.powCalc = {
            inputData: {
                electricityCoast: 0.074,
                powerConsumption: 51,
                hashrate: 570
            },
            statDataItems: ["reward_pow","cg_usd","network_hashrate","difficulty",'pow_count'],
            outputData: {
                revenue: 0,
                profit: 0
            },
            validateUserInputData: function() {
                let inputDataIsValid = true;
                for (let item in $scope.powCalc.inputData) {
                    if (!validator.checkValidDigitalValue($scope.powCalc.inputData[item])) {
                        inputDataIsValid = false;
                        $('#pow'+item+'Alert').show();
                    } else {
                        $scope.powCalc.inputData[item]*=1;
                        $('#pow'+item+'Alert').hide();
                    }
                }
                return inputDataIsValid;
            },
            calculate: function() {
                if ($scope.powCalc.validateUserInputData()) {
                    provider.stats.get(function(stat) {
                        let statDataValid = true;
                        let inputData = $scope.powCalc.inputData;
                        let statDataItems = $scope.powCalc.statDataItems;
                        let statData = {};
                        statDataItems.forEach(function(item) {
                            statData[item] = (stat.hasOwnProperty(item) && validator.checkValidDigitalValue(stat[item])) ? stat[item]*1 : incorrectValue;

                            if (statData[item] === incorrectValue)
                                statDataValid = false;
                        });
                        if (statDataValid) {
                            $scope.powCalc.statData = statData;
                            let hUser = inputData.hashrate;
                            let hTotal = statData.network_hashrate;
                            let rTotal = statData.reward_pow/$rootScope.mainTokenFactor;
                            let tokenPrice = statData.cg_usd;
                            let eCosts = inputData.electricityCoast;
                            let W = inputData.powerConsumption;
                            let dailyRevenueToken = (hUser / (hTotal + hUser)) * rTotal;
                            let Cost = eCosts * W/1000 * 24;
                            let dailyRevenueUSD = dailyRevenueToken * tokenPrice;
                            let dailyProfitUSD = dailyRevenueUSD - Cost;
                            let dailyProfitToken = dailyProfitUSD/tokenPrice;

                            $scope.powROIData = [
                                {
                                    period: "ROI_DAILY",
                                    revenue: [{value: commas(dailyRevenueToken.toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas(dailyRevenueUSD.toFixed(2)), ticker: "USD"}],
                                    profit: [{value: commas(dailyProfitToken.toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas(dailyProfitUSD.toFixed(2)), ticker: "USD"}]
                                },
                                {
                                    period: "ROI_WEEKLY",
                                    revenue: [{value: commas((dailyRevenueToken * 7).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyRevenueUSD * 7).toFixed(2)), ticker: "USD"}],
                                    profit: [{value: commas((dailyProfitToken * 7).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyProfitUSD * 7).toFixed(2)), ticker: "USD"}]
                                },
                                {
                                    period: "ROI_MONTHLY",
                                    revenue: [{value: commas((dailyRevenueToken * 30).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyRevenueUSD * 30).toFixed(2)), ticker: "USD"}],
                                    profit: [{value: commas((dailyProfitToken * 30).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyProfitUSD * 30).toFixed(2)), ticker: "USD"}]
                                },
                                {
                                    period: "ROI_ANNUALLY",
                                    revenue: [{value: commas((dailyRevenueToken * 365).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyRevenueUSD * 365).toFixed(2)), ticker: "USD"}],
                                    profit: [{value: commas((dailyProfitToken * 365).toFixed(2)), ticker: $scope.currentPreset.tokenName}, {value: commas((dailyProfitUSD * 365).toFixed(2)), ticker: "USD"}]
                                }
                            ];
                            $scope.showPOWCalcResult = true;
                        } else
                            $scope.showPOWCalcResult = false;
                    });
                } else 
                    $scope.showPOWCalcResult = false;
            }
        };

        ////////////////////////////////// PoS Calc

        $scope.showPOSCalcResult = {
            delegator : false,
            validator : false
        }

        $scope.posCalcType = 'delegator';

        $scope.setPOSCalcType = function(type) {
            $scope.posCalcType = type;
        }       

        provider.get_pos_names.query(function(pos_names) {
            $scope.posNames = {};
            pos_names.forEach(function(pos) {
                $scope.posNames[pos.pos_id] = pos.name;                
            });
            provider.get_pos_list_all.get(function(posList) {
                provider.get_pos_total_stake.get(function(res) {
                    $scope.allPOSTotalStake = res.total_stake;

                    $scope.posStakeParams = {
                        min: 1,
                        max: Math.trunc(($scope.stats.csup - $scope.allPOSTotalStake)/$rootScope.mainTokenFactor)
                    }
                
                    $scope.activePOSCount = 0;
                    $scope.avgUptime = 0;
                    $scope.daily_pos_reward = posList.daily_pos_reward;
                    $scope.total_stake = posList.total_stake;
                    $scope.active_total_stake = posList.active_total_stake;
                    $scope.effective_total_stake = posList.effective_total_stake;
                    $scope.posList = posList.pos_contracts;
                    $scope.posList.forEach(function(pos) {
                        $translate(pos.active === 1? 'ACTIVE_ITEMS' : 'INACTIVE_ITEMS').then(function(msg) {
                            pos.activeAlias = msg + ' POS';
                        });                                            
                        $scope.activePOSCount += pos.active;
                        $scope.avgUptime += pos.uptime;
                        pos.name = $scope.posNames[pos.pos_id];                  
                    });

                    $scope.avgUptime = $scope.avgUptime/$scope.activePOSCount;

                    $scope.defaultValues = {
                        common : {
                            stake : 25000
                        },
                        validator : {
                            delegatedByOthers : 1,
                            delegatedByOwner : 25000,
                            uptime : 95,
                            txsPerDay : 1,
                        }
                    }

                    $scope.clientPOSData = {
                        сonstraints : {
                            common : {
                                stake : {
                                    min: 1,
                                    max: Math.trunc(($scope.stats.csup - $scope.allPOSTotalStake)/$rootScope.mainTokenFactor)                                    
                                },
                                posFee : {
                                    decimalPlaces : 2
                                },
                                txsPerDay : {
                                    min : 0,
                                    max : 1000000,
                                    decimalPlaces : 0
                                },
                                priceUSD : {
                                    min : 0,
                                    max : 1000000,
                                    decimalPlaces : 5
                                }
                            },
                            validator : {
                                posFee : {
                                    min : 0,
                                    max : 100
                                },
                                uptime : {
                                    min : 0,
                                    max : 100,
                                    decimalPlaces : 2
                                }
                            }
                        },
                        delegatorInput : {
                            posContract : $scope.posList[0],
                            stake       : $scope.defaultValues.common.stake                            
                        },
                        validatorInput : {
                            delegatedByOthers  : $scope.defaultValues.validator.delegatedByOthers,
                            posFee : 5,
                            uptime : $scope.defaultValues.validator.uptime,
                            txsPerDay  : $scope.defaultValues.validator.txsPerDay,
                            delegatedByOwner : $scope.defaultValues.validator.delegatedByOwner,
                            priceUSD : $rootScope.mainToken.ticker === 'ENQ' ? Number($scope.stats.cg_usd).toFixed(5) : '- - -'
                        },
                        validationRules : getValidationRules
                    }

                    $scope.modifyByStep = function(param, direction) {
                        let directions = ['decrease', 'increase'];
                        let intervals = {
                            uptime : [
                                {min : $scope.clientPOSData.сonstraints.validator.uptime.min, max : 90, step : 10},
                                {min : 90, max : 95, step : 5},
                                {min : 95, max : $scope.clientPOSData.сonstraints.validator.uptime.max, step : 1}
                            ],
                            posFee : [
                                {min : $scope.clientPOSData.сonstraints.validator.posFee.min, max : 10, step : 1},
                                {min : 10, max : 30, step : 5},
                                {min : 30, max : $scope.clientPOSData.сonstraints.validator.posFee.max, step : 10}
                            ]
                        }

                        if (intervals.hasOwnProperty(param) && directions.includes(direction)) {
                            let value = 0;                            
                            let validateData = {};
                            let validNumber = (isNaN($scope.clientPOSData.validatorInput[param])) ? false : true;
                            if (validNumber) {
                                value = Number($scope.clientPOSData.validatorInput[param]);
                                let multiplier;
                                let intervalIndex;

                                if (direction === 'decrease') {
                                    multiplier = -1;
                                    for (let i=intervals[param].length-1 ; i >= 0; i--) {
                                        if ((value <= intervals[param][i].max)) 
                                            intervalIndex = i;
                                    }
                                } else if (direction === 'increase') {
                                    multiplier = 1;
                                    for (let i = 0; i < intervals[param].length; i++ ) {
                                        if (value >= intervals[param][i].min) {
                                            intervalIndex = i;
                                        }
                                    }
                                }

                                if (intervalIndex !== undefined) {
                                    let step = intervals[param][intervalIndex].step;

                                    step *= multiplier;
                                    let newValue = value + step;

                                    if (newValue < $scope.clientPOSData.сonstraints.validator[param].min)
                                        value = $scope.clientPOSData.сonstraints.validator[param].min;
                                    else if (newValue > $scope.clientPOSData.сonstraints.validator[param].max)
                                        value = $scope.clientPOSData.сonstraints.validator[param].max;
                                    else if (newValue > intervals[param][intervalIndex].max)
                                        value = intervals[param][intervalIndex].max
                                    else if (newValue < intervals[param][intervalIndex].min)
                                        value = intervals[param][intervalIndex].min
                                    else 
                                        value = newValue;
                                } else  {
                                    if (value < $scope.clientPOSData.сonstraints.validator[param].min)
                                        value = $scope.clientPOSData.сonstraints.validator[param].min;
                                    else if (value > $scope.clientPOSData.сonstraints.validator[param].max)
                                        value = $scope.clientPOSData.сonstraints.validator[param].max;                                        
                                }
                            } else {
                                if (direction === 'decrease')
                                    value = $scope.clientPOSData.сonstraints.validator[param].min;
                                else if (direction === 'increase')
                                    value = $scope.clientPOSData.сonstraints.validator[param].max;
                            }
                            $scope.clientPOSData.validatorInput[param] = Number(value.toFixed(2));
                        }        
                        
                        let paramAlias = (param === 'posFee') ? 'Fee' : 'Uptime';
                        $(`#validator${paramAlias}InputWrapper .errMsg`).hide();
                    }

                    $scope.posROIData = {
                        delegator : [],
                        validator : []
                    }

                    $scope.processPOSData = function(type) {
                        let validationRules = getValidationRules(type);
                        let dataValid = dataValidator.batchValidate($scope.clientPOSData[`${type}Input`], validationRules);
                        let dailyRewardInPercent = 0;
                        let posDailyReward = 0;
                        let price = $scope.stats.cg_usd;
                        if (dataValid) {
                            $scope.clientPOSData[`${type}Input`].stake *= 1;
                            let pos = {};                            
                            if (type === 'delegator') {
                                let posId = $scope.clientPOSData.delegatorInput.posContract.pos_id;
                                pos = $scope.posList.find(pos => pos.pos_id === posId);
                                let inputStake = $scope.clientPOSData.delegatorInput.stake;
                                let calculatedEffectiveStake = inputStake * pos.uptime;
                                let calculatedEffectiveTotalStake = $scope.effective_total_stake / $rootScope.mainTokenFactor + calculatedEffectiveStake;
                                let calculatedPower = calculatedEffectiveStake / calculatedEffectiveTotalStake;
                                let calculatedRoi = ($scope.daily_pos_reward / $rootScope.mainTokenFactor) * calculatedPower / calculatedEffectiveStake * calculatedEffectiveStake / inputStake * 100 * (1e4 - pos.fee ) / 1e4;
                                dailyRewardInPercent = calculatedRoi;
                                posDailyReward = dailyRewardInPercent * inputStake / 100;                                
                            } else if (type === 'validator') {
                                price = Number($scope.clientPOSData.validatorInput.priceUSD);
                                let mainTokenTxFee = $rootScope.mainToken.fee_value / $rootScope.mainTokenFactor;
                                let posFeeShare = 0.96;
                                let inputTotalStake = Number($scope.clientPOSData.validatorInput.delegatedByOthers) + Number($scope.clientPOSData.validatorInput.delegatedByOwner);
                                let inputDelegatedByOwner = Number($scope.clientPOSData.validatorInput.delegatedByOwner);
                                let posFee = Number($scope.clientPOSData.validatorInput.posFee);
                                let uptime = Number($scope.clientPOSData.validatorInput.uptime) / 100;
                                pos.uptime = uptime;
                                let calculatedEffectiveStake = inputTotalStake * uptime;//common formula
                                let effectiveDelegatedStake = inputDelegatedByOwner * uptime;
                                let calculatedEffectiveTotalStake = $scope.effective_total_stake / $rootScope.mainTokenFactor + calculatedEffectiveStake;//common formula
                                let calculatedPower = calculatedEffectiveStake / calculatedEffectiveTotalStake;//common formula
                                let total_pos_tx_fee_rew = Number($scope.clientPOSData.validatorInput.txsPerDay)  * mainTokenTxFee * posFeeShare * calculatedEffectiveStake / calculatedEffectiveTotalStake;
                                let txFee = (total_pos_tx_fee_rew * posFee / 100) + (total_pos_tx_fee_rew * (1 - posFee / 100) * effectiveDelegatedStake / calculatedEffectiveStake);
                                let fee = $scope.daily_pos_reward  / $rootScope.mainTokenFactor * calculatedPower * posFee / 100;
                                let selfDelegateRew = $scope.daily_pos_reward / $rootScope.mainTokenFactor * effectiveDelegatedStake / calculatedEffectiveTotalStake * (1 - posFee / 100);
                                posDailyReward  = txFee + fee + selfDelegateRew;
                                dailyRewardInPercent = posDailyReward / inputDelegatedByOwner * 100;
                            }

                            if (!(pos.uptime > 0)) {
                                posDailyReward = 0;
                                dailyRewardInPercent = 0;
                            }

                            populatePOSROI(type, posDailyReward, dailyRewardInPercent, price);
                            $scope.showPOSCalcResult[type] = true;
                        } else {
                            $scope.showPOSCalcResult[type] = false;
                            $scope.posROIData[type] = [];                    
                        }
                    }

                    $scope.$watch('posCalcType', function(newValue, oldValue) {
                        if (newValue !== undefined) {
                            $scope.processPOSData(newValue);
                        }
                    });

                    function populatePOSROI(type, posDailyReward, dailyRewardInPercent, price = $scope.stats.cg_usd) {
                        $scope.posROIData[type] = [
                            {
                                period: "ROI_DAILY",
                                value: commas(posDailyReward.toFixed(2)) +' '+ $scope.currentPreset.tokenName,
                                usd: commas((posDailyReward * price).toFixed(2)) + ' USD',
                                roi: "+ " + commas((dailyRewardInPercent).toFixed(2)) + " %"
                            },
                            {
                                period: "ROI_WEEKLY",
                                value: commas((posDailyReward * 7).toFixed(2)) +' '+ $scope.currentPreset.tokenName,
                                usd: commas((posDailyReward * 7 * price).toFixed(2)) + ' USD',
                                roi: "+ " + commas((dailyRewardInPercent * 7).toFixed(2)) + " %"
                            },
                            {
                                period: "ROI_MONTHLY",
                                value:  commas((posDailyReward * 30).toFixed(2)) +' '+ $scope.currentPreset.tokenName,
                                usd: commas((posDailyReward * 30 * price).toFixed(2)) + ' USD',
                                roi: "+ " + commas((dailyRewardInPercent * 30).toFixed(2)) + " %"
                            },
                            {
                                period: "ROI_ANNUALLY",
                                value:  commas((posDailyReward * 365).toFixed(2)) +' '+ $scope.currentPreset.tokenName,
                                usd: commas((posDailyReward * 365 * price).toFixed(2)) + ' USD',
                                roi: "+ " + commas((dailyRewardInPercent * 365).toFixed(2)) + " %"
                            }                                        
                        ];                        
                    }

                    function getValidationRules(type) {
                        let validationRules = {
                            stake : {
                                requireToCheck: type === 'delegator' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].stake},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'isInteger',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].stake)},
                                        desiredResult: true,
                                        errMsg: 'INTEGER_REQUIRED'
                                    },
                                    {
                                        method: 'inIntervalBothClosed',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].stake), min: Number($scope.clientPOSData.сonstraints.common.stake.min), max: Number($scope.clientPOSData.сonstraints.common.stake.max)},
                                        desiredResult: true,
                                        errMsg: {
                                                    msg: 'NOT_IN_RANGE',
                                                    params: {
                                                        min: $scope.clientPOSData.сonstraints.common.stake.min,
                                                        max: $scope.clientPOSData.сonstraints.common.stake.max
                                                    }
                                                }
                                    }                              
                                ],
                                errMsgSelector: `#${type}StakeInputWrapper .errMsg`
                            },
                            delegatedByOthers : {
                                requireToCheck: type === 'validator' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].delegatedByOthers},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'isInteger',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].delegatedByOthers)},
                                        desiredResult: true,
                                        errMsg: 'INTEGER_REQUIRED'
                                    },
                                    {
                                        method: 'inIntervalBothClosed',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].delegatedByOthers), min: 0 , max: Number($scope.clientPOSData.сonstraints.common.stake.max)},
                                        desiredResult: true,
                                        errMsg: {
                                                    msg: 'NOT_IN_RANGE',
                                                    params: {
                                                        min: 0,
                                                        max: $scope.clientPOSData.сonstraints.common.stake.max
                                                    }
                                                }
                                    }                              
                                ],
                                errMsgSelector: `#${type}DelegatedByOthersInputWrapper .errMsg`
                            },                            
                            delegatedByOwner : {
                                requireToCheck: type === 'validator' ? true : false,
                                checks : [                                    
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].delegatedByOwner},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'isInteger',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].delegatedByOwner)},
                                        desiredResult: true,
                                        errMsg: 'INTEGER_REQUIRED'
                                    },
                                    {
                                    method: 'inIntervalBothClosed',
                                    args: {value: Number($scope.clientPOSData[`${type}Input`].delegatedByOwner), min: Number($scope.clientPOSData.сonstraints.common.stake.min), max: Number($scope.clientPOSData.сonstraints.common.stake.max)},
                                    desiredResult: true,
                                    errMsg: {
                                                msg: 'NOT_IN_RANGE',
                                                params: {
                                                    min: $scope.clientPOSData.сonstraints.common.stake.min,
                                                    max: $scope.clientPOSData.сonstraints.common.stake.max
                                                }
                                            }
                                    }
                                ],
                                errMsgSelector: `#${type}DelegatedByOwnerInputWrapper .errMsg`
                            },                            
                            posFee : {
                                requireToCheck: type === 'validator' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].posFee},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'execTheRegExp',
                                        args: {str: $scope.clientPOSData[`${type}Input`].posFee, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                                        desiredResult: true,
                                        errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                                    },
                                    {
                                        method: 'matchToFixed',
                                        args: {value: $scope.clientPOSData[`${type}Input`].posFee, n: $scope.clientPOSData.сonstraints.common.posFee.decimalPlaces},
                                        desiredResult: true,
                                        errMsg: {
                                                    msg: 'MAX_DECIMALS',
                                                    params: {
                                                        decimals: $scope.clientPOSData.сonstraints.common.posFee.decimalPlaces
                                                    }
                                                }
                                    },
                                    {
                                    method: 'inIntervalBothClosed',
                                    args: {value: Number($scope.clientPOSData[`${type}Input`].posFee), min: Number($scope.clientPOSData.сonstraints.validator.posFee.min), max: Number($scope.clientPOSData.сonstraints.validator.posFee.max)},
                                    desiredResult: true,
                                    errMsg: {
                                                msg: 'NOT_IN_RANGE',
                                                params: {
                                                    min: $scope.clientPOSData.сonstraints.validator.posFee.min,
                                                    max: $scope.clientPOSData.сonstraints.validator.posFee.max
                                                }
                                            }
                                    }                                
                                ],
                                errMsgSelector: `#${type}FeeInputWrapper .errMsg`
                            },                            
                            txsPerDay : {
                                requireToCheck: type === 'validator' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].txsPerDay},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'isInteger',
                                        args: {value: Number($scope.clientPOSData[`${type}Input`].txsPerDay)},
                                        desiredResult: true,
                                        errMsg: 'INTEGER_REQUIRED'
                                    },
                                    {
                                    method: 'inIntervalBothClosed',
                                    args: {value: Number($scope.clientPOSData[`${type}Input`].txsPerDay), min: Number($scope.clientPOSData.сonstraints.common.txsPerDay.min), max: Number($scope.clientPOSData.сonstraints.common.txsPerDay.max)},
                                    desiredResult: true,
                                    errMsg: {
                                                msg: 'NOT_IN_RANGE',
                                                params: {
                                                    min: $scope.clientPOSData.сonstraints.common.txsPerDay.min,
                                                    max: $scope.clientPOSData.сonstraints.common.txsPerDay.max
                                                }
                                            }
                                    }                                
                                ],
                                errMsgSelector: `#${type}TXsPerDayInputWrapper .errMsg`
                            },                            
                            priceUSD : {
                                requireToCheck: type === 'validator' && $rootScope.mainToken.ticker === 'ENQ' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData[`${type}Input`].priceUSD},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'execTheRegExp',
                                        args: {str: $scope.clientPOSData[`${type}Input`].priceUSD, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                                        desiredResult: true,
                                        errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                                    },
                                    {
                                        method: 'matchToFixed',
                                        args: {value: $scope.clientPOSData[`${type}Input`].priceUSD, n: $scope.clientPOSData.сonstraints.common.priceUSD.decimalPlaces},
                                        desiredResult: true,
                                        errMsg: {
                                                    msg: 'MAX_DECIMALS',
                                                    params: {
                                                        decimals: $scope.clientPOSData.сonstraints.common.priceUSD.decimalPlaces
                                                    }
                                                }
                                    },
                                    {
                                    method: 'inIntervalBothClosed',
                                    args: {value: Number($scope.clientPOSData[`${type}Input`].priceUSD), min: Number($scope.clientPOSData.сonstraints.common.priceUSD.min), max: Number($scope.clientPOSData.сonstraints.common.priceUSD.max)},
                                    desiredResult: true,
                                    errMsg: {
                                                msg: 'NOT_IN_RANGE',
                                                params: {
                                                    min: $scope.clientPOSData.сonstraints.common.priceUSD.min,
                                                    max: $scope.clientPOSData.сonstraints.common.priceUSD.max
                                                }
                                            }
                                    }                                
                                ],
                                errMsgSelector: `#${type}PriceUSDInputWrapper .errMsg`
                            },
                            uptime : {
                                requireToCheck: type === 'validator' ? true : false,
                                checks : [
                                    {
                                        method: 'isSet',
                                        args: {data: $scope.clientPOSData.validatorInput.uptime},
                                        desiredResult: true,
                                        errMsg: 'REQUIRED'
                                    },
                                    {
                                        method: 'execTheRegExp',
                                        args: {str: $scope.clientPOSData.validatorInput.uptime, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                                        desiredResult: true,
                                        errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                                    },
                                    {
                                        method: 'matchToFixed',
                                        args: {value: $scope.clientPOSData.validatorInput.uptime, n: $scope.clientPOSData.сonstraints.validator.uptime.decimalPlaces},
                                        desiredResult: true,
                                        errMsg: {
                                                    msg: 'MAX_DECIMALS',
                                                    params: {
                                                        decimals: $scope.clientPOSData.сonstraints.validator.uptime.decimalPlaces
                                                    }
                                                }
                                    },
                                    {
                                    method: 'inIntervalBothClosed',
                                    args: {value: Number($scope.clientPOSData.validatorInput.uptime), min: Number($scope.clientPOSData.сonstraints.validator.uptime.min), max: Number($scope.clientPOSData.сonstraints.validator.uptime.max)},
                                    desiredResult: true,
                                    errMsg: {
                                                msg: 'NOT_IN_RANGE',
                                                params: {
                                                    min: $scope.clientPOSData.сonstraints.validator.uptime.min,
                                                    max: $scope.clientPOSData.сonstraints.validator.uptime.max
                                                }
                                            }
                                    }                                
                                ],
                                errMsgSelector: `#${type}UptimeInputWrapper .errMsg`
                            }                            
                        }
                        return validationRules;
                    }

                    $scope.processPOSData($scope.posCalcType);
                });     
            });
        });
    });

    app.controller('tokenROICtrl', function($scope, $routeParams, provider, dataValidator, $translate) {
        let maxBigInt = 1800000000;

        $scope.customToken = {
            targetPriceUSD: {
                value: 0.1,
                minValue: 0,
                maxValue: 1800000000
            },
            maxSupply: {
                tokens: {
                    value: 1000,
                    minValue: 0,
                    maxValue: 1800000000,
                },
                usd: ''
            },
            premine: {
                percent: {
                    value: 10,
                    minValue: 0,
                    maxValue: 100
                },
                tokens: '',
                usd: ''
            },
            tokensForMining: {
                tokens: '',
                usd: ''
            },
            referralProgramBudget: {
                percent: {
                    value: 1,
                    minValue: 0,
                    maxValue: 100
                },
                tokens: '',
                usd: ''
            },
            miningPeriod: {
                value: 365,
                minValue: 0,
                maxValue: 36500 
            },
            blockReward: {
                tokens: '',
                usd: ''
            },
            dailyEmission: {
                tokens: '',
                usd: ''
            },
            monthlyEmission: {
                tokens: '',
                usd: ''
            },            
            annualEmission: {
                tokens: '',
                usd: ''
            },
            minStake: {
                tokens: {
                    value: 1,
                    minValue: 0,
                    maxValue: ''
                },
                usd: ''
            },
            stakedTokens: {
                percent: {
                    value: 70,
                    minValue: 0,
                    maxValue: 100
                },
                tokens: '',
                usd: ''
            },
            roi: {
                percent: {
                    daily: '',
                    monthly: '',
                    annually: ''
                }
            }    
        }

        function getFirstStepValidationRules() {
            let validationRules = {
                maxSupply: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.maxSupply.tokens.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.maxSupply.tokens.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.maxSupply.tokens.value), min: Number($scope.customToken.maxSupply.tokens.minValue), max: Number($scope.customToken.maxSupply.tokens.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.maxSupply.tokens.minValue,
                                        max: $scope.customToken.maxSupply.tokens.maxValue
                                    }
                                }
                    },

                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenMaxSupplyWrapper .errMsg'
                },
                premine: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.premine.percent.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.premine.percent.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.premine.percent.value), min: Number($scope.customToken.premine.percent.minValue), max: Number($scope.customToken.premine.percent.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.premine.percent.minValue,
                                        max: $scope.customToken.premine.percent.maxValue
                                    }
                                }
                        },
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenPremineWrapper .errMsg'
                }
            };
            return validationRules;       
        }

        function getSecondStepValidationRules() {
            let validationRules = {
                targetPriceUSD: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.targetPriceUSD.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.targetPriceUSD.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.targetPriceUSD.value), min: Number($scope.customToken.targetPriceUSD.minValue), max: Number($scope.customToken.targetPriceUSD.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.targetPriceUSD.minValue,
                                        max: $scope.customToken.targetPriceUSD.maxValue
                                    }
                                }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenTargetPriceUSDWrapper .errMsg'
                },
                referralProgramBudget: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.referralProgramBudget.percent.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.referralProgramBudget.percent.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.referralProgramBudget.percent.value), min: Number($scope.customToken.referralProgramBudget.percent.minValue), max: Number($scope.customToken.referralProgramBudget.percent.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.referralProgramBudget.percent.minValue,
                                        max: $scope.customToken.referralProgramBudget.percent.maxValue
                                    }
                                }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenReferralProgramBudgetWrapper .errMsg'
                },
                miningPeriod: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.miningPeriod.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.miningPeriod.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.miningPeriod.value), min: Number($scope.customToken.miningPeriod.minValue), max: Number($scope.customToken.miningPeriod.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.miningPeriod.minValue,
                                        max: $scope.customToken.miningPeriod.maxValue
                                    }
                                }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenMiningPeriodWrapper .errMsg'
                },
                minStake: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.minStake.tokens.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.minStake.tokens.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenMinStakeWrapper .errMsg'
                },
                stakedTokens: {
                    checks: [
                        {
                            method: 'isSet',
                            args: {data: $scope.customToken.stakedTokens.percent.value},
                            desiredResult: true,
                            errMsg: 'REQUIRED'
                        },
                        {
                            method: 'execTheRegExp',
                            args: {str: $scope.customToken.stakedTokens.percent.value, regExpObj: /^([0-9]*\.?([0-9]*)){1}$/},
                            desiredResult: true,
                            errMsg: 'INVALID_SYMBOLS_IN_DIGITAL_VALUE'                                
                        },
                        {
                        method: 'inIntervalBothClosed',
                        args: {value: Number($scope.customToken.stakedTokens.percent.value), min: Number($scope.customToken.stakedTokens.percent.minValue), max: Number($scope.customToken.stakedTokens.percent.maxValue)},
                        desiredResult: true,
                        errMsg: {
                                    msg: 'NOT_IN_RANGE',
                                    params: {
                                        min: $scope.customToken.stakedTokens.percent.minValue,
                                        max: $scope.customToken.stakedTokens.percent.maxValue
                                    }
                                }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setStakedTokensWrapper .errMsg'
                }
            };
            return validationRules;       
        }

        function getThirdStepValidationRules() {
            let validationRules = {
                minStake: {
                    checks: [
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.minStake.tokens.value), max: Number($scope.customToken.premine.tokens)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_LESS_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('PREMINE')
                                        }
                                    }
                        },                    
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.minStake.tokens.value), max: Number($scope.customToken.maxSupply.tokens.value)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_LESS_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('TOKEN_MAX_SUPPLY')
                                        }
                                    }
                        },                    
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.minStake.tokens.value), max: maxBigInt},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'EXEED_MAX_VALUE_IN_TOKENS',
                                        params: {
                                            maxValue: maxBigInt,
                                            ticker: ''
                                        }
                                    }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenMinStakeWrapper .errMsg'        
                },
                premine: {
                    checks: [
                        {
                            method: 'moreOrEqualThan',
                            args: {value: Number($scope.customToken.premine.tokens), max: Number($scope.customToken.minStake.tokens.value)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_GREATER_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('MINIMAL_STAKE')
                                        }
                                    }
                        },                    
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.premine.tokens), max: Number($scope.customToken.maxSupply.tokens.value)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_LESS_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('TOKEN_MAX_SUPPLY')
                                        }
                                    }
                        },                    
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.premine.tokens), max: maxBigInt},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'EXEED_MAX_VALUE_IN_TOKENS',
                                        params: {
                                            maxValue: maxBigInt,
                                            ticker: ''
                                        }
                                    }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #outputTokenPremineWrapper .errMsg'        
                },
                maxSupply: {
                    checks: [
                        {
                            method: 'moreOrEqualThan',
                            args: {value: Number($scope.customToken.maxSupply.tokens.value), max: Number($scope.customToken.minStake.tokens.value)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_GREATER_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('MINIMAL_STAKE')
                                        }
                                    }
                        },
                        {
                            method: 'moreOrEqualThan',
                            args: {value: Number($scope.customToken.maxSupply.tokens.value), max: Number($scope.customToken.premine.tokens)},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'MUST_BE_LESS_OR_EQUAL_THAN_NAMED_VALUE',
                                        params: {
                                            name: $translate.instant('PREMINE')
                                        }
                                    }
                        },
                        {
                            method: 'lessOrEqualThan',
                            args: {value: Number($scope.customToken.maxSupply.tokens.value), max: maxBigInt},
                            desiredResult: true,
                            errMsg: {
                                        msg: 'EXEED_MAX_VALUE_IN_TOKENS',
                                        params: {
                                            maxValue: maxBigInt,
                                            ticker: ''
                                        }
                                    }
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setTokenMaxSupplyWrapper .errMsg'        
                },
                stakedTokens: {
                    checks: [
                        {
                            method: 'moreOrEqualThan',
                            args: {value: Number($scope.customToken.stakedTokens.tokens), max: Number($scope.customToken.minStake.tokens.value)},
                            desiredResult: true,
                            errMsg: 'STAKED_TOKENS_VS_MINIMAL_STAKE'
                        }
                    ],
                    errMsgSelector: '#customTokenROICalc #setStakedTokensWrapper .errMsg'
                }            
            };
            return validationRules;       
        }        

        $scope.calculate = function() {
            $scope.showExportControl = false;
            $('#customTokenROICalc .output-box-group').css({'opacity': 0.25});
            let firstStepValidationRules = getFirstStepValidationRules();
            $scope.checkDataFirstStep = dataValidator.batchValidate($scope.customToken, firstStepValidationRules);
            if ($scope.checkDataFirstStep) {              
                $scope.customToken.premine.tokens = ($scope.customToken.maxSupply.tokens.value * $scope.customToken.premine.percent.value/100);
                let secondStepValidationRules = getSecondStepValidationRules();
                $scope.checkDataSecondStep = dataValidator.batchValidate($scope.customToken, secondStepValidationRules);
                if ($scope.checkDataSecondStep) {
                    $scope.customToken.maxSupply.usd = toUSD($scope.customToken.maxSupply.tokens.value);
                    //Market Capitalization                
                    $scope.customToken.premine.usd = toUSD($scope.customToken.premine.tokens);
                    $scope.customToken.tokensForMining.tokens = $scope.customToken.maxSupply.tokens.value * (1-$scope.customToken.premine.percent.value/100);
                    $scope.customToken.tokensForMining.usd = toUSD($scope.customToken.tokensForMining.tokens);
                    $scope.customToken.referralProgramBudget.tokens = $scope.customToken.referralProgramBudget.percent.value/100 * $scope.customToken.tokensForMining.tokens;
                    $scope.customToken.referralProgramBudget.usd = toUSD($scope.customToken.referralProgramBudget.tokens);
                    //Emission
                    $scope.customToken.blockReward.tokens = $scope.customToken.tokensForMining.tokens/$scope.customToken.miningPeriod.value/5760;
                    $scope.customToken.blockReward.usd = toUSD($scope.customToken.blockReward.tokens);
                    $scope.customToken.dailyEmission.tokens = $scope.customToken.blockReward.tokens*5760;
                    $scope.customToken.dailyEmission.usd = toUSD($scope.customToken.dailyEmission.tokens);
                    $scope.customToken.monthlyEmission.tokens = $scope.customToken.dailyEmission.tokens*30;
                    $scope.customToken.monthlyEmission.usd = toUSD($scope.customToken.monthlyEmission.tokens);
                    $scope.customToken.annualEmission.tokens = $scope.customToken.dailyEmission.tokens*365;
                    $scope.customToken.annualEmission.usd = toUSD($scope.customToken.annualEmission.tokens);
                    //ROI
                    $scope.customToken.minStake.usd = toUSD($scope.customToken.minStake.tokens.value);
                    $scope.customToken.stakedTokens.tokens = $scope.customToken.stakedTokens.percent.value * $scope.customToken.premine.tokens/100;
                    $scope.customToken.stakedTokens.usd = toUSD($scope.customToken.stakedTokens.tokens);
                    $scope.customToken.roi.percent.daily = $scope.customToken.dailyEmission.tokens/$scope.customToken.stakedTokens.tokens*100;
                    $scope.customToken.roi.percent.monthly = $scope.customToken.monthlyEmission.tokens/$scope.customToken.stakedTokens.tokens*100;
                    $scope.customToken.roi.percent.annually = $scope.customToken.annualEmission.tokens/$scope.customToken.stakedTokens.tokens*100;

                    $scope.checkDataThirdStep = dataValidator.batchValidate($scope.customToken, getThirdStepValidationRules());
                    if ($scope.checkDataThirdStep) {
                        $('#customTokenROICalc .output-box-group').css({'opacity': 1});
                        $scope.showExportControl = true;
                    } else
                       $('#customTokenROICalc .output-box-group').css({'opacity': 0.25}); 
                } 
            }
        }

        function toUSD(value) {
            return value * $scope.customToken.targetPriceUSD.value;
        }

        $scope.$watch('customToken', function(newValue, oldValue) {
            $scope.calculate();
        }, true);

        $scope.calculate();

        $scope.printTokenROICalc = function () {
          window.print();
        }

        $scope.saveTokenROICalc = function () {
            let url = window.URL || window.webkitURL;
            let content = JSON.stringify($scope.customToken);
            let blob = new Blob([ content ], { type:"application/json;charset=utf-8;" });
            const objectURL = url.createObjectURL(blob);
            let tmpLinkDOMElement = angular.element('<a></a>');
            tmpLinkDOMElement.attr('href', objectURL);
            tmpLinkDOMElement.attr('download', 'customToken.json');
            tmpLinkDOMElement[0].click();
            url.revokeObjectURL(objectURL);
        }

        $scope.loadTokenROICalcJSON = function(f) {
            let tokenData = JSON.parse(f);
            $scope.customToken = JSON.parse(JSON.stringify(tokenData));  
            document.getElementById("fileElem").value = null;        
        }
    });

	app.controller('pagesCtrl', function($scope, $routeParams, provider) {
		$scope.page_num = Number($routeParams.page_num);
		$scope.page = provider.page.get({n:$routeParams.page_num});
	});
    app.controller('topsCtrl', function(GLOBAL_APP_CONFIG, $rootScope, $scope, $filter, provider, commonTools, customerInfoStorage) {
        $scope.page_num = 0;
        let entitiesOnPage = 20;
        $scope.mainTokenPrice = null;
        let currentPreset = GLOBAL_APP_CONFIG;
        let bannedAccsArr = currentPreset.bannedAccs !== undefined ? currentPreset.bannedAccs : [];
        let allCustomersAccountsInfo = undefined;

        $rootScope.$watch('mainToken', function(newValue, oldValue) {
            if (newValue !== undefined || oldValue !== undefined) {
                if ($rootScope.mainToken.ticker === 'ENQ') {
                    provider.stats.get({}, function(stat) {                        
                        $scope.cg_usdDecimals = stat.cg_usd.split('.')[1].length;
                        $scope.tokenToUSDDecimals = $scope.cg_usdDecimals + $rootScope.mainToken.decimals;
                        $scope.mainTokenPrice = stat.cg_usd;
                    });
                }

                $scope.getHistory = function(page){
                    $scope.isLoading = true;

                    provider.top_accounts.get({page:page}, function(accounts){

                        $scope.page_count = accounts.page_count;
                        $scope.accs = accounts;
                        $scope.accs.accounts.forEach(function(acc, i) {
                            acc.banned = bannedAccsArr.indexOf(acc.id) !== -1 ? true : false;
                            acc.rank = i + 1 + entitiesOnPage * page;
                            acc.percentage = commonTools.getPersentageString(acc.percentage);
                            if ($rootScope.mainToken.ticker === 'ENQ') {
                                $scope.$watch('mainTokenPrice', function(newValue, oldValue) {
                                    if (newValue !== null || oldValue !== null) {
                                        acc.valueUSD = $filter('US_COMMAS_BIGINT_DECIMALS')(BigInt(acc.amount) * commonTools.valueToBigInt($scope.mainTokenPrice, $scope.cg_usdDecimals).value, $scope.tokenToUSDDecimals, 2) +' '+ 'USD';
                                    }
                                });
                            }
                            if (allCustomersAccountsInfo !== undefined) {
                                let customerAccountInfo = allCustomersAccountsInfo.find(accountInfoBlock => accountInfoBlock.account_id === acc.id);
                                if (customerAccountInfo !== undefined) {
                                    if (customerAccountInfo.tag !== undefined) {
                                        acc.tag = customerAccountInfo.tag;
                                    }
                                }
                            }    
                        });
                        $scope.isLoading = false;
                    });
                    $scope.page_num = page;
                };
                customerInfoStorage.getStorage('account').query({}, function(allAccountsCustomersInfo) {            
                    allCustomersAccountsInfo = allAccountsCustomersInfo;
                    $scope.getHistory(0);
                });
            }
        });
    });
    app.controller('tokensCtrl', function($scope, $http, provider, commonTools, $translate, customerInfoStorage, currencyExchange) {
        let allCustomersTokensInfo = undefined;
        $scope.tokensLogo = {};
        $scope.tabsOrder = ['all', 'reissuable', 'non_reissuable', 'mineable'];
        $scope.tokensPages = {
            all : {
                requestParams: {page: 0},
                entitiesOnPage: 0,
                page_count: 0,
                tokens : [],
                page_num : 0
            },
            reissuable : {
                requestParams: {page: 0, type: 'reissuable'},
                entitiesOnPage: 0,
                page_count: 0,
                tokens : [],
                page_num : 0
            },
            non_reissuable: {
                requestParams: {page: 0, type: 'non_reissuable'},
                entitiesOnPage: 0,
                page_count: 0,
                tokens : [],
                page_num : 0
            },
            mineable : {
                requestParams: {page: 0, type: 'minable'},
                entitiesOnPage: 0,
                page_count: 0,
                tokens : [],
                page_num : 0
            }
        }

        provider.get_tokens_count.get(function(response) {
            $scope.tokensCount = {
                all : response.count,
                reissuable : response.reissuable,
                non_reissuable : response.non_reissuable,
                mineable : response.minable
            }
        });

        $scope.commasFormatter = new Intl.NumberFormat("en-us", {
            useGrouping: true,
            minimumFractionDigits: 2,
            minimumFractionDigits: 6
        });

        $scope.zeroTrim = commonTools.zeroTrim;

        $scope.getPage = function(paramsObj = {page: 0, type: 'all'}) {            
            provider.get_tickers_all_unfiltered.query(function(tickers_all_unfiltered) {
                $scope.tickers = {};
                tickers_all_unfiltered.forEach(function(ticker) {
                    $scope.tickers[ticker.hash] = {ticker: ticker.ticker, caption: ticker.caption, logo: undefined};
                });

                $scope.tokensPages[paramsObj.type].requestParams.page = paramsObj.page;
                let requestParams = $scope.tokensPages[paramsObj.type].requestParams;

                provider.get_token_info_page.get(requestParams, function(tokenInfo) {
                    $scope.tokensPages[paramsObj.type].page_count = tokenInfo.page_count;
                    $scope.tokensPages[paramsObj.type].entitiesOnPage = tokenInfo.page_size;
                    $scope.tokensPages[paramsObj.type].tokens = tokenInfo.tokens;                 
                    $scope.tokensPages[paramsObj.type].tokens.forEach(function(token, i) {                        
                        token.priceInfo = commonTools.getTokenPriceInfo(token);
                        token.marketCapUSD = (token.priceInfo.value !== undefined ? '$' + currencyExchange.bigIntConvertValueToCurrency(token.total_supply, token.priceInfo.value, token.decimals, 2) : '---');
                        token.type = commonTools.getTokenType(token).toUpperCase();
                        token.status = (token.in_slot === 1 ? 'Active' : 'Inactive').toUpperCase();                        
                        if (allCustomersTokensInfo !== undefined) {
                            let customerTokenInfo = allCustomersTokensInfo.find(tokenInfoBlock => tokenInfoBlock.token_id === token.token_hash);
                            if (customerTokenInfo !== undefined) {
                                if (customerTokenInfo.coingecko_id !== undefined) {
                                    $http({method: 'GET', url: 'https://api.coingecko.com/api/v3/simple/price?ids=' + customerTokenInfo.coingecko_id + '&vs_currencies=USD'}).
                                    then(function (response) {
                                        let info = response.data[customerTokenInfo.coingecko_id];
                                        if (response.data !== undefined && info !== undefined && info.usd !== undefined) {
                                            token.priceInfo = {
                                                origin : 'user-info-cg',
                                                value  : Number.parseFloat(info.usd).toFixed(10)
                                            }
                                            token.marketCapUSD = '$' + currencyExchange.bigIntConvertValueToCurrency(token.total_supply, token.priceInfo.value, token.decimals, 2);
                                        }
                                    });
                                }
                                if (customerTokenInfo.logo !== undefined) {
                                    if (!$scope.hasOwnProperty('token_' + token.token_hash)) {
                                        $scope['token_' + token.token_hash] = {customerInfo : {logoImg : undefined, logoURL : customerInfoStorage.getLogoPath('token') + '/' + customerTokenInfo.logo}};
                                        customerInfoStorage.assignLogo($scope, 'token_' + token.token_hash, customerTokenInfo.logo);
                                        $scope.tokensLogo['token_' + token.token_hash] = {logo :  $scope['token_' + token.token_hash].customerInfo};
                                    }
                                }                                    
                            }
                        }

                        token.rank = i + 1 + $scope.tokensPages[paramsObj.type].entitiesOnPage * requestParams.page;                         
                    });
                    $scope.tokensPages[paramsObj.type].page_count = tokenInfo.page_count;
                });

            });
            $scope.tokensPages[paramsObj.type].page_num = paramsObj.page;
        };

        customerInfoStorage.getStorage('token').query({}, function(allTokensCustomersInfo) {            
            allCustomersTokensInfo = allTokensCustomersInfo;
            $scope.tabsOrder.forEach(function(type) {
                $scope.getPage({page: 0, type: type});
            });
        });
    });

    app.controller('tokenCtrl', function($scope, $rootScope, $routeParams, GLOBAL_APP_CONFIG, provider, customerInfoStorage, commonTools, $translate, $filter, roiCalc, Toast, $http, currencyExchange) {
        let currentPreset = GLOBAL_APP_CONFIG;
        $scope.additionalTokenData = {
            officialSiteLink : '',
            officialSiteText : '---',
            whitepaperLink : '',
            whitepaperLinkText : '---',
            guidesLink : '',
            guidesLinkText : '---'
        };
        $scope.commasFormatter = new Intl.NumberFormat("en-us", {
            useGrouping: true,
            minimumFractionDigits: 2,
            minimumFractionDigits: 6
        });

        $scope.zeroTrim = commonTools.zeroTrim;
        $scope.stake = null;
        $scope.mediaWidgetNamePrefix = 'default';
        $scope.page_num = 0;
        let entitiesOnPage = 20;
        $scope.showMiningFeatures = false;
        $scope.currencyExchange = currencyExchange;
        provider.token_info.query({hash:$routeParams.hash}, function(token_info) {
            $scope.token = token_info[0] !== undefined ? token_info[0] : {};
            if ($scope.token === undefined)
                console.log('No such token');
            $scope.token.type = commonTools.getTokenType($scope.token);
            $scope.tokenTypeBadgeClass = getTokenTypeBadgeClass($scope.token.type);
            $scope.tokenDescriptionText = undefined;
            $scope.token.priceInfo = commonTools.getTokenPriceInfo($scope.token);
            $scope.token.marketCap = currencyExchange.bigIntConvertValueToCurrency($scope.token.total_supply, $scope.token.priceInfo.value, $scope.token.decimals, 2);
            if ($scope.token.type === 'Mineable')
                $scope.token.fdMarketCap = currencyExchange.bigIntConvertValueToCurrency($scope.token.max_supply, $scope.token.priceInfo.value, $scope.token.decimals, 2);
            else
                $scope.token.fdMarketCap = $scope.token.marketCap;
            customerInfoStorage.getInfo('token', $routeParams.hash).then(function(customerInfo) {                
                $scope.token.customerInfo = customerInfo;
                $rootScope.$watch('curLang.id', function(newValue, oldValue) {                                    
                    if ($scope.token.customerInfo.description !== undefined && Object.keys($scope.token.customerInfo.description).length !== 0) {
                        if ($scope.token.customerInfo.description.hasOwnProperty(newValue) && $scope.token.customerInfo.description[newValue] !== undefined) {
                            $scope.tokenDescriptionText = $scope.token.customerInfo.description[newValue];
                        } else if ($scope.token.customerInfo.description.hasOwnProperty('en') && $scope.token.customerInfo.description.en !== undefined) {
                            $scope.tokenDescriptionText = $scope.token.customerInfo.description.en;
                        } else {
                            let customerLangArr = Object.keys($scope.token.customerInfo.description);                        
                            customerLangArr.some(function(customerLangArrElem) {
                                appLangArr.some(function(elem) {
                                    if (customerLangArrElem === elem && $scope.tokenDescriptionText === undefined) {
                                        $scope.tokenDescriptionText = $scope.token.customerInfo.description[elem];
                                    }
                                });
                            });
                        }                    
                    }
                });
                if ($scope.token.customerInfo !== undefined) {
                    if ($scope.token.customerInfo.website !== undefined) {
                        $scope.additionalTokenData.officialSiteLink = $scope.additionalTokenData.officialSiteText = $scope.token.customerInfo.website;               
                    }
                    if ($scope.token.customerInfo.documents !== undefined && $scope.token.customerInfo.documents.hasOwnProperty('whitepaper')) {
                        $scope.additionalTokenData.whitepaperLink = $scope.additionalTokenData.whitepaperLinkText = $scope.token.customerInfo.documents.whitepaper;               
                    }     

                    if ($scope.token.customerInfo.documents !== undefined && $scope.token.customerInfo.documents.hasOwnProperty('guides')) {
                        $scope.additionalTokenData.guidesLink = $scope.additionalTokenData.guidesLinkText = $scope.token.customerInfo.documents.guides;               

                    }
                    if ($scope.token.customerInfo.media !== undefined) {
                        $scope.media = $scope.token.customerInfo.media;
                        $scope.mediaWidgetNamePrefix = 'project';               
                    }
                    if ($scope.token.customerInfo.coingecko_id !== undefined) {
                        let coingecko_id = $scope.token.customerInfo.coingecko_id;
                        $http({method: 'GET', url: 'https://api.coingecko.com/api/v3/simple/price?ids=' + coingecko_id + '&vs_currencies=USD'}).
                        then(function (response) {
                            let info = response.data[coingecko_id];
                            if (response.data !== undefined && info !== undefined && info.usd !== undefined) {
                                token.priceInfo = {
                                    origin : 'user-info-cg',
                                    value  : Number.parseFloat(info.usd).toFixed(20)
                                }
                                $scope.token.marketCap = currencyExchange.bigIntConvertValueToCurrency($scope.token.total_supply, token.priceInfo.value, $scope.token.decimals, 2);
                            }
                        });               
                    }
                    customerInfoStorage.assignLogo($scope, 'token', $scope.token.customerInfo.logoURL);
                }              
            }, function(res) {
                $scope.token.customerInfo = res;
            });

            provider.stats.get({}, function(stat) {
                if ($scope.token.type === "Mineable") {
                    function setCalcStep() {
                        let diff = parseInt($scope.max_stake - $scope.min_stake);
                        let orderStr =  String(diff)
                        let order = orderStr.length;
                        order = order - 2;
                        let step = Math.pow(10, order);

                        if (parseInt(diff / step) > 10)
                            step *= 5;

                        $scope.upStake = function() {
                            $scope.stake = $scope.stake == '' ? $scope.min_stake : parseFloat($scope.stake);                            
                            if ( ($scope.stake + step) > $scope.max_stake)
                                $scope.stake = $scope.max_stake;
                            else if (($scope.stake + step) < $scope.min_stake)
                                $scope.stake = $scope.min_stake;
                            else
                                $scope.stake += step;
                        }

                        $scope.downStake = function() {
                            $scope.stake = $scope.stake == '' ? $scope.min_stake : parseFloat($scope.stake);
                            if (($scope.stake - step) < $scope.min_stake)
                                $scope.stake = $scope.min_stake;
                            else if (($scope.stake - step) > $scope.max_stake)
                                $scope.stake = $scope.max_stake;
                            else
                                $scope.stake -= step;
                        }                
                    }
                    let poaROIData = {
                        stake : null,
                        stakeTicker : $scope.token.ticker,
                        stakeDecimals : $scope.token.decimals,
                        roiArrForLerp : null,
                        stat : stat,
                        factorIfReferral : null,
                        periods : [
                            {
                                titleInLocale: "ROI_WEEKLY",
                                daysFactor: 7 
                            },
                            {
                                titleInLocale: "ROI_MONTHLY",
                                daysFactor: 30 
                            },
                            {
                                titleInLocale: "ROI_ANNUALLY",
                                daysFactor: 365 
                            }
                        ],
                        currencyInfo : [
                            {
                                ticker : $scope.token.ticker,
                                rate : 1,
                                toFixed : 2 
                            }
                        ]
                    };

                    $scope.reloadROI = function(stake) {
                        let roiDataInit = [
                            {
                                period : "ROI_WEEKLY",
                                roi : '---',
                                values : [{value : '---'}]
                            },
                            {
                                period : "ROI_MONTHLY",
                                roi : '---',
                                values : [{value : '---'}]
                            },
                            {
                                period : "ROI_ANNUALLY",
                                roi : '---',
                                values : [{value : '---'}]
                            }
                        ];
                        let result = [];
                        if (poaROIData.roiArrForLerp.length === 0) {
                            return roiDataInit;
                        } else if ((stake < $scope.min_stake || stake > $scope.max_stake) || (stake !== undefined && stake === '') || !(poaROIData.roiArrForLerp.length > 0)) {
                            Toast.stakeInfoToast(`Please set stake in the range ${$scope.min_stake}...${$scope.max_stake}`);
                            return roiDataInit;                            
                        } else {
                            poaROIData.stake = parseFloat(stake);
                            poaROIData.factorIfReferral = $scope.refCheck === true ? 0.1 : 0;
                            result = roiCalc.getPOA_ROIs(poaROIData);                                                                   
                        }
                        return result.length === 0 ? roiDataInit : result;
                    }

                    provider.roi.query({hash:$routeParams.hash},function(roiArrForLerp) {
                        if (Array.isArray(roiArrForLerp) && roiArrForLerp.length > 0) {
                            $scope.min_stake  = roiArrForLerp[0].stake / Math.pow(10, $scope.token.decimals);
                            $scope.stake = $scope.min_stake;
                            $scope.max_stake = roiArrForLerp[roiArrForLerp.length - 1].stake / Math.pow(10, $scope.token.decimals);
                            poaROIData.roiArrForLerp = roiArrForLerp;
                            setCalcStep();
                            let minROIArr = $scope.reloadROI($scope.min_stake);
                            $scope.minAnnualROI = minROIArr[minROIArr.length - 1].roi;
                            $scope.roiCalcState = '';
                        } else {
                            poaROIData.roiArrForLerp = [];
                            $scope.stake = '---';
                            $scope.minAnnualROI = '---';
                            $scope.roiCalcState = 'disabled';
                        }                        
                                           
                        $scope.$watch('stake', function(newValue, oldValue) {
                            if (newValue !== undefined && newValue !== '') {                                
                                $scope.roiData = $scope.reloadROI(newValue);
                            }
                        });
                    });                                    
                    $scope.showMiningFeatures = true;
                }

                if ($routeParams.hash === $rootScope.mainToken.hash) {
                    $scope.tokenCsup = $filter('US_COMMAS_BIGINT_DECIMALS')(BigInt(stat.csup), $scope.token.decimals, $scope.token.decimals) +' '+ $scope.token.ticker;
                }
            });

            $scope.blocksToBeMined = $scope.token.block_reward > 0 ? Math.floor(($scope.token.max_supply - $scope.token.total_supply)/$scope.token.block_reward) : '---';
            if ($scope.token.hasOwnProperty('owner') && $scope.token.hasOwnProperty('hash')) {
                commonTools.genQR('#qrTokenOwnerCode', $scope.token.owner);
                commonTools.genQR('#qrTokenIDCode', $scope.token.hash);                
            }

            provider.get_tickers_all_unfiltered.query(function(tickers_all_unfiltered) {
                let ticker = tickers_all_unfiltered.find(function(ticker) {return (ticker.hash === $scope.token.hash) ? true : false;});
                if (ticker === undefined)
                    ticker = {
                        ticker  : '',
                        caption : ''
                    }
                $scope.token.ticker = ticker.ticker;
                $scope.token.caption = ticker.caption;
                $rootScope.$watch('mainToken', function(newValue, oldValue) {
                    if (newValue.hasOwnProperty('ticker') && newValue.ticker !== undefined) {
                        let feesObject = commonTools.getTokenFees($scope.token, newValue);
                        $scope.token.fee_type = feesObject.fee_type;
                        $scope.token.fee_value = feesObject.fee_value;
                        $scope.token.fee_min = feesObject.fee_min;
                    }
                }, true);               
            });
            provider.transaction.get({hash:$routeParams.hash}, function(issue_token_tx) {
                $scope.issue_token_tx = issue_token_tx;
                provider.macroblock.get({hash:issue_token_tx.kblocks_hash}, function(macroblock) {
                    if (macroblock.kblock !== undefined) {
                        $scope.token.issue_time = macroblock.kblock.time;
                    }
                });
            });
        });

        provider.get_token_holder_count.get({token_hash:$routeParams.hash}, function(tokenHolders) {
            $scope.tokenHoldersCount = tokenHolders.count;                        
        });        

        $scope.getHistory = function(page){
            $scope.isLoading = true;
            provider.top_accounts.get({page:page, token_hash:$routeParams.hash}, function(accounts){
                $scope.accs = accounts;
                $scope.accs.accounts.forEach(function(acc, i) {
                    acc.percentage = commonTools.getPersentageString(acc.percentage);
                    acc.rank = i + 1 + entitiesOnPage * page;
                });
                $scope.isLoading = false;
            });
            $scope.page_num = page;
        };
        function getTokenTypeBadgeClass(classAsString) {
            let badgeClass = '';
            switch (classAsString) {
                case 'Non-reissuable':
                    badgeClass = "badge-secondary";
                    break;
                case "Reissuable":
                    badgeClass = "badge-info";
                    break;
                case "Mineable":
                    badgeClass = "badge-success";
                    break;
                default:
                    badgeClass = "d-none";
            }
            return badgeClass;
        }
        $scope.getHistory(0);
    });
    app.controller('posContractsCtrl', function($scope, provider, $translate, customerInfoStorage) {
        $scope.toggleActivePOSList = function(active) {
            $scope.active = active;
        }
        $scope.posLogo = {};
        $scope.activePOSAmount = $scope.inactivePOSAmount = 0;
        let allCustomersAccountsInfo = undefined;

       function getPOSContracts(){
            $scope.isLoading = true;
            $scope.all_pos_list = {}            
            provider.get_pos_names.query(function(pos_names) {
                $scope.posNames = {};
                pos_names.forEach(function(pos) {
                    $scope.posNames[pos.pos_id] = pos.name;
                });
                provider.get_pos_list_all.get(function(posList) {
                    $scope.posContracts = posList.pos_contracts;
                    $scope.page_count = posList.page_count
                    customerInfoStorage.getStorage('pos').query({}, function(allPOSCustomersInfo) { 
                        $scope.posContracts.forEach(function(posContract, i) {
                            if (posContract.active === 1)
                                $scope.activePOSAmount++;
                            else if (posContract.active === 0)
                                $scope.inactivePOSAmount++;
                            
                            posContract.fee = posContract.fee/1e2 + '%';                       
                            posContract.stake_power = (posContract.stake_power*100).toFixed(2) + '%';
                            posContract.active_stake_power = (posContract.active_stake_power*100).toFixed(2) + '%';
                            posContract.active_stake_share = (posContract.active_stake_share*100).toFixed(2) + '%';
                            posContract.roi = posContract.roi/1e2;
                            posContract.uptime = (posContract.uptime*1e2).toFixed(2) + '%';

                            let customerPOSInfo = allPOSCustomersInfo.find(posInfoBlock =>posInfoBlock.pos_id === posContract.pos_id);
                            if (customerPOSInfo !== undefined && customerPOSInfo.logo !== undefined) {
                                if (!$scope.hasOwnProperty('pos_' + posContract.pos_id)) {
                                    $scope['pos_' + posContract.pos_id] = {customerInfo : {logoImg : undefined, logoURL : customerInfoStorage.getLogoPath('pos') + '/' + customerPOSInfo.logo}};
                                    customerInfoStorage.assignLogo($scope, 'pos_' + posContract.pos_id, customerPOSInfo.logo);
                                    $scope.posLogo['pos_' + posContract.pos_id] = {logo :  $scope['pos_' + posContract.pos_id].customerInfo};
                                }
                            }
                            if (allCustomersAccountsInfo !== undefined) {
                                let customerAccountInfo = allCustomersAccountsInfo.find(accountInfoBlock => accountInfoBlock.account_id === posContract.owner);
                                if (customerAccountInfo !== undefined) {
                                    if (customerAccountInfo.tag !== undefined) {
                                        posContract.ownersTag = customerAccountInfo.tag;
                                    }
                                }
                            }                            
                        });
                    });    
                    $scope.isLoading = false;
                });
            });
        };
        $scope.active = 1;
        customerInfoStorage.getStorage('account').query({}, function(allAccountsCustomersInfo) {            
            allCustomersAccountsInfo = allAccountsCustomersInfo;
            getPOSContracts();
        });        
    });

    app.controller('posContractCtrl', function($scope, $routeParams, $rootScope, $filter, GLOBAL_APP_CONFIG, provider, customerInfoStorage, commonTools, apexRadialChart, langService) {
        if (GLOBAL_APP_CONFIG.POSChallenge.on === true) {
            $scope.usePOSChallengeAddress = GLOBAL_APP_CONFIG.POSChallenge.on
            $scope.POSChallengeAddress = GLOBAL_APP_CONFIG.POSChallenge.address;
        } else {
            $scope.usePOSChallengeAddress = false;
            $scope.POSChallengeAddress = '';
        }

        $rootScope.$watch('mainToken', function(newValue, oldValue) {
            if (newValue !== undefined || oldValue !== undefined) {
                if ($rootScope.mainToken.ticker === 'ENQ') {
                    provider.stats.get({}, function(stat) {                        
                        $scope.mainTokenPrice = stat.cg_usd;
                        $scope.multipleBigintOnFloat = commonTools.multipleBigintOnFloat;
                    });
                }
            }
        });        

        $scope.dalegator_page_num = 0;
        $scope.delegators_page_count = 0;
        $scope.reward_page_num = 0;        
        $scope.selfDelegatedAmount = 0;
        $scope.ENQDelegatedAmount = 0
        $scope.othersDelegatedAmount = 0;
        $scope.selfDelegationRecord = undefined;
        $scope.posRewards = {};
        $scope.selfDelegatedPercentage = {value: 0, str: '0%'};
        $scope.ENQDelegatedPercentage = {value: 0, str: '0%'};
        $scope.othersDelegatedPercentage = {value: 0, str: '0%'};
        $scope.delegatorIsOwner = false;
        let chartElementSelector = 'delegatedBalanceChart';
        let posLabelsTitles = ['BY_OTHERS','STAKING_CHALLENGE','DELEGATED_BY_OWNER'];

        $scope.getDelegators = function(page) {
            $scope.isLoading = true;
            provider.get_delegated_list.query({delegator: $scope.POSChallengeAddress},function(enq_delegated_arr) {
                let enq_delegation_record = enq_delegated_arr.find(delegation => delegation.pos_id === $routeParams.pos_id);
                $scope.ENQDelegatedAmount = enq_delegation_record !== undefined ? enq_delegation_record.delegated : 0;
                provider.get_delegators_page.get({pos_id:$routeParams.pos_id, page: page}, function(delegators_page) {
                    $scope.delegators_page_count = delegators_page.page_count;
                    $scope.delegators = delegators_page;
                    $scope.delegators.pos_delegators.forEach(function(delegator) {
                        delegator.share = getDelegatedPercentage(delegator.amount);
                    });
                    
                    if ($scope.selfDelegationRecord === undefined) {
                        $scope.selfDelegationRecord = delegators_page.pos_delegators.find(delegator_record => delegator_record.delegator === $scope.posContract.owner);
                        if ($scope.selfDelegationRecord === undefined) {
                            provider.get_delegators_list.query({pos_id:$routeParams.pos_id}, function(delegators) {
                                $scope.selfDelegationRecord = delegators.find(delegator_record => delegator_record.delegator === $scope.posContract.owner);
                                if ($scope.selfDelegationRecord !== undefined) {
                                    if ($scope.selfDelegationRecord.delegator === $scope.POSChallengeAddress) {
                                        $scope.delegatorIsOwner = true;
                                        $scope.selfDelegatedAmount = 0;
                                    } else {
                                        $scope.selfDelegatedAmount = $scope.selfDelegationRecord.amount;
                                    }
                                } 
                                populatePercentageData();
                                renderChart();                                 
                            });                           
                        } else {
                            if ($scope.selfDelegationRecord.delegator === $scope.POSChallengeAddress) {
                                $scope.delegatorIsOwner = true;
                                $scope.selfDelegatedAmount = 0;
                            } else {
                                $scope.selfDelegatedAmount = $scope.selfDelegationRecord.amount;
                            }
                            populatePercentageData();
                            renderChart();                            
                        }                  
                    }
                });
            });
            $scope.delegator_page_num = page;
        }

        $scope.getPOSRewards = function(page){
            $scope.isLoading = true;
            provider.account.get({id:$routeParams.pos_id, filter:'', page:page}, function(account){
                $scope.posRewards.records = account.records;
                $scope.posRewards.page_count = account.page_count;
                $scope.posRewards.records.forEach(function(reward) {
                    provider.sblock.get({hash:reward.hash}, function(sblock) {
                        provider.macroblock.get({hash:sblock.header.kblocks_hash}, function(macroblock) {
                            reward.height = macroblock.kblock.n;
                        });
                    });
                });                
                $scope.isLoading = false;
            });
            $scope.pos_rewards_page_num = page;
        };

        $scope.getPOSRewards(0);

        function populatePercentageData() {
            $scope.othersDelegatedAmount = $scope.posContract.stake - $scope.selfDelegatedAmount - $scope.ENQDelegatedAmount;                
            $scope.selfDelegatedPercentage = getDelegatedPercentage($scope.selfDelegatedAmount);
            $scope.ENQDelegatedPercentage = getDelegatedPercentage($scope.ENQDelegatedAmount);
            $scope.othersDelegatedPercentage = getDelegatedPercentage($scope.othersDelegatedAmount);
        }

        function getDelegatedPercentage(value) {
            if (value !== null && value >= 0 && $scope.posContract.stake !== 0) {
                let percentage = value/$scope.posContract.stake*100;
                return {
                   value: percentage,
                   str: commonTools.getPersentageString(percentage) 
                }
            }
        }

        $rootScope.$on('$translateChangeSuccess', function(event, current, previous) {
            if (document.getElementById(chartElementSelector)) {
                $('#' + chartElementSelector).empty();
                renderChart();
            }
        });

        function renderChart() {
            let labelsArr = commonTools.arrayTranslate(posLabelsTitles);
            let colorsArr = ['#9E71FF', '#2FE0A0', '#0072FF'];
            let series_self = $scope.selfDelegatedPercentage !== undefined ? $scope.selfDelegatedPercentage.value : 0;
            let series_enq = $scope.ENQDelegatedPercentage !== undefined ? $scope.ENQDelegatedPercentage.value : 0;
            let series_others = $scope.othersDelegatedPercentage !== undefined ? $scope.othersDelegatedPercentage.value : 0;            
            let seriesArr = [series_others.toFixed(2), series_enq.toFixed(2), series_self.toFixed(2)];
            let margin = 6;            

            if (!$scope.usePOSChallengeAddress) {
                seriesArr.splice(1,1);
                labelsArr.splice(1,1);
                colorsArr.splice(1,1);
                margin = 8;
            } else if ($scope.delegatorIsOwner) {
                seriesArr.splice(2,1);
                labelsArr.splice(2,1);
                colorsArr.splice(2,1);
                margin = 8;
            }

            let radialChartOptions = {
                series: seriesArr,
                chart: {
                    type: 'radialBar',
                    redrawOnParentResize: true,
                    height: '225px'
                },
                colors: colorsArr,
                plotOptions: {
                    radialBar: {
                        offsetX: 0,
                        offsetY: -20,
                        endAngle: 270,
                        track: {
                            margin: margin,
                            background: '#D1DDE8'
                        },  
                        dataLabels: {
                            name: {
                                fontSize: '12px',
                                color: 'rgb(0,0,0)'
                                },
                            value: {
                                    fontSize: '12px',
                                    color: 'rgb(0,0,0)',
                                    offsetY: 0
                                }
                        }
                    }
                },
                labels: labelsArr
            };

            let radialChart = new ApexCharts(document.querySelector('#' + chartElementSelector), radialChartOptions);  
            radialChart.render(); 
        }

        provider.get_pos_info.query({pos_id:$routeParams.pos_id}, function(pos_info) {
            let appLangArr = langService.languages.map(elem => elem.id);
            $scope.posContract = pos_info[0];
            customerInfoStorage.getInfo('pos', $routeParams.pos_id).then(function(customerInfo) {
                $scope.posContract.customerInfo = customerInfo;
                $rootScope.$watch('curLang.id', function(newValue, oldValue) {
                    $scope.posDescriptionText = undefined;                
                    if ($scope.posContract.customerInfo.description !== undefined && Object.keys($scope.posContract.customerInfo.description).length !== 0) {
                        if ($scope.posContract.customerInfo.description.hasOwnProperty(newValue) && $scope.posContract.customerInfo.description[newValue] !== undefined) {
                            $scope.posDescriptionText = $scope.posContract.customerInfo.description[newValue];
                        } else if ($scope.posContract.customerInfo.description.hasOwnProperty('en') && $scope.posContract.customerInfo.description.en !== undefined) {
                            $scope.posDescriptionText = $scope.posContract.customerInfo.description.en;
                        } else {
                            let customerLangArr = Object.keys($scope.posContract.customerInfo.description);                        
                            customerLangArr.some(function(customerLangArrElem) {
                                appLangArr.some(function(elem) {
                                    if (customerLangArrElem === elem && $scope.posDescriptionText === undefined) {
                                        $scope.posDescriptionText = $scope.posContract.customerInfo.description[elem];
                                    }
                                });
                            });
                        }                    
                    }
                });
                $scope.media = $scope.posContract.customerInfo.media;
                customerInfoStorage.assignLogo($scope, 'posContract', $scope.posContract.customerInfo.logoURL);
            }, function(res) {
                $scope.posContract.customerInfo = res;
            });

            commonTools.genQR('#qrPOSOwnerCode', $scope.posContract.owner);
            commonTools.genQR('#qrPOSIDCode', $scope.posContract.pos_id);
            $scope.posContract.stake_power = ($scope.posContract.stake_power*100).toFixed(2) + '%';
            $scope.posContract.active_stake_power = ($scope.posContract.active_stake_power*100).toFixed(2) + '%';
            $scope.posContract.active_stake_share = ($scope.posContract.active_stake_share*100).toFixed(2) + '%';
            $scope.posContract.uptime = ($scope.posContract.uptime*100).toFixed(2) + '%';
            $scope.posContract.fee = $scope.posContract.fee;
            $scope.posContract.roi = $scope.posContract.roi;
            $scope.getDelegators(0);
        });
    });

	app.controller('macroblockCtrl', function(GLOBAL_APP_CONFIG, $scope, $routeParams, provider) {
        let currentPreset = GLOBAL_APP_CONFIG;
        $scope.showSBlocks = currentPreset.pagesSectionsVisibility.showSBlocks;
		$scope.macroblock = provider.macroblock.get({hash:$routeParams.hash}, function(mackroblock) {
            $scope.showSnapshot = mackroblock.snapshot_hash !== null ? true : false;
        });
	});

	app.controller('mblockCtrl', function($scope, $routeParams, provider) {
		provider.mblock.get({hash:$routeParams.hash}, function(mblock) {
           $scope.mblock = mblock;
           let tokenHash = mblock.header.token;
            provider.token_info.query({hash:tokenHash}, function(token_info) {
               $scope.rewardToken = {
                    ticker: token_info[0].ticker,
                    decimals: token_info[0].decimals
               }            
            });
        });
	});

    app.controller('sblockCtrl', function(GLOBAL_APP_CONFIG, $scope, $routeParams, provider) {
        let currentPreset = GLOBAL_APP_CONFIG;
        $scope.showSBlocks = currentPreset.pagesSectionsVisibility.showSBlocks;
        $scope.sblock = provider.sblock.get({hash:$routeParams.hash});
    });

    function toBuffer(str){
        return new Uint8Array(str.match(/[\da-f]{2}/gi).map(function (h) {
            return parseInt(h, 16)
        }));
    }
	app.controller('accountCtrl', function(GLOBAL_APP_CONFIG, $rootScope, $scope, $filter, $http, $routeParams, validator, dateTimeConverter, provider, commonTools, customerInfoStorage, apexRadialChart, currencyExchange, schema, txParser, contractSchemes) {
        let currentPreset = GLOBAL_APP_CONFIG;
        let incorrectValue =  '---';
        $scope.account = {
            id : $routeParams.id,
            customerInfo: {
                tag: undefined
            },            
            isAgent : false,
            referralRange : 1000,
            refcode : incorrectValue,
            banned : defineIfBanned($routeParams.id, currentPreset.bannedAccs),
            balances : {
                mainTokenDetails : {
                    total: {
                        toUSD : 0,
                        value : undefined,
                        percentage : undefined,
                        tokenToUSDDecimals: undefined
                    },
                    available: {
                        value : 0,
                        percentage : 0
                    },
                    delegated: {
                        value : 0,
                        percentage : 0                                                
                    },
                    undelegated: {
                        value : 0,
                        percentage : 0                                                
                    },
                    transit: {
                        value : 0,
                        percentage : 0                                                
                    },
                    reward: {
                        value : 0,
                        percentage : 0                                                
                    }
                },
                allTokensAsList :  [],
                generalRepresentation : {
                    totalBalanceUSD : 0,
                    mainTokenUSDValue : 0,
                    otherTokensUSDValue : 0,
                    mainTokenPercentage : 0,
                    otherTokensPercentage : 0
                }
            },
            referralsInfo : {
                ref_count: incorrectValue,
                ref_reward : incorrectValue,
                lastcalc : incorrectValue
            },
            txs : {
                records : [],
                page_count : 0,
                page_num : 0                        
            },
            rewards : {
                records : [],
                page_count : 0,
                page_num : 0
            },
            pos : {//delegation of account

            },
            posID : { //POSs created by account

            },
            tokenID : { //tokens created by account

            }
        }

        $scope.networkData = {
            tickers : {},
            posNames : {}
        }

        $scope.viewData = {
            mainTokenBalancesTypesArr : ['available', 'delegated', 'undelegated', 'transit', 'reward'],
            selectors: {
                chartElement : 'accountBalanceChart',
                qrCode : '#qrcode',
                refQrCode : '#refqrcode'
            },
            radialChart : undefined,
            translationData : undefined,            
            showCurrencyToUSDAccountDetails : currentPreset.pagesSectionsVisibility.showCurrencyToUSDAccountDetails          
        }        

        $rootScope.$watch('mainToken', function(newValue, oldValue) {
            if (newValue !== undefined || oldValue !== undefined) {
                $scope.viewData.translationData = {
                    mainTokenTicker: $rootScope.mainToken.ticker
                }

                $scope.maintoken = newValue;                
                populateMainTokenBalanceDetails();
                $scope.$watch('account.balances.mainTokenDetails.total.value', function(newAvailableBalance, oldAvailableBalance) {
                    if (newAvailableBalance !== undefined || oldAvailableBalance !== undefined) { // if populateMainTokenBalanceDetails() set mainToken's balances from API
                        if ($scope.account.balances.mainTokenDetails.available.value >= (BigInt(1000) * BigInt(Math.pow(10, $rootScope.mainToken.decimals)))) {
                            $scope.account.isAgent = true;
                            $scope.account.refcode = evaluateRefCode($scope.account.id);
                            commonTools.genQR($scope.viewData.selectors.refQrCode, $scope.account.refcode);
                            populateReferralsInfo();                            
                        }

                        provider.get_tickers_all_unfiltered.query(function(tickers_all_unfiltered) {
                            tickers_all_unfiltered.forEach(function(ticker) {
                                $scope.networkData.tickers[ticker.hash] = {ticker: ticker.ticker, caption: ticker.caption};                                
                            });
                            renderChart();
                            populateBalancesAndPrices();                             
                        });
                    }
                });
                commonTools.genQR($scope.viewData.selectors.qrCode, $scope.account.id);
                $scope.getAccTxs(0);
                $scope.getAccRewards(0);
                populatePOS();
                populateTokenID();
                populateCustomerInfo();
            }                        
        });

        $scope.getTxTypeLocaleString = commonTools.getTxTypeLocaleString;
        $scope.getTxLink = commonTools.getTxLink;

        function defineIfBanned(accountId, bannedAccsArr) {
            let bannedAccs = bannedAccsArr !== undefined ? bannedAccsArr : [];
            return bannedAccs.indexOf(accountId) !== -1 ? true : false;
        }

        function evaluateRefCode(accountPubkey) {
            let pubkey = toBuffer(accountPubkey);
            let xorer = toBuffer('750d7f2b34ca3df1d6b7878debc8cf9a56bcb51a58435b5bcfb7e82ee09fa8be75');
            for (let i = 0; i < pubkey.length; i++)
                pubkey[i] ^= xorer[i];
            return 'ref_' +  Array.prototype.map.call(new Uint8Array(pubkey), x => ('00' + x.toString(16)).slice(-2)).join('');
        }

        function populateMainTokenBalanceDetails() {
            let sum = BigInt(0);
            provider.balance_main_token.get({id:$routeParams.id}, function(balancesMainToken) {
                $scope.viewData.mainTokenBalancesTypesArr.forEach(function(balanceType) {
                    let type =  balanceType === 'available' ? 'amount' : balanceType;
                    $scope.account.balances.mainTokenDetails[balanceType].value = BigInt(balancesMainToken[type]);
                    sum += $scope.account.balances.mainTokenDetails[balanceType].value;
                });

                $scope.account.balances.mainTokenDetails.total.value = sum;

                $scope.viewData.mainTokenBalancesTypesArr.forEach(function(balanceType) {
                    let type =  balanceType === 'available' ? 'amount' : balanceType;
                    if (sum !== BigInt(0))
                        $scope.account.balances.mainTokenDetails[balanceType].percentage = (parseFloat($scope.account.balances.mainTokenDetails[balanceType].value)/parseFloat(sum) * 100).toFixed(2);
                    else
                        $scope.account.balances.mainTokenDetails[balanceType].percentage = (0).toFixed(2);
                });
            });          
        }

        function populateCustomerInfo() {            
            customerInfoStorage.getInfo('account', $routeParams.id).then(function(customerInfo) {
                $scope.account.customerInfo = customerInfo;
                if ($scope.account.customerInfo.tag === undefined || $scope.account.customerInfo.tag.length == 0) {
                    $scope.account.customerInfo.tag = '---';
                }
            }, function(res) {
                $scope.account.customerInfo = res;
            });  
        }

        function populateReferralsInfo() {            
            provider.agent_info.get({id:$scope.account.id}, function(data) {
                let referralsInfoPropertiesArr = Object.keys($scope.account.referralsInfo);
                referralsInfoPropertiesArr.forEach(function(item) {
                    $scope.account.referralsInfo[item] = (data.hasOwnProperty(item) && validator.checkValidDigitalValue(data[item])) ? data[item] : incorrectValue;
                });
                if ($scope.account.referralsInfo.lastcalc !== incorrectValue)
                    $scope.account.referralsInfo.lastcalc = dateTimeConverter.getTimestamp($scope.account.referralsInfo.lastcalc);
            });            
        }

        function populateBalancesAndPrices() {
            priceAmountsTokensArr = [];
            provider.balance_all_unfiltered.query({id:$routeParams.id}, function(balance_all_unfiltered) {
                if (balance_all_unfiltered.length > 0) {
                    customerInfoStorage.getStorage('token').query({}, function(allTokensCustomersInfo) {                            
                        allCustomersTokensInfo = allTokensCustomersInfo;
                        if (allCustomersTokensInfo !== undefined) {
                            let coingeckoIDsString = '';
                            $scope.account.balances.allTokensAsList = balance_all_unfiltered;                    
                            $scope.account.balances.allTokensAsList.forEach(function(token) {
                                if ($scope.networkData.tickers[token.token] !== undefined) {
                                    token.caption = $scope.networkData.tickers[token.token].caption;
                                    provider.token_info.query({hash:token.token}, function(token_info) {
                                        token.type = commonTools.getTokenType(token_info[0]);
                                        let customerTokenInfo = allCustomersTokensInfo.find(tokenInfoBlock => tokenInfoBlock.token_id === token.token);
                                        if (customerTokenInfo !== undefined  && customerTokenInfo.coingecko_id !== undefined) {
                                            token.coingecko_id = customerTokenInfo.coingecko_id;                                            
                                            $http({method: 'GET', url: 'https://api.coingecko.com/api/v3/simple/price?ids=' + token.coingecko_id + '&vs_currencies=USD'}).
                                            then(function (response) {
                                                if (response.data !== undefined) {                                                                 
                                                    let info = response.data[token.coingecko_id];                                            
                                                    if (info !== undefined && info.usd !== undefined) {
                                                        token.priceInfo = {
                                                            origin : 'cg',
                                                            value : Number(info.usd)
                                                        }
                                                        
                                                        if (token.token === $rootScope.mainToken.hash) {
                                                            $scope.account.balances.mainTokenDetails.total.toUSD = currencyExchange.bigIntConvertValueToCurrency($scope.account.balances.mainTokenDetails.total.value, Number(info.usd), token.decimals, 4);
                                                        } else
                                                            token.usdValue = currencyExchange.bigIntConvertValueToCurrency(token.amount, Number(info.usd), token.decimals, 2);
                                                        priceAmountsTokensArr.push({
                                                            hash: token.token,
                                                            price: Number(info.usd),
                                                            amount: token.token === $rootScope.mainToken.hash ? $scope.account.balances.mainTokenDetails.total.value : token.amount,
                                                            decimals: token.decimals 
                                                        });                                                                                               
                                                    }
                                                    getGeneralBalancesRepresentation(priceAmountsTokensArr);
                                                }
                                            });
                                        } else {
                                            token.coingecko_id = undefined;
                                            token.priceInfo = commonTools.getTokenPriceInfo(token_info[0]);

                                            if (token.token === $rootScope.mainToken.hash) {
                                                $scope.account.balances.mainTokenDetails.total.toUSD = currencyExchange.bigIntConvertValueToCurrency($scope.account.balances.mainTokenDetails.total.value, token.priceInfo.value, token.decimals, 4);
                                            } else
                                                token.usdValue = currencyExchange.bigIntConvertValueToCurrency(token.amount, token.priceInfo.value, token.decimals, 2);
                                            priceAmountsTokensArr.push({
                                                hash: token.token,
                                                price: token.priceInfo.value,
                                                amount: token.token === $rootScope.mainToken.hash ? $scope.account.balances.mainTokenDetails.total.value : token.amount,
                                                decimals: token.decimals 
                                            });
                                            getGeneralBalancesRepresentation(priceAmountsTokensArr);
                                        } 
                                    });

                                }                      
                            });
                        }
                    });
                }
            });    
        }

        function getGeneralBalancesRepresentation(priceAmountsTokensArr) {
            let generalRepresentation = {
                totalBalanceUSD : BigInt(0),
                mainTokenUSDValue : BigInt(0),
                otherTokensUSDValue : BigInt(0),
                mainTokenPercentage : 0,
                otherTokensPercentage : 0,
                otherTokensMaxDecimals : 0,
                totalMaxDecimals : 0
            }

            let decimalsMultiplier = 0;
            let counter = null;

            priceAmountsTokensArr.forEach(function(item, i, arr) {
                item.tokenUSDValue = BigInt(item.amount);
                let priceDecimalPart = item.price.toString().split('.')[1]
                item.priceDecimals = priceDecimalPart !== undefined ? priceDecimalPart.length : 0;

                item.tokenToUSDDecimals = item.priceDecimals + item.decimals;                

                if (arr[counter] !== undefined) {
                    if (item.tokenToUSDDecimals > arr[counter].tokenToUSDDecimals) {
                        generalRepresentation.totalMaxDecimals = item.tokenToUSDDecimals;
                        decimalsMultiplier = item.tokenToUSDDecimals - arr[counter].tokenToUSDDecimals;
                        counter = i;
                        generalRepresentation.totalBalanceUSD = generalRepresentation.totalBalanceUSD * (10n ** BigInt(decimalsMultiplier));                            
                    } else if (item.tokenToUSDDecimals < arr[counter].tokenToUSDDecimals) {
                       item.tokenUSDValue = BigInt(item.amount) * (10n ** BigInt(arr[counter].tokenToUSDDecimals - item.tokenToUSDDecimals))
                    }
                } else {
                    generalRepresentation.totalMaxDecimals = item.tokenToUSDDecimals;
                    decimalsMultiplier = 0;
                    counter = i;
                }

                item.tokenUSDValue = item.tokenUSDValue * commonTools.valueToBigInt(item.price, item.priceDecimals).value;
                if (item.hash === $rootScope.mainToken.hash) {
                    generalRepresentation.mainTokenUSDValue = item.tokenUSDValue;                    
                }
                generalRepresentation.totalBalanceUSD += item.tokenUSDValue;
            });

            let mainToken = priceAmountsTokensArr.find(token => token.hash === $rootScope.mainToken.hash);
            if (mainToken !== undefined) {                                
                let multiplier = 0;
                if (mainToken.tokenToUSDDecimals > generalRepresentation.totalMaxDecimals) {
                    multiplier = mainToken.tokenToUSDDecimals - generalRepresentation.totalMaxDecimals;
                    generalRepresentation.otherTokensUSDValue = generalRepresentation.totalBalanceUSD * (10n ** BigInt(multiplier)) - mainToken.amount * commonTools.valueToBigInt(mainToken.price, mainToken.priceDecimals).value;
                    generalRepresentation.otherTokensMaxDecimals = mainToken.tokenToUSDDecimals;
                } else if (mainToken.tokenToUSDDecimals < generalRepresentation.totalMaxDecimals) {
                    multiplier = generalRepresentation.totalMaxDecimals - mainToken.tokenToUSDDecimals;
                    generalRepresentation.otherTokensUSDValue = generalRepresentation.totalBalanceUSD - mainToken.amount * commonTools.valueToBigInt(mainToken.price, mainToken.priceDecimals).value  * (10n ** BigInt(multiplier));
                    generalRepresentation.otherTokensMaxDecimals = generalRepresentation.totalMaxDecimals;
                } else {
                    generalRepresentation.otherTokensUSDValue = generalRepresentation.totalBalanceUSD - mainToken.amount * commonTools.valueToBigInt(mainToken.price, mainToken.priceDecimals).value;
                    generalRepresentation.otherTokensMaxDecimals = generalRepresentation.totalMaxDecimals;
                }
            } else {
                generalRepresentation.otherTokensUSDValue = generalRepresentation.totalBalanceUSD
                generalRepresentation.otherTokensMaxDecimals =  generalRepresentation.totalMaxDecimals
            }

            if (generalRepresentation.totalBalanceUSD !== BigInt(0)) {
                generalRepresentation.mainTokenPercentage = (parseFloat(generalRepresentation.mainTokenUSDValue)/parseFloat(generalRepresentation.totalBalanceUSD) * 100).toFixed(2);
                generalRepresentation.otherTokensPercentage = (parseFloat(generalRepresentation.otherTokensUSDValue)/parseFloat(generalRepresentation.totalBalanceUSD) * 100).toFixed(2);                                    
            }

            $scope.account.balances.generalRepresentation = generalRepresentation;
            generalRepresentation.f_otherTokensUSDValueFormatted = $filter('BIGINT_DECIMALS')(generalRepresentation.otherTokensUSDValue, generalRepresentation.otherTokensMaxDecimals, 4, true);
            generalRepresentation.f_mainTokenUSDValueFormatted = $filter('BIGINT_DECIMALS')(generalRepresentation.mainTokenUSDValue, generalRepresentation.totalMaxDecimals, 4, true);
            generalRepresentation.f_totalTokensUSDValueFormatted = $filter('BIGINT_DECIMALS')(generalRepresentation.totalBalanceUSD, generalRepresentation.totalMaxDecimals, 4, true);

            let orderArr = ['f_mainTokenUSDValueFormatted', 'f_otherTokensUSDValueFormatted','f_totalTokensUSDValueFormatted'];
            orderArr.forEach(function(item,index,arr) {
                let elem = generalRepresentation[item];
                elem.fractionalPart = Number.parseFloat('0.' + elem.fractionalPart).toFixed(2).toString().replace('0.','');
                generalRepresentation[item].value = elem.integerPart.toLocaleString('en-us') + '.' + elem.fractionalPart;
            });

            renderChart();
        }

        $rootScope.$on('$translateChangeSuccess', function(event, current, previous) {
            if (document.getElementById($scope.viewData.selectors.chartElement)) {
                $('#' + $scope.viewData.selectors.chartElement).empty();
                renderChart();
            }
        });

        function renderChart() {
            let labelsArr = commonTools.arrayTranslate(['TOKENS', $rootScope.mainToken.ticker]);
            let radialChartOptions = {
                series: [$scope.account.balances.generalRepresentation.otherTokensPercentage, $scope.account.balances.generalRepresentation.mainTokenPercentage],
                chart: {
                    type: 'radialBar',
                    redrawOnParentResize: true,
                    height: '225px'
                },
                colors: ['#9E71FF', '#0072FF'],
                plotOptions: {
                    radialBar: {
                        offsetX: 0,
                        offsetY: 0,
                        endAngle: 270,
                        track: {
                            margin: 8,
                            background: '#D1DDE8'
                        },  
                        dataLabels: {
                            name: {
                                fontSize: '12px',
                                color: 'rgb(0,0,0)'
                                },
                            value: {
                                    fontSize: '12px',
                                    color: 'rgb(0,0,0)',
                                    offsetY: 0
                                }
                        }
                    }
                },
                labels: labelsArr,
            };

            if ($scope.viewData.radialChart === undefined) {
                $scope.viewData.radialChart = new ApexCharts(document.querySelector("#" + $scope.viewData.selectors.chartElement), radialChartOptions);
                $scope.viewData.radialChart.render();                
            } else {
                $scope.viewData.radialChart.updateSeries([$scope.account.balances.generalRepresentation.otherTokensPercentage, $scope.account.balances.generalRepresentation.mainTokenPercentage]);
            }
        }             

        $scope.getAccTxs = function(page){
            $scope.isLoading = true;
            provider.account_transactions.get({id:$scope.account.id, page:page}, function(account_txs) {                                    
                $scope.account.txs.records = account_txs.records;
                if ($scope.account.txs.records !== undefined) {
                    provider.contract_pricelist.get(function(contract_pricelist) {
                        let txSchema = schema;
                        $scope.account.txs.records.forEach(function(record) {
                            record.time = dateTimeConverter.getTimestamp(record.time);
                            provider.token_info.query({hash:record.token_hash}, function(token_info) {
                                record.token_decimals = token_info[0] !== undefined ? token_info[0].decimals : 0;                           
                                provider.transaction.get({hash:record.hash}, function(tx) {
                                    record.calculatedFee = tx.fee;
                                })
                            });
                            if (txParser.isContract(record.data, txSchema, contract_pricelist)) {
                                $scope.getContactType = commonTools.getContractTypeTranslation;
                                record.txData = txParser.parse(record.data, txSchema, contract_pricelist);
                                record.isContract = true;
                            } else
                                record.isContract = false;                       
                        }); 
                        $scope.account.txs.page_count = account_txs.page_count;
                        $scope.isLoading = false;
                    });
                }
            });
            $scope.account.txs.page_num = page;
        };                

        $scope.getAccRewards = function(page) {
            $scope.isLoading = true;
            provider.account_rewards.get({id:$scope.account.id, page:page}, function(account_rewards) {
                $scope.account.rewards.records = account_rewards.records;
                if ($scope.account.rewards.records !== undefined) {
                    $scope.account.rewards.records.forEach(function(record) {
                        record.time = dateTimeConverter.getTimestamp(record.time);
                    });
                    $scope.account.rewards.page_count = account_rewards.page_count;
                    $scope.isLoading = false;
                }
            });
            $scope.account.rewards.page_num = page;
        };

        $scope.statusBadge = commonTools.getTxStatusBadge;

        function populatePOS() { //Both account.pos (stakingproviders tab) and account.posID (pos id tab)
            provider.get_pos_names.query(function(pos_names) {
                pos_names.forEach(function(pos) {
                   $scope.networkData.posNames[pos.pos_id] = pos.name;
                });
                provider.get_pos_list_all.get(function(pos_list_all) {
                    provider.get_delegated_list.query({delegator:$routeParams.id}, function(my_delegation_list) {
                        $scope.account.pos = my_delegation_list;

                        $scope.account.pos.forEach(function(staking_provider) {
                            staking_provider.name = $scope.networkData.posNames[staking_provider.pos_id];
                            staking_provider.status = pos_list_all.pos_contracts.find(pos => pos.pos_id === staking_provider.pos_id).active;
                        });            
                        
                        provider.get_pos_list.query({owner:$routeParams.id}, function(account_posID_list) {
                            let account_posID_list_names = account_posID_list;                                                                           
                            $scope.account.posID = pos_list_all.pos_contracts.filter(pos => pos.owner === $routeParams.id);
                            if (account_posID_list_names.length === $scope.account.posID.length) {
                                $scope.validPOSData = true;
                                $scope.account.posID.forEach(function(account_posID_data) {
                                    if (!account_posID_list_names.some(elem => elem.pos_id === account_posID_data.pos_id))
                                        $scope.validPOSData = false;
                                    else {
                                       account_posID_data.name =  account_posID_list_names.find(elem => elem.pos_id === account_posID_data.pos_id).name;
                                       let my_validator = $scope.account.pos.find(elem => elem.pos_id === account_posID_data.pos_id)
                                       account_posID_data.selfDelegatedAmount = my_validator !== undefined ? my_validator.delegated : 0;
                                    }
                                });
                                if (!$scope.validPOSData)
                                    console.log('Some problem` with the source data of the staking provider has occured');
                            }
                        });                                   
                    });
                    $scope.isLoading = false;
                });
            });            
        }

        function populateTokenID() {//tokens created by account (for token id tab)
            provider.get_tokens_by_owner.query({owner:$routeParams.id}, function(tokens_list) {
                tokens_list.forEach(function(token) {
                    provider.token_info.query({hash:token.token_hash}, function(token_info) {
                        token.type = commonTools.getTokenType(token_info[0]);
                        token.decimals = token_info[0].decimals;
                     });   
                    provider.get_token_holder_count.get({token_hash: token.token_hash}, function(holders) {
                        token.holders_count = holders.count;
                    });
                });

                $scope.account.tokenID = tokens_list;                
            });            
        }  
	});

	app.controller('transactionCtrl', function($scope, $rootScope, $interval, $routeParams, $translate, $filter, provider, schema, commonTools, txParser, contractSchemes, contractFormatter) {
        $scope.showParams = false;
        let defaultValue = '---';
        $scope.txDataInit = defaultValue;
        $scope.txEIndexData = {};
        $scope.statusBadge = commonTools.getTxStatusBadge;
        $scope.txCurrentState = undefined;
        $scope.interval = $interval(getTxdata, 5000, 0, true);
        getTxdata();        
        $rootScope.$watch('mainToken', function(newValue, oldValue) {
            $scope.maintoken = newValue;
        }, true);
        function getTxdata() {
            //console.log(`Trying to get data for Tx ${$routeParams.hash}`);
            provider.transaction.get({hash:$routeParams.hash}, function(tx) {
                if (tx.hash !== undefined) {
                    $scope.txCurrentState = 'isInNetwork';
                    $scope.tx = tx;
                    processTxData($scope.tx)                    
                } else {
                    provider.pending_tx_hash.query({hash:$routeParams.hash}, function(tx) {                        
                        if (tx.length > 0 && tx[0].hash !== undefined) {
                            $scope.txCurrentState = 'isInPending';                            
                            $scope.tx = tx[0];
                            $scope.tx.status = 'STATUS_PENDING';
                            processTxData($scope.tx)
                        }
                    })
                }
            });            
        }
           
        function processTxData(tx) {
            let tokenHash = undefined;
            if ($scope.txCurrentState === 'isInNetwork')
                tokenHash = $scope.tx.token_hash;
            else if ($scope.txCurrentState === 'isInPending')
                tokenHash = $scope.tx.ticker;
            else return

            $scope.tx.token = {};
            provider.token_info.query({hash:tokenHash}, function(token_info) {
                $scope.tx.token.ticker = token_info[0].ticker;
                $scope.tx.token.decimals =  token_info[0].decimals;
                provider.contract_pricelist.get(function(contract_pricelist) {
                    let txSchema = schema;

                    if (txParser.isContract(tx.data, txSchema, contract_pricelist)) {
                        $scope.getContactType = commonTools.getContractTypeTranslation;                    
                        $scope.showContractParams = true;
                        $scope.txDataInit = txParser.parse(tx.data, txSchema, contract_pricelist);
                        $scope.txData = txParser.parse(tx.data, txSchema, contract_pricelist);
                        $scope.contractScheme = contractSchemes.getScheme($scope.txData.type);
                        if ($scope.txData.type === 'delegate' || $scope.txData.type === 'undelegate') {
                            $scope.$watch('tx.token', function(newValue, oldValue) {
                                if (newValue.ticker !== undefined && newValue.decimals !== null ) {
                                    $scope.txData.txToken = {
                                        hash     : tokenHash,
                                        ticker   : newValue.ticker,
                                        decimals : newValue.decimals
                                    }
                                    prettifyTxData($scope.txData);                       
                                }                    
                            }, true);                                
                        } else if ($scope.txData.type === 'create_token') {
                            $rootScope.$watch('mainToken', function(newValue, oldValue) {
                                $scope.txData.maintoken = newValue;
                                prettifyTxData($scope.txData);
                            }, true);
                        } else if ($scope.txData.type === 'bridge_lock') {
                            $scope.txData.dataEncode = tx.data_encode;
                            prettifyTxData($scope.txData);
                        } else if ($scope.txData.type === 'bridge_claim_init' || $scope.txData.type === 'bridge_claim_confirm') {
                            $scope.txData.dataEncode = tx.data_encode;
                            prettifyTxData($scope.txData);
                        } else 
                            prettifyTxData($scope.txData);

                        if ($scope.tx.status !== 2 && $scope.contractScheme.eindexer.length > 0) {
                            getEIndexData($scope.txData, $scope.contractScheme);
                        }                                                   
                    } 
                });
            });            
        }
        
        $scope.$watch('txCurrentState', function(newValue, oldValue) {
            if (newValue === 'isInNetwork') {
                //console.log(`Tx ${$scope.tx.hash} is in network`);
                $interval.cancel($scope.interval);
            } else if (newValue === 'isInPending') {                
                //console.log(`Tx ${$scope.tx.hash} is in pending`);
            }
        });

        function getEIndexData(data, contractScheme) {
            provider.eindex_by_hash.query({hash:$scope.tx.hash}, function(eindexPropsArr) {
                contractScheme.eindexer.forEach(function(eindexProp) {
                    let eindexDataByProp = eindexPropsArr.find(element => element.hasOwnProperty('rectype') && element.rectype === eindexProp);
                    if (eindexDataByProp !== undefined) {
                        $scope.txEIndexData[eindexProp] = eindexDataByProp.value;
                    }
                });                
                $scope.txEIndexDataTemplate = `${$scope.contractScheme.eindexerTemlate}.html`;
            });
        }

        function prettifyTxData(txData) {            
            $scope.txContractsTemplate = $scope.contractScheme.template;            
            $scope.txContractsTemplate = $scope.contractScheme.template !== 'default' ? `${$scope.contractScheme.template}.html` : 'tx-default-contract.html';
            contractFormatter.formatData(txData);
        }
    });

    app.controller('dropFarmsCtrl', function($scope, $routeParams, $translate, $filter, provider) {
        $scope.tabsOrder = ['active', 'paused', 'finished'];
        $scope.dropFarms = {
            active   : [],
            finished : [],
            paused   : []
        }

        provider.get_dex_farms_all.query(function (dexFarms) {
            dexFarms.forEach(function(dexFarm) {
                if (dexFarm.blocks_left > 0)
                    $scope.dropFarms.active.push(dexFarm);
                else if (dexFarm.blocks_left === null)
                    $scope.dropFarms.paused.push(dexFarm);
                else if (dexFarm.blocks_left <= 0)
                    $scope.dropFarms.finished.push(dexFarm);
            });
        });
    });

    app.controller('enexPoolsCtrl', function($scope, $routeParams, $translate, $filter, provider, commonTools) {
        $scope.enexPools = [];
        $scope.tokensArr = [];        
        let propsArr = ['asset_1', 'asset_2', 'token_hash'];

        provider.get_tickers_all_unfiltered.query(function(tickers_all_unfiltered) {            
            provider.get_dex_pools.query(function (enexPools) {                
                $scope.enexPools = enexPools;

                $scope.enexPools.forEach(function(enexPool) {
                    enexPool.status = 0;
                    propsArr.forEach(function(prop) {
                        if ($scope.tokensArr.indexOf(enexPool[prop]) === -1 && tickers_all_unfiltered.find(elem => elem.hash === enexPool[prop]))
                            $scope.tokensArr.push(enexPool[prop]);  
                    });

                    if (!isNaN(enexPool.liquidity)) {
                        if (typeof enexPool.liquidity == 'string')
                            enexPool.liquidity = Number.parseFloat(enexPool.liquidity);                        
                    } else
                        enexPool.liquidity = 0;

                    enexPool.liquidityFrormatted = commonTools.zeroTrim(enexPool.liquidity);

                });

                $scope.tokensArr.forEach(function(hash) {
                    provider.token_info.query({hash:hash}, function(token) {
                        $scope.enexPools.forEach(function(enexPool) {
                            propsArr.forEach(function(prop) {
                                if (enexPool[prop] === hash) {                                    
                                    enexPool[prop + '_info'] = {
                                        decimals : token[0].decimals,
                                        ticker   : token[0].ticker
                                    }
                                    if (prop === 'token_hash')
                                        enexPool[prop + '_info'].total_supply = token[0].total_supply;
                                    enexPool.status++;
                                }
                            })
                        });
                    });
                });
            });
        });
    });


	app.run(function($rootScope, $http, $location, $cookies, langService, provider, GLOBAL_APP_CONFIG) {      

        $rootScope.$on('$routeChangeSuccess', function() {
            gtag('config', 'UA-138901721-1', {'page_path': $location.path()});
        });

        $rootScope.lang = langService.getLang();
        langService.changeLanguage($rootScope.lang);

        provider.token_info.query({hash:GLOBAL_APP_CONFIG.tokenHash}, function(token_info) {
            $rootScope.mainToken = token_info[0];
            $rootScope.mainTokenFactor = Math.pow(10, $rootScope.mainToken.decimals);
        });

        $rootScope.iconsClasses = {
            twitter : 'fab fa-twitter',
            github : 'fab fa-github',
            medium : 'fab fa-medium-m',
            telegram : 'fab fa-telegram-plane',
            bitcointalk : 'fab fa-btc',
            linkedin : 'fab fa-linkedin-in',
            youtube : 'fab fa-youtube',
            qq : 'fab fa-qq',
            weixin : 'fab fa-weixin',
            facebook : 'fab fa-facebook-f',
            forklog : '',
            externalLink: 'fas fa-external-link-alt',
            instagram: 'fab fa-instagram-square',
            reddit: 'fab fa-reddit-alien'
        }

        $rootScope.existCookies = function () {
            return $cookies.get('blockchain-explorer-enecuum') === 'true' ? true : false;
        };

        $rootScope.get_time = function(unix_t){
            var d = Date.parse(unix_t);
            if (isNaN(d))
                return (new Date(unix_t * 1000)).toLocaleString();
            else 
                return unix_t;
        };

        $rootScope.setCookies = function () {
            let currentDate = new Date();
            let expirationData = currentDate.setFullYear(currentDate.getFullYear() + 10);
            $cookies.put('blockchain-explorer-enecuum', 'true',{'expires': new Date(expirationData)});
        };

    });
    app.factory('langService', function($window, $rootScope, $translate){
        let languages = [
            {
                flag : 'gb',
                id : 'en',
                name : 'English'
            },
            {
                flag : 'de',
                id : 'de',
                name : 'Deutch'
            },
            // {
            //     flag : 'es',
            //     id : 'es', 
            //     name : 'Español'
            // },
            {
                flag : 'ru',
                id : 'ru',
                name : 'Русский'
            },
            {
                flag : 'fr',
                id : 'fr',
                name : 'Français'
            },
            {
                flag : 'pt',
                id : 'pt',
                name : 'Português'
            },
            // {
            //     flag : 'cn',
            //     id : 'zh',
            //     name : '简体中文'
            // },
            {
                flag : 'kr',
                id : 'ko',
                name : '한국어'
            },
            {
                flag : 'vn',
                id : 'vi',
                name : 'Tiếng Việt'
            },
            // {
            //     flag : 'jp',
            //     id : 'jp',
            //     name : '日本語'
            // },
            {
                flag : 'in',
                id : 'in',
                name : 'Indonesia'
            },
            // {
            //     flag : 'ae',
            //     id : 'ar',
            //     name : 'العربية'
            // },
            {
                flag : 'tr',
                id : 'tr',
                name : 'Türkçe'
            }
        ];
        let lang = null;
        let curLangObject = null;
        return{
            getLang : function () {
                return $window.localStorage.lang || (navigator.language || navigator.userLanguage).substring(0, 2);
            },
            getLangObject : function () {
                return curLangObject;
            },
            changeLanguage : function (key) {
                lang = key;
                $rootScope.lang = key;
                $translate.use(key);
                curLangObject = languages.find(x => x.id === key);
                $window.localStorage.lang = key;
            },
            languages : languages
        };
    });
</script>
<!-- App js -->
<script src="assets/js/app.min.js"></script>
<!-- scripts for widgets -->
<script src="assets/js/vendor/jquery-jvectormap-1.2.2.min.js"></script>
<script src="assets/js/vendor/jquery-jvectormap-world-mill-en.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/simplebar@5.2.1/dist/simplebar.min.js"></script>
<script>
    $(document).ready(function() {
        $('#explorerPagesMenu .nav-link.active').removeClass('active');

        $('body .topnav').on('mouseleave','.dropdown-menu.show, .nav-item.dropdown.show, .navbar-nav.dropdown.show', function() {
            if ($('.topnav .navbar-toggle').css('display') === "none") {
                $('.nav-item.dropdown.show, .dropdown-menu.show, .navbar-nav.dropdown.show').removeClass('show');
                $('.navbar-dark .navbar-nav .nav-link:focus').blur();
            }
        });

        $(window).on('load resize', function() {
            if ($('.topnav .navbar-toggle').css('display') === "none") {
                let height = $('#explorerPagesMenu').height() + 'px';
                $('#topbar-languagedrop').css({'height': height});
            } else {
                $('#topbar-languagedrop').css({'height': 'auto'});
            }
        });

        $('body').on('mouseenter', '[data-toggle="tooltip"]', function(e) {
            $(this).tooltip("show");
        });

        $("body").on("click", "[data-copy-from-id]", function() {
            let selector = '#' + $(this).attr('data-copy-from-id');
            let copyText = $(selector).text();
            let tmp = document.createElement("input");
            tmp.setAttribute("value",copyText);
            document.body.appendChild(tmp);
            tmp.select();
            document.execCommand("copy");
            $.toast({
                heading: 'Information',
                text: 'Text copied to clipboard',
                icon: 'success',
                hideAfter: 1500,
                stack: 3,
                position: 'top-right',
                loader: false
            });
            window.getSelection().removeAllRanges();
            document.body.removeChild(tmp);
        });
    });
</script>

</body>
</html>
